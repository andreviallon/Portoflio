wp.customize.navMenusPreview=wp.customize.MenusCustomizerPreview=function($,e,n,t){"use strict";var a={data:{navMenuInstanceArgs:{}}};return"undefined"!=typeof _wpCustomizePreviewNavMenusExports&&e.extend(a.data,_wpCustomizePreviewNavMenusExports),a.init=function(){var n=this,a=!1;t.preview.bind("sync",function(){a=!0}),t.selectiveRefresh&&(t.each(function(e){n.bindSettingListener(e)}),t.bind("add",function(e){e.get()&&!e.get()._invalid&&n.bindSettingListener(e,{fire:a})}),t.bind("remove",function(e){n.unbindSettingListener(e)}),t.selectiveRefresh.bind("render-partials-response",function(t){t.nav_menu_instance_args&&e.extend(n.data.navMenuInstanceArgs,t.nav_menu_instance_args)})),t.preview.bind("active",function(){n.highlightControls()})},t.selectiveRefresh&&(a.NavMenuInstancePartial=t.selectiveRefresh.Partial.extend({initialize:function(n,a){var i=this,r,s;if(!(r=n.match(/^nav_menu_instance\[([0-9a-f]{32})]$/)))throw new Error("Illegal id for nav_menu_instance partial. The key corresponds with the args HMAC.");if(s=r[1],a=a||{},a.params=e.extend({selector:'[data-customize-partial-id="'+n+'"]',navMenuArgs:a.constructingContainerContext||{},containerInclusive:!0},a.params||{}),t.selectiveRefresh.Partial.prototype.initialize.call(i,n,a),!e.isObject(i.params.navMenuArgs))throw new Error("Missing navMenuArgs");if(i.params.navMenuArgs.args_hmac!==s)throw new Error("args_hmac mismatch with id")},isRelatedSetting:function(n,a,i){var r=this,s,o,u,c,l,v;if(e.isString(n)&&(n=t(n)),(u=/^nav_menu_item\[/.test(n.id))&&e.isObject(a)&&e.isObject(i)&&(c=e.clone(a),l=e.clone(i),delete c.type_label,delete l.type_label,"https"===t.preview.scheme.get()&&(v=document.createElement("a"),v.href=c.url,v.protocol="https:",c.url=v.href,v.href=l.url,v.protocol="https:",l.url=v.href),a.title&&(delete l.original_title,delete c.original_title),e.isEqual(l,c)))return!1;if(r.params.navMenuArgs.theme_location){if("nav_menu_locations["+r.params.navMenuArgs.theme_location+"]"===n.id)return!0;s=t("nav_menu_locations["+r.params.navMenuArgs.theme_location+"]")}return o=r.params.navMenuArgs.menu,!o&&s&&(o=s()),!!o&&("nav_menu["+o+"]"===n.id||u&&(a&&a.nav_menu_term_id===o||i&&i.nav_menu_term_id===o))},refresh:function(){var n=this,a,i=$.Deferred();return e.isNumber(n.params.navMenuArgs.menu)?a=n.params.navMenuArgs.menu:n.params.navMenuArgs.theme_location&&t.has("nav_menu_locations["+n.params.navMenuArgs.theme_location+"]")&&(a=t("nav_menu_locations["+n.params.navMenuArgs.theme_location+"]").get()),a?t.selectiveRefresh.Partial.prototype.refresh.call(n):(n.fallback(),i.reject(),i.promise())},renderContent:function(e){var n=this,a=e.container;""===e.addedContent&&e.partial.fallback(),t.selectiveRefresh.Partial.prototype.renderContent.call(n,e)&&$(document).trigger("customize-preview-menu-refreshed",[{instanceNumber:null,wpNavArgs:e.context,wpNavMenuArgs:e.context,oldContainer:a,newContainer:e.container}])}}),t.selectiveRefresh.partialConstructor.nav_menu_instance=a.NavMenuInstancePartial,a.handleUnplacedNavMenuInstances=function(n){var i;return i=e.filter(e.values(a.data.navMenuInstanceArgs),function(e){return!t.selectiveRefresh.partial.has("nav_menu_instance["+e.args_hmac+"]")}),!!e.findWhere(i,n)&&(t.selectiveRefresh.requestFullRefresh(),!0)},a.bindSettingListener=function(e,n){var t;return n=n||{},(t=e.id.match(/^nav_menu\[(-?\d+)]$/))?(e._navMenuId=parseInt(t[1],10),e.bind(this.onChangeNavMenuSetting),n.fire&&this.onChangeNavMenuSetting.call(e,e(),!1),!0):(t=e.id.match(/^nav_menu_item\[(-?\d+)]$/))?(e._navMenuItemId=parseInt(t[1],10),e.bind(this.onChangeNavMenuItemSetting),n.fire&&this.onChangeNavMenuItemSetting.call(e,e(),!1),!0):!!(t=e.id.match(/^nav_menu_locations\[(.+?)]/))&&(e._navMenuThemeLocation=t[1],e.bind(this.onChangeNavMenuLocationsSetting),n.fire&&this.onChangeNavMenuLocationsSetting.call(e,e(),!1),!0)},a.unbindSettingListener=function(e){e.unbind(this.onChangeNavMenuSetting),e.unbind(this.onChangeNavMenuItemSetting),e.unbind(this.onChangeNavMenuLocationsSetting)},a.onChangeNavMenuSetting=function(){var e=this;a.handleUnplacedNavMenuInstances({menu:e._navMenuId}),t.each(function(n){n._navMenuThemeLocation&&e._navMenuId===n()&&a.handleUnplacedNavMenuInstances({theme_location:n._navMenuThemeLocation})})},a.onChangeNavMenuItemSetting=function(e,n){var i=e||n,r;(r=t("nav_menu["+String(i.nav_menu_term_id)+"]"))&&a.onChangeNavMenuSetting.call(r)},a.onChangeNavMenuLocationsSetting=function(){var n=this,i;a.handleUnplacedNavMenuInstances({theme_location:n._navMenuThemeLocation}),(i=!!e.findWhere(e.values(a.data.navMenuInstanceArgs),{theme_location:n._navMenuThemeLocation}))||t.selectiveRefresh.requestFullRefresh()}),a.highlightControls=function(){t.settings.channel&&$(document).on("click",".menu-item",function(e){var n;e.shiftKey&&(n=$(this).attr("class").match(/(?:^|\s)menu-item-(-?\d+)(?:\s|$)/))&&(e.preventDefault(),e.stopPropagation(),t.preview.send("focus-nav-menu-item-control",parseInt(n[1],10)))})},t.bind("preview-ready",function(){a.init()}),a}(jQuery,_,wp,wp.customize);