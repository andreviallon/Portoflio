!function(e){e.suggest=function(t,l){function s(){var e=d.offset();m.css({top:e.top+t.offsetHeight+"px",left:e.left+"px"})}function a(e){if(/27$|38$|40$/.test(e.keyCode)&&m.is(":visible")||/^13$|^9$/.test(e.keyCode)&&o())switch(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,e.returnValue=!1,e.keyCode){case 38:p();break;case 40:f();break;case 9:case 13:h();break;case 27:m.hide();break}else d.val().length!=g&&(C&&clearTimeout(C),C=setTimeout(n,l.delay),g=d.val().length)}function n(){var t=e.trim(d.val()),s,a;l.multiple&&-1!=(s=t.lastIndexOf(l.multipleSep))&&(t=e.trim(t.substr(s+l.multipleSep.length))),t.length>=l.minchars?(cached=i(t),cached?c(cached.items):e.get(l.source,{q:t},function(e){m.hide(),c(a=u(e,t)),r(t,a,e.length)})):m.hide()}function i(e){var t;for(t=0;t<v.length;t++)if(v[t].q==e)return v.unshift(v.splice(t,1)[0]),v[0];return!1}function r(e,t,s){for(var a;v.length&&S+s>l.maxCacheSize;)a=v.pop(),S-=a.size;v.push({q:e,size:s,items:t}),S+=s}function c(t){var a="",n;if(t)if(t.length){for(s(),n=0;n<t.length;n++)a+="<li>"+t[n]+"</li>";m.html(a).show(),m.children("li").mouseover(function(){m.children("li").removeClass(l.selectClass),e(this).addClass(l.selectClass)}).click(function(e){e.preventDefault(),e.stopPropagation(),h()})}else m.hide()}function u(t,s){var a=[],n=t.split(l.delimiter),i,r;for(i=0;i<n.length;i++)(r=e.trim(n[i]))&&(r=r.replace(new RegExp(s,"ig"),function(e){return'<span class="'+l.matchClass+'">'+e+"</span>"}),a[a.length]=r);return a}function o(){var e;return!!m.is(":visible")&&((e=m.children("li."+l.selectClass)).length||(e=!1),e)}function h(){$currentResult=o(),$currentResult&&(l.multiple?(-1!=d.val().indexOf(l.multipleSep)?$currentVal=d.val().substr(0,d.val().lastIndexOf(l.multipleSep)+l.multipleSep.length)+" ":$currentVal="",d.val($currentVal+$currentResult.text()+l.multipleSep+" "),d.focus()):d.val($currentResult.text()),m.hide(),d.trigger("change"),l.onSelect&&l.onSelect.apply(d[0]))}function f(){$currentResult=o(),$currentResult?$currentResult.removeClass(l.selectClass).next().addClass(l.selectClass):m.children("li:first-child").addClass(l.selectClass)}function p(){var e=o();e?e.removeClass(l.selectClass).prev().addClass(l.selectClass):m.children("li:last-child").addClass(l.selectClass)}var d,m,C,g,v,S;d=e(t).attr("autocomplete","off"),m=e("<ul/>"),C=!1,g=0,v=[],S=0,m.addClass(l.resultsClass).appendTo("body"),s(),e(window).on("load",s).on("resize",s),d.blur(function(){setTimeout(function(){m.hide()},200)}),d.keydown(a)},e.fn.suggest=function(t,l){if(t)return(l=l||{}).multiple=l.multiple||!1,l.multipleSep=l.multipleSep||",",l.source=t,l.delay=l.delay||100,l.resultsClass=l.resultsClass||"ac_results",l.selectClass=l.selectClass||"ac_over",l.matchClass=l.matchClass||"ac_match",l.minchars=l.minchars||2,l.delimiter=l.delimiter||"\n",l.onSelect=l.onSelect||!1,l.maxCacheSize=l.maxCacheSize||65536,this.each(function(){new e.suggest(this,l)}),this}}(jQuery);