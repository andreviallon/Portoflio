!function(e,t){var n=wp.customize,i,s={},a,o,r,c;!function(e){var i,a,o;e.replaceState&&(i=function(e){var i,s,a;return(i=document.createElement("a")).href=e,s=n.utils.parseQueryString(location.search.substr(1)),(a=n.utils.parseQueryString(i.search.substr(1))).customize_changeset_uuid=s.customize_changeset_uuid,s.customize_autosaved&&(a.customize_autosaved="on"),s.customize_theme&&(a.customize_theme=s.customize_theme),s.customize_messenger_channel&&(a.customize_messenger_channel=s.customize_messenger_channel),i.search=t.param(a),i.href},e.replaceState=(a=e.replaceState,function t(n,o,r){return s=n,a.call(e,n,o,"string"==typeof r&&r.length>0?i(r):r)}),e.pushState=(o=e.pushState,function t(n,a,r){return s=n,o.call(e,n,a,"string"==typeof r&&r.length>0?i(r):r)}),window.addEventListener("popstate",function(e){s=e.state}))}(history),i=function(e,t,n){var i;return function(){var s=arguments;n=n||this,clearTimeout(i),i=setTimeout(function(){i=null,e.apply(n,s)},t)}},n.Preview=n.Messenger.extend({initialize:function(e,s){var a=this,o=document.createElement("a");n.Messenger.prototype.initialize.call(a,e,s),o.href=a.origin(),a.add("scheme",o.protocol.replace(/:$/,"")),a.body=t(document.body),a.window=t(window),n.settings.channel&&(a.body.on("click.preview","a",function(e){a.handleLinkClick(e)}),a.body.on("submit.preview","form",function(e){a.handleFormSubmit(e)}),a.window.on("scroll.preview",i(function(){a.send("scroll",a.window.scrollTop())},200)),a.bind("scroll",function(e){a.window.scrollTop(e)}))},handleLinkClick:function(e){var i=this,s,a;if(s=t(e.target).closest("a"),!_.isUndefined(s.attr("href"))&&!(a="#"===s.attr("href").substr(0,1))&&/^https?:$/.test(s.prop("protocol"))){if(!n.isLinkPreviewable(s[0]))return wp.a11y.speak(n.settings.l10n.linkUnpreviewable),void e.preventDefault();e.preventDefault(),e.shiftKey||this.send("url",s.prop("href"))}},handleFormSubmit:function(e){var i=this,s,a;if(s=document.createElement("a"),a=t(e.target),s.href=a.prop("action"),"GET"!==a.prop("method").toUpperCase()||!n.isLinkPreviewable(s))return wp.a11y.speak(n.settings.l10n.formUnpreviewable),void e.preventDefault();e.isDefaultPrevented()||(s.search.length>1&&(s.search+="&"),s.search+=a.serialize(),this.send("url",s.href)),e.preventDefault()}}),n.addLinkPreviewing=function e(){var i="a[href], area";t(document.body).find(i).each(function(){n.prepareLinkPreview(this)}),"undefined"!=typeof MutationObserver?(n.mutationObserver=new MutationObserver(function(e){_.each(e,function(e){t(e.target).find(i).each(function(){n.prepareLinkPreview(this)})})}),n.mutationObserver.observe(document.documentElement,{childList:!0,subtree:!0})):t(document.documentElement).on("click focus mouseover",i,function(){n.prepareLinkPreview(this)})},n.isLinkPreviewable=function e(t,i){var s,a,o,r;return o=_.extend({},{allowAdminAjax:!1},i||{}),"javascript:"===t.protocol||("https:"===t.protocol||"http:"===t.protocol)&&(r=t.host.replace(/:(80|443)$/,""),a=document.createElement("a"),!!(s=!_.isUndefined(_.find(n.settings.url.allowed,function(e){return a.href=e,a.protocol===t.protocol&&a.host.replace(/:(80|443)$/,"")===r&&0===t.pathname.indexOf(a.pathname.replace(/\/$/,""))})))&&(!/\/wp-(login|signup)\.php$/.test(t.pathname)&&(/\/wp-admin\/admin-ajax\.php$/.test(t.pathname)?o.allowAdminAjax:!/\/wp-(admin|includes|content)(\/|$)/.test(t.pathname))))},n.prepareLinkPreview=function e(i){var s,a=t(i);a.closest("#wpadminbar").length||"#"!==a.attr("href").substr(0,1)&&/^https?:$/.test(i.protocol)&&(n.settings.channel&&"https"===n.preview.scheme.get()&&"http:"===i.protocol&&-1!==n.settings.url.allowedHosts.indexOf(i.host)&&(i.protocol="https:"),a.hasClass("wp-playlist-caption")||(n.isLinkPreviewable(i)?(a.removeClass("customize-unpreviewable"),(s=n.utils.parseQueryString(i.search.substring(1))).customize_changeset_uuid=n.settings.changeset.uuid,n.settings.changeset.autosaved&&(s.customize_autosaved="on"),n.settings.theme.active||(s.customize_theme=n.settings.theme.stylesheet),n.settings.channel&&(s.customize_messenger_channel=n.settings.channel),i.search=t.param(s),n.settings.channel&&(i.target="_self")):n.settings.channel&&a.addClass("customize-unpreviewable")))},n.addRequestPreviewing=function e(){var i=function(e,i,s){var a,o,r,c={};(a=document.createElement("a")).href=e.url,n.isLinkPreviewable(a,{allowAdminAjax:!0})&&(o=n.utils.parseQueryString(a.search.substring(1)),n.each(function(e){e._dirty&&(c[e.id]=e.get())}),_.isEmpty(c)||("POST"!==(r=e.type.toUpperCase())&&(s.setRequestHeader("X-HTTP-Method-Override",r),o._method=r,e.type="POST"),e.data?e.data+="&":e.data="",e.data+=t.param({customized:JSON.stringify(c)})),o.customize_changeset_uuid=n.settings.changeset.uuid,n.settings.changeset.autosaved&&(o.customize_autosaved="on"),n.settings.theme.active||(o.customize_theme=n.settings.theme.stylesheet),o.customize_preview_nonce=n.settings.nonce.preview,a.search=t.param(o),e.url=a.href)};t.ajaxPrefilter(i)},n.addFormPreviewing=function e(){t(document.body).find("form").each(function(){n.prepareFormPreview(this)}),"undefined"!=typeof MutationObserver&&(n.mutationObserver=new MutationObserver(function(e){_.each(e,function(e){t(e.target).find("form").each(function(){n.prepareFormPreview(this)})})}),n.mutationObserver.observe(document.documentElement,{childList:!0,subtree:!0}))},n.prepareFormPreview=function e(i){var s,a={};i.action||(i.action=location.href),(s=document.createElement("a")).href=i.action,n.settings.channel&&"https"===n.preview.scheme.get()&&"http:"===s.protocol&&-1!==n.settings.url.allowedHosts.indexOf(s.host)&&(s.protocol="https:",i.action=s.href),"GET"===i.method.toUpperCase()&&n.isLinkPreviewable(s)?(t(i).removeClass("customize-unpreviewable"),a.customize_changeset_uuid=n.settings.changeset.uuid,n.settings.changeset.autosaved&&(a.customize_autosaved="on"),n.settings.theme.active||(a.customize_theme=n.settings.theme.stylesheet),n.settings.channel&&(a.customize_messenger_channel=n.settings.channel),_.each(a,function(e,n){var s=t(i).find('input[name="'+n+'"]');s.length?s.val(e):t(i).prepend(t("<input>",{type:"hidden",name:n,value:e}))}),n.settings.channel&&(i.target="_self")):n.settings.channel&&t(i).addClass("customize-unpreviewable")},n.keepAliveCurrentUrl=(a=location.pathname,o=location.search.substr(1),r=null,c=["customize_theme","customize_changeset_uuid","customize_messenger_channel","customize_autosaved"],function e(){var i,s;o!==location.search.substr(1)||a!==location.pathname?(i=document.createElement("a"),null===r&&(i.search=o,r=n.utils.parseQueryString(o),_.each(c,function(e){delete r[e]})),i.href=location.href,s=n.utils.parseQueryString(i.search.substr(1)),_.each(c,function(e){delete s[e]}),a===location.pathname&&_.isEqual(r,s)?n.preview.send("keep-alive"):(i.search=t.param(s),i.hash="",n.settings.url.self=i.href,n.preview.send("ready",{currentUrl:n.settings.url.self,activePanels:n.settings.activePanels,activeSections:n.settings.activeSections,activeControls:n.settings.activeControls,settingValidities:n.settings.settingValidities})),r=s,o=location.search.substr(1),a=location.pathname):n.preview.send("keep-alive")}),n.settingPreviewHandlers={custom_logo:function(e){t("body").toggleClass("wp-custom-logo",!!e)},custom_css:function(e){t("#wp-custom-css").text(e)},background:function(){var e="",i={};_.each(["color","image","preset","position_x","position_y","size","repeat","attachment"],function(e){i[e]=n("background_"+e)}),t(document.body).toggleClass("custom-background",!(!i.color()&&!i.image())),i.color()&&(e+="background-color: "+i.color()+";"),i.image()&&(e+='background-image: url("'+i.image()+'");',e+="background-size: "+i.size()+";",e+="background-position: "+i.position_x()+" "+i.position_y()+";",e+="background-repeat: "+i.repeat()+";",e+="background-attachment: "+i.attachment()+";"),t("#custom-background-css").text("body.custom-background { "+e+" }")}},t(function(){var e,i,a;n.settings=window._wpCustomizeSettings,n.settings&&(n.preview=new n.Preview({url:window.location.href,channel:n.settings.channel}),n.addLinkPreviewing(),n.addRequestPreviewing(),n.addFormPreviewing(),i=function(e,t,i){var s=n(e);s?s.set(t):(i=i||!1,s=n.create(e,t,{id:e}),i&&(s._dirty=!0))},n.preview.bind("settings",function(e){t.each(e,i)}),n.preview.trigger("settings",n.settings.values),t.each(n.settings._dirty,function(e,t){var i=n(t);i&&(i._dirty=!0)}),n.preview.bind("setting",function(e){var t=!0;i.apply(null,e.concat(!0))}),n.preview.bind("sync",function(e){e.settings&&e["settings-modified-while-loading"]&&_.each(_.keys(e.settings),function(t){n.has(t)&&!e["settings-modified-while-loading"][t]&&delete e.settings[t]}),t.each(e,function(e,t){n.preview.trigger(e,t)}),n.preview.send("synced")}),n.preview.bind("active",function(){n.preview.send("nonce",n.settings.nonce),n.preview.send("documentTitle",document.title),n.preview.send("scroll",t(window).scrollTop())}),a=function(e){n.settings.changeset.uuid=e,t(document.body).find("a[href], area").each(function(){n.prepareLinkPreview(this)}),t(document.body).find("form").each(function(){n.prepareFormPreview(this)}),history.replaceState&&history.replaceState(s,"",location.href)},n.preview.bind("changeset-uuid",a),n.preview.bind("saved",function(e){e.next_changeset_uuid&&a(e.next_changeset_uuid),n.trigger("saved",e)}),n.preview.bind("autosaving",function(){n.settings.changeset.autosaved||(n.settings.changeset.autosaved=!0,t(document.body).find("a[href], area").each(function(){n.prepareLinkPreview(this)}),t(document.body).find("form").each(function(){n.prepareFormPreview(this)}),history.replaceState&&history.replaceState(s,"",location.href))}),n.preview.bind("changeset-saved",function(e){_.each(e.saved_changeset_values,function(e,t){var i=n(t);i&&_.isEqual(i.get(),e)&&(i._dirty=!1)})}),n.preview.bind("nonce-refresh",function(e){t.extend(n.settings.nonce,e)}),n.preview.send("ready",{currentUrl:n.settings.url.self,activePanels:n.settings.activePanels,activeSections:n.settings.activeSections,activeControls:n.settings.activeControls,settingValidities:n.settings.settingValidities}),setInterval(n.keepAliveCurrentUrl,n.settings.timeouts.keepAliveSend),n.preview.bind("loading-initiated",function(){t("body").addClass("wp-customizer-unloading")}),n.preview.bind("loading-failed",function(){t("body").removeClass("wp-customizer-unloading")}),e=t.map(["color","image","preset","position_x","position_y","size","repeat","attachment"],function(e){return"background_"+e}),n.when.apply(n,e).done(function(){t.each(arguments,function(){this.bind(n.settingPreviewHandlers.background)})}),n("custom_logo",function(e){n.settingPreviewHandlers.custom_logo.call(e,e.get()),e.bind(n.settingPreviewHandlers.custom_logo)}),n("custom_css["+n.settings.theme.stylesheet+"]",function(e){e.bind(n.settingPreviewHandlers.custom_css)}),n.trigger("preview-ready"))})}(wp,jQuery);