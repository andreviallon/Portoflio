!function(e,t){function n(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}e.Env.ie&&e.Env.ie<9||e.PluginManager.add("wptextpattern",function(a){function r(){var r=a.selection.getRng(),i=r.startContainer,o=r.startOffset,d,c,l,s,f;if(i&&3===i.nodeType&&i.data.length&&o){var u=i.data.slice(0,o),p=i.data.charAt(o-1);e.each(g,function(e){if(p===e.delimiter.slice(-1)){var t=n(e.delimiter),a=e.delimiter.charAt(0),r=new RegExp("(.*)"+t+".+"+t+"$"),i=u.match(r);if(i){d=i[1].length,c=o-e.delimiter.length;var s=u.charAt(d-1),f=u.charAt(d+e.delimiter.length);if(!(d&&/\S/.test(s)&&(/\s/.test(f)||s===a)||new RegExp("^[\\s"+n(a)+"]+$").test(u.slice(d,c))))return l=e,!1}}}),l&&(s=a.formatter.get(l.format))&&s[0].inline&&(a.undoManager.add(),a.undoManager.transact(function(){i.insertData(o,"\ufeff"),i=i.splitText(d),f=i.splitText(o-d),i.deleteData(0,l.delimiter.length),i.deleteData(i.data.length-l.delimiter.length,l.delimiter.length),a.formatter.apply(l.format,{},i),a.selection.setCursorLocation(f,1)}),t(function(){m="space",a.once("selectionchange",function(){var e;f&&-1!==(e=f.data.indexOf("\ufeff"))&&f.deleteData(e,e+1)})}))}}function i(e){var t=a.dom.getParent(e,"p"),n;if(t){for(;(n=t.firstChild)&&3!==n.nodeType;)t=n;if(n)return n.data||(n=n.nextSibling&&3===n.nextSibling.nodeType?n.nextSibling:null),n}}function o(){var n=a.selection.getRng(),r=n.startContainer,o,d;r&&i(r)===r&&(o=r.parentNode,d=r.data,e.each(f,function(e){var i=d.match(e.regExp);if(i&&n.startOffset===i[0].length)return a.undoManager.add(),a.undoManager.transact(function(){r.deleteData(0,i[0].length),o.innerHTML||o.appendChild(document.createElement("br")),a.selection.setCursorLocation(o),a.execCommand(e.cmd)}),t(function(){m="space"}),!1}))}function d(){var n,r=a.selection.getRng().startContainer,o=i(r),d=u.length,l,s,f;if(o){for(l=o.data;d--;)if(u[d].start){if(0===l.indexOf(u[d].start)){s=u[d];break}}else if(u[d].regExp&&u[d].regExp.test(l)){s=u[d];break}s&&(o===r&&e.trim(l)===s.start||a.once("keyup",function(){a.undoManager.add(),a.undoManager.transact(function(){s.format?(a.formatter.apply(s.format,{},o),o.replaceData(0,o.data.length,c(o.data.slice(s.start.length)))):s.element&&(f=o.parentNode&&o.parentNode.parentNode)&&f.replaceChild(document.createElement(s.element),o.parentNode)}),t(function(){m="enter"})}))}}function c(e){return e?e.replace(/^\s+/,""):""}var l=e.util.VK,s=a.settings.wptextpattern||{},f=s.space||[{regExp:/^[*-]\s/,cmd:"InsertUnorderedList"},{regExp:/^1[.)]\s/,cmd:"InsertOrderedList"}],u=s.enter||[{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:">",format:"blockquote"},{regExp:/^(-){3,}$/,element:"hr"}],g=s.inline||[{delimiter:"`",format:"code"}],m;a.on("selectionchange",function(){m=null}),a.on("keydown",function(e){(m&&27===e.keyCode||"space"===m&&e.keyCode===l.BACKSPACE)&&(a.undoManager.undo(),e.preventDefault(),e.stopImmediatePropagation()),l.metaKeyPressed(e)||(e.keyCode===l.ENTER?d():e.keyCode===l.SPACEBAR?t(o):e.keyCode>47&&!(e.keyCode>=91&&e.keyCode<=93)&&t(r))},!0)})}(window.tinymce,window.setTimeout);