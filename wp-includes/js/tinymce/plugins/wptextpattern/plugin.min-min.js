!function(e,t){function n(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}e.Env.ie&&e.Env.ie<9||e.PluginManager.add("wptextpattern",function(a){function r(){var r,i,o,d,c,s=a.selection.getRng(),f=s.startContainer,u=s.startOffset;if(f&&3===f.nodeType&&f.data.length&&u){var g=f.data.slice(0,u),p=f.data.charAt(u-1);e.each(m,function(e){if(p===e.delimiter.slice(-1)){var t=n(e.delimiter),a=e.delimiter.charAt(0),d=new RegExp("(.*)"+t+".+"+t+"$"),c=g.match(d);if(c){r=c[1].length,i=u-e.delimiter.length;var l=g.charAt(r-1),s=g.charAt(r+e.delimiter.length);if(!(r&&/\S/.test(l)&&(/\s/.test(s)||l===a)||new RegExp("^[\\s"+n(a)+"]+$").test(g.slice(r,i))))return o=e,!1}}}),o&&((d=a.formatter.get(o.format))&&d[0].inline&&(a.undoManager.add(),a.undoManager.transact(function(){f.insertData(u,"\ufeff"),f=f.splitText(r),c=f.splitText(u-r),f.deleteData(0,o.delimiter.length),f.deleteData(f.data.length-o.delimiter.length,o.delimiter.length),a.formatter.apply(o.format,{},f),a.selection.setCursorLocation(c,1)}),t(function(){l="space",a.once("selectionchange",function(){var e;c&&(-1!==(e=c.data.indexOf("\ufeff"))&&c.deleteData(e,e+1))})})))}}function i(e){var t,n=a.dom.getParent(e,"p");if(n){for(;(t=n.firstChild)&&3!==t.nodeType;)n=t;if(t)return t.data||(t=t.nextSibling&&3===t.nextSibling.nodeType?t.nextSibling:null),t}}function o(){var n,r,o=a.selection.getRng(),d=o.startContainer;d&&i(d)===d&&(n=d.parentNode,r=d.data,e.each(u,function(e){var i=r.match(e.regExp);if(i&&o.startOffset===i[0].length)return a.undoManager.add(),a.undoManager.transact(function(){d.deleteData(0,i[0].length),n.innerHTML||n.appendChild(document.createElement("br")),a.selection.setCursorLocation(n),a.execCommand(e.cmd)}),t(function(){l="space"}),!1}))}function d(){var n,r,o,d,s=a.selection.getRng().startContainer,f=i(s),u=g.length;if(f){for(n=f.data;u--;)if(g[u].start){if(0===n.indexOf(g[u].start)){r=g[u];break}}else if(g[u].regExp&&g[u].regExp.test(n)){r=g[u];break}r&&(f===s&&e.trim(n)===r.start||a.once("keyup",function(){a.undoManager.add(),a.undoManager.transact(function(){r.format?(a.formatter.apply(r.format,{},f),f.replaceData(0,f.data.length,c(f.data.slice(r.start.length)))):r.element&&((o=f.parentNode&&f.parentNode.parentNode)&&o.replaceChild(document.createElement(r.element),f.parentNode))}),t(function(){l="enter"})}))}}function c(e){return e?e.replace(/^\s+/,""):""}var l,s=e.util.VK,f=a.settings.wptextpattern||{},u=f.space||[{regExp:/^[*-]\s/,cmd:"InsertUnorderedList"},{regExp:/^1[.)]\s/,cmd:"InsertOrderedList"}],g=f.enter||[{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:">",format:"blockquote"},{regExp:/^(-){3,}$/,element:"hr"}],m=f.inline||[{delimiter:"`",format:"code"}];a.on("selectionchange",function(){l=null}),a.on("keydown",function(e){(l&&27===e.keyCode||"space"===l&&e.keyCode===s.BACKSPACE)&&(a.undoManager.undo(),e.preventDefault(),e.stopImmediatePropagation()),s.metaKeyPressed(e)||(e.keyCode===s.ENTER?d():e.keyCode===s.SPACEBAR?t(o):e.keyCode>47&&!(e.keyCode>=91&&e.keyCode<=93)&&t(r))},!0)})}(window.tinymce,window.setTimeout);