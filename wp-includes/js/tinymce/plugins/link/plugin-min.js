!function(){var t=function(){"use strict";function t(){}var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),n=tinymce.util.Tools.resolve("tinymce.util.VK"),o,i,r,a,l,u=function(t){return t.target_list},c,s=function(t){return!1!==u(t)},f=function(t){return t.rel_list},d=function(t){return void 0!==f(t)},v=function(t){return t.link_class_list},m=function(t){return void 0!==v(t)},g,h,x=function(t){return"boolean"==typeof t.link_assume_external_targets&&t.link_assume_external_targets},p=function(t){return"boolean"==typeof t.link_context_toolbar&&t.link_context_toolbar},k=function(t){return t.link_list},y=function(t){return"string"==typeof t.default_link_target},b=function(t){return t.default_link_target},_=u,w=function(t,e){t.settings.target_list=e},T=s,C=f,M=d,O=v,R=m,N=function(t){return!1!==t.link_title},A=function(t){return"boolean"==typeof t.allow_unsafe_link_target&&t.allow_unsafe_link_target},L=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),P=tinymce.util.Tools.resolve("tinymce.Env"),E=function(t,e){document.body.appendChild(t),t.dispatchEvent(e),document.body.removeChild(t)},S,I=function(t){if(!P.ie||P.ie>10){var e=document.createElement("a");e.target="_blank",e.href=t,e.rel="noreferrer noopener";var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),E(e,n)}else{var o=window.open("","_blank");if(o){o.opener=null;var i=o.document;i.open(),i.write('<meta http-equiv="refresh" content="0; url='+L.DOM.encode(t)+'">'),i.close()}}},K=tinymce.util.Tools.resolve("tinymce.util.Tools"),U=function(t,e){var n=["noopener"],o=t?t.split(/\s+/):[],i=function(t){return K.trim(t.sort().join(" "))},r=function(t){return(t=a(t)).length?t.concat(n):n},a=function(t){return t.filter(function(t){return-1===K.inArray(n,t)})};return(o=e?r(o):a(o)).length?i(o):null},D=function(t){return t.replace(/\uFEFF/g,"")},B=function(t,e){return e=e||t.selection.getNode(),H(e)?t.dom.select("a[href]",e)[0]:t.dom.getParent(e,"a[href]")},F,q=function(t){return t&&"A"===t.nodeName&&t.href},V,z,H=function(t){return t&&"FIGURE"===t.nodeName&&/\bimage\b/i.test(t.className)},J=function(t,e){return function(n){t.undoManager.transact(function(){var o=t.selection.getNode(),i=B(t,o),r={href:n.href,target:n.target?n.target:null,rel:n.rel?n.rel:null,class:n.class?n.class:null,title:n.title?n.title:null};M(t.settings)||!1!==A(t.settings)||(r.rel=U(r.rel,"_blank"===r.target)),n.href===e.href&&(e.attach(),e={}),i?(t.focus(),n.hasOwnProperty("text")&&("innerText"in i?i.innerText=n.text:i.textContent=n.text),t.dom.setAttribs(i,r),t.selection.select(i),t.undoManager.add()):H(o)?G(t,o,r):n.hasOwnProperty("text")?t.insertContent(t.dom.createHTML("a",r,t.dom.encode(n.text))):t.execCommand("mceInsertLink",!1,r)})}},$=function(t){return function(){t.undoManager.transact(function(){var e=t.selection.getNode();H(e)?j(t,e):t.execCommand("unlink")})}},j=function(t,e){var n,o;(o=t.dom.select("img",e)[0])&&(n=t.dom.getParents(o,"a[href]",e)[0])&&(n.parentNode.insertBefore(o,n),t.dom.remove(n))},G=function(t,e,n){var o,i;(i=t.dom.select("img",e)[0])&&(o=t.dom.create("a",n),i.parentNode.insertBefore(o,i),o.appendChild(i))},X=J,Q=$,W=q,Y=function(t){return K.grep(t,q).length>0},Z=function(t){return!(/</.test(t)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(t)||-1===t.indexOf("href=")))},tt=B,et=function(t,e){var n=e?e.innerText||e.textContent:t.getContent({format:"text"});return D(n)},nt=U,ot=tinymce.util.Tools.resolve("tinymce.util.Delay"),it=tinymce.util.Tools.resolve("tinymce.util.XHR"),rt={},at=function(t,e){var n=k(t.settings);"string"==typeof n?it.send({url:n,success:function(n){e(t,JSON.parse(n))}}):"function"==typeof n?n(function(n){e(t,n)}):e(t,n)},lt=function(t,e,n){var o=function(t,n){return n=n||[],K.each(t,function(t){var i={text:t.text||t.title};t.menu?i.menu=o(t.menu):(i.value=t.value,e&&e(i)),n.push(i)}),n};return o(t,n||[])},ut=function(t,e,n){var o=t.selection.getRng();ot.setEditorTimeout(t,function(){t.windowManager.confirm(e,function(e){t.selection.setRng(o),n(e)})})},ct=function(t,e){var n={},o=t.selection,i=t.dom,r,a,l,u,c,s,f,d,v,m,g,h=function(t){var e=l.find("#text");(!e.value()||t.lastControl&&e.value()===t.lastControl.text())&&e.value(t.control.text()),l.find("#href").value(t.control.value())},p=function(e){var n=[];if(K.each(t.dom.select("a:not([href])"),function(t){var o=t.name||t.id;o&&n.push({text:o,value:"#"+o,selected:-1!==e.indexOf("#"+o)})}),n.length)return n.unshift({text:"None",value:""}),{name:"anchor",type:"listbox",label:"Anchors",values:n,onselect:h}},k=function(){a||!u||n.text||this.parent().parent().find("#text")[0].value(this.value())},L=function(e){var o=e.meta||{};s&&s.value(t.convertURL(this.value(),"href")),K.each(e.meta,function(t,e){var o=l.find("#"+e);"text"===e?0===a.length&&(o.value(t),n.text=t):o.value(t)}),o.attach&&(rt={href:this.value(),attach:o.attach}),o.text||k.call(this)},P=function(t){t.meta=l.toJSON()};u=Z(o.getContent()),r=tt(t),n.text=a=et(t.selection,r),n.href=r?i.getAttrib(r,"href"):"",r?n.target=i.getAttrib(r,"target"):y(t.settings)&&(n.target=b(t.settings)),(g=i.getAttrib(r,"rel"))&&(n.rel=g),(g=i.getAttrib(r,"class"))&&(n.class=g),(g=i.getAttrib(r,"title"))&&(n.title=g),u&&(c={name:"text",type:"textbox",size:40,label:"Text to display",onchange:function(){n.text=this.value()}}),e&&(s={type:"listbox",label:"Link list",values:lt(e,function(e){e.value=t.convertURL(e.value||e.url,"href")},[{text:"None",value:""}]),onselect:h,value:t.convertURL(n.href,"href"),onPostRender:function(){s=this}}),T(t.settings)&&(void 0===_(t.settings)&&w(t,[{text:"None",value:""},{text:"New window",value:"_blank"}]),d={name:"target",type:"listbox",label:"Target",values:lt(_(t.settings))}),M(t.settings)&&(f={name:"rel",type:"listbox",label:"Rel",values:lt(C(t.settings),function(e){!1===A(t.settings)&&(e.value=nt(e.value,"_blank"===n.target))})}),R(t.settings)&&(v={name:"class",type:"listbox",label:"Class",values:lt(O(t.settings),function(e){e.value&&(e.textStyle=function(){return t.formatter.getCssText({inline:"a",classes:[e.value]})})})}),N(t.settings)&&(m={name:"title",type:"textbox",label:"Title",value:n.title}),l=t.windowManager.open({title:"Insert link",data:n,body:[{name:"href",type:"filepicker",filetype:"file",size:40,autofocus:!0,label:"Url",onchange:L,onkeyup:k,onpaste:k,onbeforecall:P},c,m,p(n.href),s,f,d,v],onSubmit:function(e){var o=x(t.settings),i=X(t,rt),r=Q(t),l=K.extend({},n,e.data),c=l.href;c?(u&&l.text!==a||delete l.text,c.indexOf("@")>0&&-1===c.indexOf("//")&&-1===c.indexOf("mailto:")?ut(t,"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",function(t){t&&(l.href="mailto:"+c),i(l)}):!0===o&&!/^\w+:/i.test(c)||!1===o&&/^\s*www[\.|\d\.]/i.test(c)?ut(t,"The URL you entered seems to be an external link. Do you want to add the required http:// prefix?",function(t){t&&(l.href="http://"+c),i(l)}):i(l)):r()}})},st,ft=function(t){at(t,ct)},dt=function(t,e){return t.dom.getParent(e,"a[href]")},vt=function(t){return dt(t,t.selection.getStart())},mt=function(t){var e=t.getAttribute("data-mce-href");return e||t.getAttribute("href")},gt=function(t){var e=t.plugins.contextmenu;return!!e&&e.isContextMenuVisible()},ht=function(t){return!0===t.altKey&&!1===t.shiftKey&&!1===t.ctrlKey&&!1===t.metaKey},xt=function(t,e){if(e){var n=mt(e);if(/^#/.test(n)){var o=t.$(n);o.length&&t.selection.scrollIntoView(o[0],!0)}else I(e.href)}},pt,kt,yt,bt,_t,wt,Tt=function(t){return function(){ft(t)}},Ct=function(t){return function(){xt(t,vt(t))}},Mt=function(t){return function(e){var n,o,i;return!!(p(t.settings)&&!gt(t)&&W(e)&&3===(i=(o=(n=t.selection).getRng()).startContainer).nodeType&&n.isCollapsed()&&o.startOffset>0&&o.startOffset<i.data.length)}},Ot=function(t){t.on("click",function(e){var o=dt(t,e.target);o&&n.metaKeyPressed(e)&&(e.preventDefault(),xt(t,o))}),t.on("keydown",function(e){var n=vt(t);n&&13===e.keyCode&&ht(e)&&(e.preventDefault(),xt(t,n))})},Rt=function(t){return function(){var e=this;t.on("nodechange",function(n){e.active(!t.readonly&&!!tt(t,n.element))})}},Nt=function(t){return function(){var e=this,n=function(t){Y(t.parents)?e.show():e.hide()};Y(t.dom.getParents(t.selection.getStart()))||e.hide(),t.on("nodechange",n),e.on("remove",function(){t.off("nodechange",n)})}},At,Lt=function(t){t.addCommand("mceLink",Tt(t))},Pt,Et=function(t){t.addShortcut("Meta+K","",Tt(t))},St,It,Kt,Ut=function(t){t.addButton("link",{active:!1,icon:"link",tooltip:"Insert/edit link",onclick:Tt(t),onpostrender:Rt(t)}),t.addButton("unlink",{active:!1,icon:"unlink",tooltip:"Remove link",onclick:Q(t),onpostrender:Rt(t)}),t.addContextToolbar&&t.addButton("openlink",{icon:"newtab",tooltip:"Open link",onclick:Ct(t)})},Dt=function(t){t.addMenuItem("openlink",{text:"Open link",icon:"newtab",onclick:Ct(t),onPostRender:Nt(t),prependToContext:!0}),t.addMenuItem("link",{icon:"link",text:"Link",shortcut:"Meta+K",onclick:Tt(t),stateSelector:"a[href]",context:"insert",prependToContext:!0}),t.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onclick:Q(t),stateSelector:"a[href]"})},Bt=function(t){t.addContextToolbar&&t.addContextToolbar(Mt(t),"openlink | link unlink")};return e.add("link",function(t){Ut(t),Dt(t),Bt(t),Ot(t),Lt(t),Et(t)}),t}()}();