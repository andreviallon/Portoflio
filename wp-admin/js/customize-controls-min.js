!function(e,t){var n,i,a,s=wp.customize,o,r,c,l;s.OverlayNotification=s.Notification.extend({loading:!1,initialize:function(e,t){var n=this;s.Notification.prototype.initialize.call(this,e,t),this.containerClasses+=" notification-overlay",this.loading&&(this.containerClasses+=" notification-loading")},render:function(){var e=s.Notification.prototype.render.call(this);return e.on("keydown",_.bind(this.handleEscape,this)),e},handleEscape:function(e){var t=this;27===e.which&&(e.stopPropagation(),this.dismissible&&this.parent&&this.parent.remove(this.code))}}),s.Notifications=s.Values.extend({alt:!1,defaultConstructor:s.Notification,initialize:function(e){var t=this;s.Values.prototype.initialize.call(t,e),_.bindAll(t,"constrainFocus"),t._addedIncrement=0,t._addedOrder={},t.bind("add",function(e){t.trigger("change",e)}),t.bind("removed",function(e){t.trigger("change",e)})},count:function(){return _.size(this._value)},add:function(e,t){var n=this,i,a;return"string"==typeof e?(i=e,a=t):(i=e.code,a=e),this.has(i)||(this._addedIncrement+=1,this._addedOrder[i]=this._addedIncrement),s.Values.prototype.add.call(this,i,a)},remove:function(e){var t=this;return delete this._addedOrder[e],s.Values.prototype.remove.call(this,e)},get:function(e){var t=this,n,i,a;return n=_.values(t._value),(a=_.extend({sort:!1},e)).sort&&(i={error:4,warning:3,success:2,info:1},n.sort(function(e,n){var a=0,s=0;return _.isUndefined(i[e.type])||(a=i[e.type]),_.isUndefined(i[n.type])||(s=i[n.type]),a!==s?s-a:t._addedOrder[n.code]-t._addedOrder[e.code]})),n},render:function(){var e=this,n,i=!1,a,o=[],r={},c,l;this.container&&this.container.length&&(n=this.get({sort:!0}),this.container.toggle(0!==n.length),this.container.is(this.previousContainer)&&_.isEqual(n,this.previousNotifications)||((c=this.container.children("ul").first()).length||(c=t("<ul></ul>"),this.container.append(c)),c.find("> [data-code]").remove(),_.each(this.previousNotifications,function(e){r[e.code]=e}),_.each(n,function(e){var n;!wp.a11y||r[e.code]&&_.isEqual(e.message,r[e.code].message)||wp.a11y.speak(e.message,"assertive"),n=t(e.render()),e.container=n,c.append(n),e.extended(s.OverlayNotification)&&o.push(e)}),a=Boolean(o.length),this.previousNotifications&&(i=Boolean(_.find(this.previousNotifications,function(e){return e.extended(s.OverlayNotification)}))),a!==i&&(t(document.body).toggleClass("customize-loading",a),this.container.toggleClass("has-overlay-notifications",a),a?(this.previousActiveElement=document.activeElement,t(document).on("keydown",this.constrainFocus)):t(document).off("keydown",this.constrainFocus)),a?(this.focusContainer=o[o.length-1].container,this.focusContainer.prop("tabIndex",-1),(l=this.focusContainer.find(":focusable")).length?l.first().focus():this.focusContainer.focus()):this.previousActiveElement&&(t(this.previousActiveElement).focus(),this.previousActiveElement=null),this.previousNotifications=n,this.previousContainer=this.container,this.trigger("rendered")))},constrainFocus:function e(n){var i=this,a;n.stopPropagation(),9===n.which&&(0===(a=this.focusContainer.find(":focusable")).length&&(a=this.focusContainer),t.contains(this.focusContainer[0],n.target)&&t.contains(this.focusContainer[0],document.activeElement)?a.last().is(n.target)&&!n.shiftKey?(n.preventDefault(),a.first().focus()):a.first().is(n.target)&&n.shiftKey&&(n.preventDefault(),a.last().focus()):(n.preventDefault(),a.first().focus()))}}),s.Setting=s.Value.extend({defaults:{transport:"refresh",dirty:!1},initialize:function(e,t,n){var i=this,a;a=_.extend({previewer:s.previewer},this.defaults,n||{}),s.Value.prototype.initialize.call(this,t,a),this.id=e,this._dirty=a.dirty,this.notifications=new s.Notifications,this.bind(this.preview)},preview:function(){var e=this,t;"postMessage"!==(t=this.transport)||s.state("previewerAlive").get()||(t="refresh"),"postMessage"===t?this.previewer.send("setting",[this.id,this()]):"refresh"===t&&this.previewer.refresh()},findControls:function(){var e=this,t=[];return s.control.each(function(n){_.each(n.settings,function(i){i.id===e.id&&t.push(n)})}),t}}),s._latestRevision=0,s._lastSavedRevision=0,s._latestSettingRevisions={},s.bind("change",function e(t){s._latestRevision+=1,s._latestSettingRevisions[t.id]=s._latestRevision}),s.bind("ready",function(){s.bind("add",function e(t){t._dirty&&(s._latestRevision+=1,s._latestSettingRevisions[t.id]=s._latestRevision)})}),s.dirtyValues=function e(t){var n={};return s.each(function(e){var i;e._dirty&&(i=s._latestSettingRevisions[e.id],s.state("changesetStatus").get()&&t&&t.unsaved&&(_.isUndefined(i)||i<=s._lastSavedRevision)||(n[e.id]=e.get()))}),n},s.requestChangesetUpdate=function e(n,i){var a,o,r={},c,l;return a=new t.Deferred,0!==s.state("processing").get()?(a.reject("already_processing"),a.promise()):(l=_.extend({title:null,date:null,autosave:!1,force:!1},i),n&&_.extend(r,n),_.each(s.dirtyValues({unsaved:!0}),function(e,t){n&&null===n[t]||(r[t]=_.extend({},r[t]||{},{value:e}))}),s.trigger("changeset-save",r,l),!l.force&&_.isEmpty(r)&&null===l.title&&null===l.date?(a.resolve({}),a.promise()):l.status?a.reject({code:"illegal_status_in_changeset_update"}).promise():l.date&&l.autosave?a.reject({code:"illegal_autosave_with_date_gmt"}).promise():(s.state("processing").set(s.state("processing").get()+1),a.always(function(){s.state("processing").set(s.state("processing").get()-1)}),delete(c=s.previewer.query({excludeCustomizedSaved:!0})).customized,_.extend(c,{nonce:s.settings.nonce.save,customize_theme:s.settings.theme.stylesheet,customize_changeset_data:JSON.stringify(r)}),null!==l.title&&(c.customize_changeset_title=l.title),null!==l.date&&(c.customize_changeset_date=l.date),!1!==l.autosave&&(c.customize_changeset_autosave="true"),s.trigger("save-request-params",c),(o=wp.ajax.post("customize_save",c)).done(function e(t){var n={};s._lastSavedRevision=Math.max(s._latestRevision,s._lastSavedRevision),s.state("changesetStatus").set(t.changeset_status),t.changeset_date&&s.state("changesetDate").set(t.changeset_date),a.resolve(t),s.trigger("changeset-saved",t),t.setting_validities&&_.each(t.setting_validities,function(e,t){!0===e&&_.isObject(r[t])&&!_.isUndefined(r[t].value)&&(n[t]=r[t].value)}),s.previewer.send("changeset-saved",_.extend({},t,{saved_changeset_values:n}))}),o.fail(function e(t){a.reject(t),s.trigger("changeset-error",t)}),o.always(function(e){e.setting_validities&&s._handleSettingValidities({settingValidities:e.setting_validities})}),a.promise()))},s.utils.bubbleChildValueChanges=function(e,n){t.each(n,function(t,n){e[n].bind(function(t,n){e.parent&&t!==n&&e.parent.trigger("change",e)})})},i=function(e){var t,n,i,a;t=this,i=function(){var e;e=(t.extended(s.Panel)||t.extended(s.Section))&&t.expanded&&t.expanded()?t.contentContainer:t.container,0===(a=e.find(".control-focus:first")).length&&(a=e.find("input, select, textarea, button, object, a[href], [tabindex]").filter(":visible").first()),a.focus()},(e=e||{}).completeCallback?(n=e.completeCallback,e.completeCallback=function(){i(),n()}):e.completeCallback=i,s.state("paneVisible").set(!0),t.expand?t.expand(e):e.completeCallback()},s.utils.prioritySort=function(e,t){return e.priority()===t.priority()&&"number"==typeof e.params.instanceNumber&&"number"==typeof t.params.instanceNumber?e.params.instanceNumber-t.params.instanceNumber:e.priority()-t.priority()},s.utils.isKeydownButNotEnterEvent=function(e){return"keydown"===e.type&&13!==e.which},s.utils.areElementListsEqual=function(e,n){var i;return e.length===n.length&&-1===_.indexOf(_.map(_.zip(e,n),function(e){return t(e[0]).is(e[1])}),!1)},s.utils.highlightButton=function e(t,n){function i(){s=!0}var a="button-see-me",s=!1,o;return(o=_.extend({delay:0,focusTarget:t},n)).focusTarget.on("focusin",i),setTimeout(function(){o.focusTarget.off("focusin",i),s||(t.addClass(a),t.one("animationend",function(){t.removeClass(a)}))},o.delay),i},s.utils.getCurrentTimestamp=function e(){var t,n,i;return n=_.now(),t=new Date(s.settings.initialServerDate.replace(/-/g,"/")),i=n-s.settings.initialClientTimestamp,i+=s.settings.initialClientTimestamp-s.settings.initialServerTimestamp,t.setTime(t.getTime()+i),t.getTime()},s.utils.getRemainingTime=function e(t){var n=1e3,i,a;return i=(a=t instanceof Date?t.getTime():"string"==typeof t?new Date(t.replace(/-/g,"/")).getTime():t)-s.utils.getCurrentTimestamp(),i=Math.ceil(i/1e3)},o=document.createElement("div"),r={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"},a=(c=_.find(_.keys(r),function(e){return!_.isUndefined(o.style[e])}))?r[c]:null,n=s.Class.extend({defaultActiveArguments:{duration:"fast",completeCallback:t.noop},defaultExpandedArguments:{duration:"fast",completeCallback:t.noop},containerType:"container",defaults:{title:"",description:"",priority:100,type:"default",content:null,active:!0,instanceNumber:null},initialize:function(e,i){var a=this;a.id=e,n.instanceCounter||(n.instanceCounter=0),n.instanceCounter++,t.extend(a,{params:_.defaults(i.params||i,a.defaults)}),a.params.instanceNumber||(a.params.instanceNumber=n.instanceCounter),a.notifications=new s.Notifications,a.templateSelector=a.params.templateId||"customize-"+a.containerType+"-"+a.params.type,a.container=t(a.params.content),0===a.container.length&&(a.container=t(a.getContainer())),a.headContainer=a.container,a.contentContainer=a.getContent(),a.container=a.container.add(a.contentContainer),a.deferred={embedded:new t.Deferred},a.priority=new s.Value,a.active=new s.Value,a.activeArgumentsQueue=[],a.expanded=new s.Value,a.expandedArgumentsQueue=[],a.active.bind(function(e){var n=a.activeArgumentsQueue.shift();n=t.extend({},a.defaultActiveArguments,n),e=e&&a.isContextuallyActive(),a.onChangeActive(e,n)}),a.expanded.bind(function(e){var n=a.expandedArgumentsQueue.shift();n=t.extend({},a.defaultExpandedArguments,n),a.onChangeExpanded(e,n)}),a.deferred.embedded.done(function(){a.setupNotifications(),a.attachEvents()}),s.utils.bubbleChildValueChanges(a,["priority","active"]),a.priority.set(a.params.priority),a.active.set(a.params.active),a.expanded.set(!1)},getNotificationsContainerElement:function(){var e=this;return this.contentContainer.find(".customize-control-notifications-container:first")},setupNotifications:function(){var e=this,t;e.notifications.container=e.getNotificationsContainerElement(),t=function(){e.expanded.get()&&e.notifications.render()},e.expanded.bind(t),t(),e.notifications.bind("change",_.debounce(t))},ready:function(){},_children:function(e,t){var n=this,i=[];return s[t].each(function(t){t[e].get()===n.id&&i.push(t)}),i.sort(s.utils.prioritySort),i},isContextuallyActive:function(){throw new Error("Container.isContextuallyActive() must be overridden in a subclass.")},onChangeActive:function(e,n){var i=this,a=i.headContainer,o,r;n.unchanged?n.completeCallback&&n.completeCallback():(o="resolved"===s.previewer.deferred.active.state()?n.duration:0,i.extended(s.Panel)&&(s.panel.each(function(e){e!==i&&e.expanded()&&(r=e,o=0)}),e||_.each(i.sections(),function(e){e.collapse({duration:0})})),t.contains(document,a.get(0))?e?a.slideDown(o,n.completeCallback):i.expanded()?i.collapse({duration:o,completeCallback:function(){a.slideUp(o,n.completeCallback)}}):a.slideUp(o,n.completeCallback):(a.toggle(e),n.completeCallback&&n.completeCallback()))},_toggleActive:function(e,t){var n=this;return t=t||{},e&&this.active.get()||!e&&!this.active.get()?(t.unchanged=!0,this.onChangeActive(this.active.get(),t),!1):(t.unchanged=!1,this.activeArgumentsQueue.push(t),this.active.set(e),!0)},activate:function(e){return this._toggleActive(!0,e)},deactivate:function(e){return this._toggleActive(!1,e)},onChangeExpanded:function(){throw new Error("Must override with subclass.")},_toggleExpanded:function(e,t){var n=this,i;return i=(t=t||{}).completeCallback,!(e&&!n.active())&&(s.state("paneVisible").set(!0),t.completeCallback=function(){i&&i.apply(n,arguments),e?n.container.trigger("expanded"):n.container.trigger("collapsed")},e&&n.expanded.get()||!e&&!n.expanded.get()?(t.unchanged=!0,n.onChangeExpanded(n.expanded.get(),t),!1):(t.unchanged=!1,n.expandedArgumentsQueue.push(t),n.expanded.set(e),!0))},expand:function(e){return this._toggleExpanded(!0,e)},collapse:function(e){return this._toggleExpanded(!1,e)},_animateChangeExpanded:function(e){if(a){var n=this,i=n.contentContainer,o=i.closest(".wp-full-overlay"),r,c,l;r=o.add(i),(l=!n.panel||""===n.panel()||!!s.panel(n.panel()).contentContainer.hasClass("skip-transition"))&&(r=r.add("#customize-info, .customize-pane-parent")),c=function(n){2===n.eventPhase&&t(n.target).is(i)&&(i.off(a,c),r.removeClass("busy"),e&&e())},i.on(a,c),r.addClass("busy"),_.defer(function(){var e=i.closest(".wp-full-overlay-sidebar-content"),t=e.scrollTop(),a=i.data("previous-scrollTop")||0,s=n.expanded();s&&0<t?(i.css("top",t+"px"),i.data("previous-scrollTop",t)):!s&&0<t+a&&(i.css("top",a-t+"px"),e.scrollTop(a))})}else e&&e()},focus:i,getContainer:function(){var e,n=this;return(e=0!==t("#tmpl-"+this.templateSelector).length?wp.template(this.templateSelector):wp.template("customize-"+this.containerType+"-default"))&&this.container?t.trim(e(_.extend({id:this.id},this.params))):"<li></li>"},getContent:function(){var e=this,t=this.container,n=t.find(".accordion-section-content, .control-panel-content").first(),i="sub-"+t.attr("id"),a=i,s=t.attr("aria-owns");return s&&(a=a+" "+s),t.attr("aria-owns",a),n.detach().attr({id:i,class:"customize-pane-child "+n.attr("class")+" "+t.attr("class")})}}),s.Section=n.extend({containerType:"section",containerParent:"#customize-theme-controls",containerPaneParent:".customize-pane-parent",defaults:{title:"",description:"",priority:100,type:"default",content:null,active:!0,instanceNumber:null,panel:null,customizeAction:""},initialize:function(e,i){var a=this,o;(o=i.params||i).type||_.find(s.sectionConstructor,function(e,t){return e===a.constructor&&(o.type=t,!0)}),n.prototype.initialize.call(a,e,o),a.id=e,a.panel=new s.Value,a.panel.bind(function(e){t(a.headContainer).toggleClass("control-subsection",!!e)}),a.panel.set(a.params.panel||""),s.utils.bubbleChildValueChanges(a,["panel"]),a.embed(),a.deferred.embedded.done(function(){a.ready()})},embed:function(){var e,t=this;t.containerParent=s.ensure(t.containerParent),e=function(e){var n;e?s.panel(e,function(e){e.deferred.embedded.done(function(){n=e.contentContainer,t.headContainer.parent().is(n)||n.append(t.headContainer),t.contentContainer.parent().is(t.headContainer)||t.containerParent.append(t.contentContainer),t.deferred.embedded.resolve()})}):(n=s.ensure(t.containerPaneParent),t.headContainer.parent().is(n)||n.append(t.headContainer),t.contentContainer.parent().is(t.headContainer)||t.containerParent.append(t.contentContainer),t.deferred.embedded.resolve())},t.panel.bind(e),e(t.panel.get())},attachEvents:function(){var e,n,i=this;i.container.hasClass("cannot-expand")||(i.container.find(".accordion-section-title, .customize-section-back").on("click keydown",function(e){s.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),i.expanded()?i.collapse():i.expand())}),i.container.find(".customize-section-title .customize-help-toggle").on("click",function(){(e=i.container.find(".section-meta")).hasClass("cannot-expand")||((n=e.find(".customize-section-description:first")).toggleClass("open"),n.slideToggle(i.defaultExpandedArguments.duration,function(){n.trigger("toggled")}),t(this).attr("aria-expanded",function(e,t){return"true"===t?"false":"true"}))}))},isContextuallyActive:function(){var e=this,t=this.controls(),n=0;return _(t).each(function(e){e.active()&&(n+=1)}),0!==n},controls:function(){return this._children("section","control")},onChangeExpanded:function(e,n){var i=this,a=i.headContainer.closest(".wp-full-overlay-sidebar-content"),o=i.contentContainer,r=i.headContainer.closest(".wp-full-overlay"),c=o.find(".customize-section-back"),l=i.headContainer.find(".accordion-section-title").first(),d,u;e&&!o.hasClass("open")?(d=n.unchanged?n.completeCallback:t.proxy(function(){i._animateChangeExpanded(function(){l.attr("tabindex","-1"),c.attr("tabindex","0"),c.focus(),o.css("top",""),a.scrollTop(0),n.completeCallback&&n.completeCallback()}),o.addClass("open"),r.addClass("section-open"),s.state("expandedSection").set(i)},this),n.allowMultiple||s.section.each(function(e){e!==i&&e.collapse({duration:n.duration})}),i.panel()?s.panel(i.panel()).expand({duration:n.duration,completeCallback:d}):(n.allowMultiple||s.panel.each(function(e){e.collapse()}),d())):!e&&o.hasClass("open")?(i.panel()&&(u=s.panel(i.panel())).contentContainer.hasClass("skip-transition")&&u.collapse(),i._animateChangeExpanded(function(){c.attr("tabindex","-1"),l.attr("tabindex","0"),l.focus(),o.css("top",""),n.completeCallback&&n.completeCallback()}),o.removeClass("open"),r.removeClass("section-open"),i===s.state("expandedSection").get()&&s.state("expandedSection").set(!1)):n.completeCallback&&n.completeCallback()}}),s.ThemesSection=s.Section.extend({currentTheme:"",overlay:"",template:"",screenshotQueue:null,$window:null,$body:null,loaded:0,loading:!1,fullyLoaded:!1,term:"",tags:"",nextTerm:"",nextTags:"",filtersHeight:0,headerContainer:null,updateCountDebounced:null,initialize:function(e,n){var i=this;this.headerContainer=t(),this.$window=t(window),this.$body=t(document.body),s.Section.prototype.initialize.call(this,e,n),this.updateCountDebounced=_.debounce(this.updateCount,500)},embed:function(){var e,t=this;e=function(e){var n;s.panel(e,function(e){e.deferred.embedded.done(function(){n=e.contentContainer,t.headContainer.parent().is(n)||n.find(".customize-themes-full-container-container").before(t.headContainer),t.contentContainer.parent().is(t.headContainer)||t.containerParent.append(t.contentContainer),t.deferred.embedded.resolve()})})},t.panel.bind(e),e(t.panel.get())},ready:function(){var e=this;e.overlay=e.container.find(".theme-overlay"),e.template=wp.template("customize-themes-details-view"),e.container.on("keydown",function(t){e.overlay.find(".theme-wrap").is(":visible")&&(39===t.keyCode&&e.nextTheme(),37===t.keyCode&&e.previousTheme(),27===t.keyCode&&(e.$body.hasClass("modal-open")?e.closeDetails():e.headerContainer.find(".customize-themes-section-title").focus(),t.stopPropagation()))}),e.renderScreenshots=_.throttle(e.renderScreenshots,100),_.bindAll(e,"renderScreenshots","loadMore","checkTerm","filtersChecked")},isContextuallyActive:function(){return this.active()},attachEvents:function(){function e(){var e=n.headerContainer.find(".customize-themes-section-title");e.toggleClass("selected",n.expanded()),e.attr("aria-expanded",n.expanded()?"true":"false"),n.expanded()||e.removeClass("details-open")}var n=this,i;n.container.find(".customize-section-back").on("click keydown",function(e){s.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),n.collapse())}),n.headerContainer=t("#accordion-section-"+n.id),n.headerContainer.on("click",".customize-themes-section-title",function(){n.headerContainer.find(".filter-details").length&&(n.headerContainer.find(".customize-themes-section-title").toggleClass("details-open").attr("aria-expanded",function(e,t){return"true"===t?"false":"true"}),n.headerContainer.find(".filter-details").slideToggle(180)),n.expanded()||n.expand()}),n.container.on("click",".theme-actions .preview-theme",function(){s.panel("themes").loadThemePreview(t(this).data("slug"))}),n.container.on("click",".left",function(){n.previousTheme()}),n.container.on("click",".right",function(){n.nextTheme()}),n.container.on("click",".theme-backdrop, .close",function(){n.closeDetails()}),"local"===n.params.filter_type?n.container.on("input",".wp-filter-search-themes",function(e){n.filterSearch(e.currentTarget.value)}):"remote"===n.params.filter_type&&(i=_.debounce(n.checkTerm,500),n.contentContainer.on("input",".wp-filter-search",function(){s.panel("themes").expanded()&&(i(n),n.expanded()||n.expand())}),n.contentContainer.on("click",".filter-group input",function(){n.filtersChecked(),n.checkTerm(n)})),n.contentContainer.on("click",".feature-filter-toggle",function(e){var i=t(".customize-themes-full-container"),a=t(e.currentTarget);if(n.filtersHeight=a.parent().next(".filter-drawer").height(),!(0<i.scrollTop()&&(i.animate({scrollTop:0},400),a.hasClass("open"))))if(a.toggleClass("open").attr("aria-expanded",function(e,t){return"true"===t?"false":"true"}).parent().next(".filter-drawer").slideToggle(180,"linear"),a.hasClass("open")){var s=1018<window.innerWidth?50:76;n.contentContainer.find(".themes").css("margin-top",n.filtersHeight+s)}else n.contentContainer.find(".themes").css("margin-top",0)}),n.contentContainer.on("click",".no-themes-local .search-dotorg-themes",function(){s.section("wporg_themes").focus()}),n.expanded.bind(e),e(),s.bind("ready",function(){n.contentContainer=n.container.find(".customize-themes-section"),n.contentContainer.appendTo(t(".customize-themes-full-container")),n.container.add(n.headerContainer)})},onChangeExpanded:function(e,t){function n(){0===i.loaded&&i.loadThemes(),s.section.each(function(e){var n;e!==i&&"themes"===e.params.type&&(n=e.contentContainer.find(".wp-filter-search").val(),i.contentContainer.find(".wp-filter-search").val(n),""===n&&""!==i.term&&"local"!==i.params.filter_type?(i.term="",i.initializeNewQuery(i.term,i.tags)):"remote"===i.params.filter_type?i.checkTerm(i):"local"===i.params.filter_type&&i.filterSearch(n),e.collapse({duration:t.duration}))}),i.contentContainer.addClass("current-section"),a.scrollTop(),a.on("scroll",_.throttle(i.renderScreenshots,300)),a.on("scroll",_.throttle(i.loadMore,300)),t.completeCallback&&t.completeCallback(),i.updateCount()}var i=this,a=i.contentContainer.closest(".customize-themes-full-container");t.unchanged?t.completeCallback&&t.completeCallback():e?i.panel()&&s.panel.has(i.panel())?s.panel(i.panel()).expand({duration:t.duration,completeCallback:n}):n():(i.contentContainer.removeClass("current-section"),i.headerContainer.find(".filter-details").slideUp(180),a.off("scroll"),t.completeCallback&&t.completeCallback())},getContent:function(){return this.container.find(".control-section-content")},loadThemes:function(){var e=this,t,n,i;e.loading||(n=Math.ceil(e.loaded/100)+1,t={nonce:s.settings.nonce.switch_themes,wp_customize:"on",theme_action:e.params.action,customized_theme:s.settings.theme.stylesheet,page:n},"remote"===e.params.filter_type&&(t.search=e.term,t.tags=e.tags),e.headContainer.closest(".wp-full-overlay").addClass("loading"),e.loading=!0,e.container.find(".no-themes").hide(),(i=wp.ajax.post("customize_load_themes",t)).done(function(t){var i=t.themes;if(""!==e.nextTerm||""!==e.nextTags)return e.nextTerm&&(e.term=e.nextTerm),e.nextTags&&(e.tags=e.nextTags),e.nextTerm="",e.nextTags="",e.loading=!1,void e.loadThemes();0!==i.length?(e.loadControls(i,n),1===n&&(_.each(e.controls().slice(0,3),function(e){var t,n=e.params.theme.screenshot[0];n&&((t=new Image).src=n)}),"local"!==e.params.filter_type&&wp.a11y.speak(s.settings.l10n.themeSearchResults.replace("%d",t.info.results))),_.delay(e.renderScreenshots,100),("local"===e.params.filter_type||100>i.length)&&(e.fullyLoaded=!0)):0===e.loaded?(e.container.find(".no-themes").show(),wp.a11y.speak(e.container.find(".no-themes").text())):e.fullyLoaded=!0,"local"===e.params.filter_type?e.updateCount():e.updateCount(t.info.results),e.container.find(".unexpected-error").hide(),e.headContainer.closest(".wp-full-overlay").removeClass("loading"),e.loading=!1}),i.fail(function(t){void 0===t?(e.container.find(".unexpected-error").show(),wp.a11y.speak(e.container.find(".unexpected-error").text())):"undefined"!=typeof console&&console.error&&console.error(t),e.headContainer.closest(".wp-full-overlay").removeClass("loading"),e.loading=!1}))},loadControls:function(e,t){var n=[],i=this;_.each(e,function(e){var t=new s.controlConstructor.theme(i.params.action+"_theme_"+e.id,{type:"theme",section:i.params.id,theme:e,priority:i.loaded+1});s.control.add(t),n.push(t),i.loaded=i.loaded+1}),1!==t&&Array.prototype.push.apply(i.screenshotQueue,n)},loadMore:function(){var e=this,t,n,i;this.fullyLoaded||this.loading||(n=(t=this.container.closest(".customize-themes-full-container")).scrollTop()+t.height())>(i=t.prop("scrollHeight")-3e3)&&this.loadThemes()},filterSearch:function(e){var t=0,n=!1,i=this,a=s.section.has("wporg_themes")&&"remote"!==this.params.filter_type?".no-themes-local":".no-themes",o=this.controls(),r;this.loading||(r=e.toLowerCase().trim().replace(/-/g," ").split(" "),_.each(o,function(e){(n=e.filter(r))&&(t+=1)}),0===t?(this.container.find(a).show(),wp.a11y.speak(this.container.find(a).text())):this.container.find(a).hide(),this.renderScreenshots(),s.reflowPaneContents(),this.updateCountDebounced(t))},checkTerm:function(e){var t;"remote"===e.params.filter_type&&(t=e.contentContainer.find(".wp-filter-search").val(),e.term!==t.trim()&&e.initializeNewQuery(t,e.tags))},filtersChecked:function(){var e=this,n=this.container.find(".filter-group").find(":checkbox"),i=[];_.each(n.filter(":checked"),function(e){i.push(t(e).prop("value"))}),0===i.length?(i="",this.contentContainer.find(".feature-filter-toggle .filter-count-0").show(),this.contentContainer.find(".feature-filter-toggle .filter-count-filters").hide()):(this.contentContainer.find(".feature-filter-toggle .theme-filter-count").text(i.length),this.contentContainer.find(".feature-filter-toggle .filter-count-0").hide(),this.contentContainer.find(".feature-filter-toggle .filter-count-filters").show()),_.isEqual(this.tags,i)||(this.loading?this.nextTags=i:"remote"===this.params.filter_type?this.initializeNewQuery(this.term,i):"local"===this.params.filter_type&&this.filterSearch(i.join(" ")))},initializeNewQuery:function(e,t){var n=this;_.each(this.controls(),function(e){e.container.remove(),s.control.remove(e.id)}),this.loaded=0,this.fullyLoaded=!1,this.screenshotQueue=null,this.loading?(this.nextTerm=e,this.nextTags=t):(this.term=e,this.tags=t,this.loadThemes()),this.expanded()||this.expand()},renderScreenshots:function(){var e=this;null!==e.screenshotQueue&&0!==e.screenshotQueue.length||(e.screenshotQueue=_.filter(e.controls(),function(e){return!e.screenshotRendered})),e.screenshotQueue.length&&(e.screenshotQueue=_.filter(e.screenshotQueue,function(t){var n=t.container.find(".theme-screenshot"),i=n.find("img");if(!i.length)return!1;if(i.is(":hidden"))return!0;var a=e.$window.scrollTop(),s=a+e.$window.height(),o=i.offset().top,r=n.height(),c,l=3*r,d=o+r>=a-l&&o<=s+l;return d&&t.container.trigger("render-screenshot"),!d}))},getVisibleCount:function(){return this.contentContainer.find("li.customize-control:visible").length},updateCount:function(e){var t=this,n,i;e||0===e||(e=this.getVisibleCount()),i=this.contentContainer.find(".themes-displayed"),n=this.contentContainer.find(".theme-count"),0===e?n.text("0"):(i.fadeOut(180,function(){n.text(e),i.fadeIn(180)}),wp.a11y.speak(s.settings.l10n.announceThemeCount.replace("%d",e)))},nextTheme:function(){var e=this;e.getNextTheme()&&e.showDetails(e.getNextTheme(),function(){e.overlay.find(".right").focus()})},getNextTheme:function(){var e=this,t,n,i,a;return t=s.control(this.params.action+"_theme_"+this.currentTheme),i=this.controls(),-1!==(a=_.indexOf(i,t))&&(!!(n=i[a+1])&&n.params.theme)},previousTheme:function(){var e=this;e.getPreviousTheme()&&e.showDetails(e.getPreviousTheme(),function(){e.overlay.find(".left").focus()})},getPreviousTheme:function(){var e=this,t,n,i,a;return t=s.control(this.params.action+"_theme_"+this.currentTheme),i=this.controls(),-1!==(a=_.indexOf(i,t))&&(!!(n=i[a-1])&&n.params.theme)},updateLimits:function(){this.getNextTheme()||this.overlay.find(".right").addClass("disabled"),this.getPreviousTheme()||this.overlay.find(".left").addClass("disabled")},loadThemePreview:function(e){return s.ThemesPanel.prototype.loadThemePreview.call(this,e)},showDetails:function(e,t){function n(){return!o.canSwitchTheme(e.id)}function i(){return n()||!1===s.settings.theme._canInstall||!0===s.settings.theme._filesystemCredentialsNeeded}var a=this,o=s.panel("themes");this.currentTheme=e.id,this.overlay.html(this.template(e)).fadeIn("fast").focus(),this.overlay.find("button.preview, button.preview-theme").toggleClass("disabled",n()),this.overlay.find("button.theme-install").toggleClass("disabled",i()),this.$body.addClass("modal-open"),this.containFocus(this.overlay),this.updateLimits(),wp.a11y.speak(s.settings.l10n.announceThemeDetails.replace("%s",e.name)),t&&t()},closeDetails:function(){var e=this;this.$body.removeClass("modal-open"),this.overlay.fadeOut("fast"),s.control(this.params.action+"_theme_"+this.currentTheme).container.find(".theme").focus()},containFocus:function(e){var n;e.on("keydown",function(i){if(9===i.keyCode)return(n=t(":tabbable",e)).last()[0]!==i.target||i.shiftKey?n.first()[0]===i.target&&i.shiftKey?(n.last().focus(),!1):void 0:(n.first().focus(),!1)})}}),s.OuterSection=s.Section.extend({initialize:function(){var e=this;this.containerParent="#customize-outer-theme-controls",this.containerPaneParent=".customize-outer-pane-parent",s.Section.prototype.initialize.apply(this,arguments)},onChangeExpanded:function(e,n){var i=this,a=i.headContainer.closest(".wp-full-overlay-sidebar-content"),o=i.contentContainer,r=o.find(".customize-section-back"),c=i.headContainer.find(".accordion-section-title").first(),l,d,u;t(document.body).toggleClass("outer-section-open",e),i.container.toggleClass("open",e),i.container.removeClass("busy"),s.section.each(function(e){"outer"===e.params.type&&e.id!==i.id&&e.container.removeClass("open")}),e&&!o.hasClass("open")?(d=n.unchanged?n.completeCallback:t.proxy(function(){i._animateChangeExpanded(function(){c.attr("tabindex","-1"),r.attr("tabindex","0"),r.focus(),o.css("top",""),a.scrollTop(0),n.completeCallback&&n.completeCallback()}),o.addClass("open")},this),i.panel()?s.panel(i.panel()).expand({duration:n.duration,completeCallback:d}):d()):!e&&o.hasClass("open")?(i.panel()&&(u=s.panel(i.panel())).contentContainer.hasClass("skip-transition")&&u.collapse(),i._animateChangeExpanded(function(){r.attr("tabindex","-1"),c.attr("tabindex","0"),c.focus(),o.css("top",""),n.completeCallback&&n.completeCallback()}),o.removeClass("open")):n.completeCallback&&n.completeCallback()}}),s.Panel=n.extend({containerType:"panel",initialize:function(e,t){var i=this,a;(a=t.params||t).type||_.find(s.panelConstructor,function(e,t){return e===i.constructor&&(a.type=t,!0)}),n.prototype.initialize.call(i,e,a),i.embed(),i.deferred.embedded.done(function(){i.ready()})},embed:function(){var e=this,n=t("#customize-theme-controls"),i=t(".customize-pane-parent");this.headContainer.parent().is(i)||i.append(this.headContainer),this.contentContainer.parent().is(this.headContainer)||n.append(this.contentContainer),this.renderContent(),this.deferred.embedded.resolve()},attachEvents:function(){var e,n=this;n.headContainer.find(".accordion-section-title").on("click keydown",function(e){s.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),n.expanded()||n.expand())}),n.container.find(".customize-panel-back").on("click keydown",function(e){s.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),n.expanded()&&n.collapse())}),(e=n.container.find(".panel-meta:first")).find("> .accordion-section-title .customize-help-toggle").on("click",function(){if(!e.hasClass("cannot-expand")){var i=e.find(".customize-panel-description:first");e.hasClass("open")?(e.toggleClass("open"),i.slideUp(n.defaultExpandedArguments.duration,function(){i.trigger("toggled")}),t(this).attr("aria-expanded",!1)):(i.slideDown(n.defaultExpandedArguments.duration,function(){i.trigger("toggled")}),e.toggleClass("open"),t(this).attr("aria-expanded",!0))}})},sections:function(){return this._children("panel","section")},isContextuallyActive:function(){var e=this,t=this.sections(),n=0;return _(t).each(function(e){e.active()&&e.isContextuallyActive()&&(n+=1)}),0!==n},onChangeExpanded:function(e,t){if(t.unchanged)t.completeCallback&&t.completeCallback();else{
var n=this,i=n.contentContainer,a=i.closest(".wp-full-overlay"),o=i.closest(".wp-full-overlay-sidebar-content"),r=n.headContainer.find(".accordion-section-title"),c=i.find(".customize-panel-back"),l=n.sections(),d;e&&!i.hasClass("current-panel")?(s.section.each(function(e){n.id!==e.panel()&&e.collapse({duration:0})}),s.panel.each(function(e){n!==e&&e.collapse({duration:0})}),n.params.autoExpandSoleSection&&1===l.length&&l[0].active.get()?(i.addClass("current-panel skip-transition"),a.addClass("in-sub-panel"),l[0].expand({completeCallback:t.completeCallback})):(n._animateChangeExpanded(function(){r.attr("tabindex","-1"),c.attr("tabindex","0"),c.focus(),i.css("top",""),o.scrollTop(0),t.completeCallback&&t.completeCallback()}),i.addClass("current-panel"),a.addClass("in-sub-panel")),s.state("expandedPanel").set(n)):!e&&i.hasClass("current-panel")&&((d=i.hasClass("skip-transition"))?i.removeClass("skip-transition"):n._animateChangeExpanded(function(){r.attr("tabindex","0"),c.attr("tabindex","-1"),r.focus(),i.css("top",""),t.completeCallback&&t.completeCallback()}),a.removeClass("in-sub-panel"),i.removeClass("current-panel"),n===s.state("expandedPanel").get()&&s.state("expandedPanel").set(!1))}},renderContent:function(){var e,n=this;(e=0!==t("#tmpl-"+this.templateSelector+"-content").length?wp.template(this.templateSelector+"-content"):wp.template("customize-panel-default-content"))&&this.headContainer&&this.contentContainer.html(e(_.extend({id:this.id},this.params)))}}),s.ThemesPanel=s.Panel.extend({initialize:function(e,t){var n=this;this.installingThemes=[],s.Panel.prototype.initialize.call(this,e,t)},canSwitchTheme:function e(t){return!(!t||t!==s.settings.theme.stylesheet)||"publish"===s.state("selectedChangesetStatus").get()&&(""===s.state("changesetStatus").get()||"auto-draft"===s.state("changesetStatus").get())},attachEvents:function(){function e(){n.canSwitchTheme()?n.notifications.remove("theme_switch_unavailable"):n.notifications.add(new s.Notification("theme_switch_unavailable",{message:s.l10n.themePreviewUnavailable,type:"warning"}))}var n=this;s.Panel.prototype.attachEvents.apply(n),s.settings.theme._canInstall&&s.settings.theme._filesystemCredentialsNeeded&&n.notifications.add(new s.Notification("theme_install_unavailable",{message:s.l10n.themeInstallUnavailable,type:"info",dismissible:!0})),e(),s.state("selectedChangesetStatus").bind(e),s.state("changesetStatus").bind(e),n.contentContainer.on("click",".customize-theme",function(){n.collapse()}),n.contentContainer.on("click",".customize-themes-section-title, .customize-themes-mobile-back",function(){t(".wp-full-overlay").toggleClass("showing-themes")}),n.contentContainer.on("click",".theme-install",function(e){n.installTheme(e)}),n.contentContainer.on("click",".update-theme, #update-theme",function(e){e.preventDefault(),e.stopPropagation(),n.updateTheme(e)}),n.contentContainer.on("click",".delete-theme",function(e){n.deleteTheme(e)}),_.bindAll(n,"installTheme","updateTheme")},onChangeExpanded:function(e,t){var n=this,i,a,o=!1;s.Panel.prototype.onChangeExpanded.apply(this,[e,t]),t.unchanged?t.completeCallback&&t.completeCallback():(i=this.headContainer.closest(".wp-full-overlay"),e?(i.addClass("in-themes-panel").delay(200).find(".customize-themes-full-container").addClass("animate"),_.delay(function(){i.addClass("themes-panel-expanded")},200),600<window.innerWidth&&(a=this.sections(),_.each(a,function(e){e.expanded()&&(o=!0)}),!o&&a.length>0&&a[0].expand())):i.removeClass("in-themes-panel themes-panel-expanded").find(".customize-themes-full-container").removeClass("animate"))},installTheme:function(e){var n=this,i,a,o=t(e.target).data("slug"),r=t.Deferred(),c;return i=t(e.target).hasClass("preview"),s.settings.theme._filesystemCredentialsNeeded?(r.reject({errorCode:"theme_install_unavailable"}),r.promise()):n.canSwitchTheme(o)?_.contains(n.installingThemes,o)?(r.reject({errorCode:"theme_already_installing"}),r.promise()):(wp.updates.maybeRequestFilesystemCredentials(e),a=function(e){var t=!1,a;if(i)s.notifications.remove("theme_installing"),n.loadThemePreview(o);else{if(s.control.each(function(n){"theme"===n.params.type&&n.params.theme.id===e.slug&&(t=n.params.theme,n.rerenderAsInstalled(!0))}),!t||s.control.has("installed_theme_"+t.id))return void r.resolve(e);t.type="installed",a=new s.controlConstructor.theme("installed_theme_"+t.id,{type:"theme",section:"installed_themes",theme:t,priority:0}),s.control.add(a),s.control(a.id).container.trigger("render-screenshot"),s.section.each(function(e){"themes"===e.params.type&&t.id===e.currentTheme&&e.closeDetails()})}r.resolve(e)},n.installingThemes.push(o),c=wp.updates.installTheme({slug:o}),i&&s.notifications.add(new s.OverlayNotification("theme_installing",{message:s.l10n.themeDownloading,type:"info",loading:!0})),c.done(a),c.fail(function(){s.notifications.remove("theme_installing")}),r.promise()):(r.reject({errorCode:"theme_switch_unavailable"}),r.promise())},loadThemePreview:function(e){var n=this,i=t.Deferred(),a,o,r;return this.canSwitchTheme(e)?((o=document.createElement("a")).href=location.href,r=_.extend(s.utils.parseQueryString(o.search.substr(1)),{theme:e,changeset_uuid:s.settings.changeset.uuid,return:s.settings.url.return}),s.state("saved").get()||(r.customize_autosaved="on"),o.search=t.param(r),s.notifications.add(new s.OverlayNotification("theme_previewing",{message:s.l10n.themePreviewWait,type:"info",loading:!0})),a=function(){var e;s.state("processing").get()>0||(s.state("processing").unbind(a),(e=s.requestChangesetUpdate({},{autosave:!0})).done(function(){i.resolve(),t(window).off("beforeunload.customize-confirm"),location.replace(o.href)}),e.fail(function(){s.notifications.remove("theme_previewing"),i.reject()}))},0===s.state("processing").get()?a():s.state("processing").bind(a),i.promise()):(i.reject({errorCode:"theme_switch_unavailable"}),i.promise())},updateTheme:function(e){wp.updates.maybeRequestFilesystemCredentials(e),t(document).one("wp-theme-update-success",function(e,t){s.control.each(function(e){"theme"===e.params.type&&e.params.theme.id===t.slug&&(e.params.theme.hasUpdate=!1,e.params.theme.version=t.newVersion,setTimeout(function(){e.rerenderAsInstalled(!0)},2e3))})}),wp.updates.updateTheme({slug:t(e.target).closest(".notice").data("slug")})},deleteTheme:function(e){var n,i;n=t(e.target).data("slug"),i=s.section("installed_themes"),e.preventDefault(),s.settings.theme._filesystemCredentialsNeeded||window.confirm(s.settings.l10n.confirmDeleteTheme)&&(wp.updates.maybeRequestFilesystemCredentials(e),t(document).one("wp-theme-delete-success",function(){var e=s.control("installed_theme_"+n);e.container.remove(),s.control.remove(e.id),i.loaded=i.loaded-1,i.updateCount(),s.control.each(function(e){"theme"===e.params.type&&e.params.theme.id===n&&e.rerenderAsInstalled(!1)})}),wp.updates.deleteTheme({slug:n}),i.closeDetails(),i.focus())}}),s.Control=s.Class.extend({defaultActiveArguments:{duration:"fast",completeCallback:t.noop},defaults:{label:"",description:"",active:!0,priority:10},initialize:function(e,n){var i=this,a=[],o,r;i.params=_.extend({},i.defaults,i.params||{},n.params||n||{}),s.Control.instanceCounter||(s.Control.instanceCounter=0),s.Control.instanceCounter++,i.params.instanceNumber||(i.params.instanceNumber=s.Control.instanceCounter),i.params.type||_.find(s.controlConstructor,function(e,t){return e===i.constructor&&(i.params.type=t,!0)}),i.params.content||(i.params.content=t("<li></li>",{id:"customize-control-"+e.replace(/]/g,"").replace(/\[/g,"-"),class:"customize-control customize-control-"+i.params.type})),i.id=e,i.selector="#customize-control-"+e.replace(/\]/g,"").replace(/\[/g,"-"),i.params.content?i.container=t(i.params.content):i.container=t(i.selector),i.params.templateId?i.templateSelector=i.params.templateId:i.templateSelector="customize-control-"+i.params.type+"-content",i.deferred=_.extend(i.deferred||{},{embedded:new t.Deferred}),i.section=new s.Value,i.priority=new s.Value,i.active=new s.Value,i.activeArgumentsQueue=[],i.notifications=new s.Notifications({alt:i.altNotice}),i.elements=[],i.active.bind(function(e){var n=i.activeArgumentsQueue.shift();n=t.extend({},i.defaultActiveArguments,n),i.onChangeActive(e,n)}),i.section.set(i.params.section),i.priority.set(isNaN(i.params.priority)?10:i.params.priority),i.active.set(i.params.active),s.utils.bubbleChildValueChanges(i,["section","priority","active"]),i.settings={},o={},i.params.setting&&(o.default=i.params.setting),_.extend(o,i.params.settings),_.each(o,function(e,t){var n;_.isObject(e)&&_.isFunction(e.extended)&&e.extended(s.Value)?i.settings[t]=e:_.isString(e)&&((n=s(e))?i.settings[t]=n:a.push(e))}),r=function(){_.each(o,function(e,t){!i.settings[t]&&_.isString(e)&&(i.settings[t]=s(e))}),i.settings[0]&&!i.settings.default&&(i.settings.default=i.settings[0]),i.setting=i.settings.default||null,i.linkElements(),i.embed()},0===a.length?r():s.apply(s,a.concat(r)),i.deferred.embedded.done(function(){i.linkElements(),i.setupNotifications(),i.ready()})},linkElements:function(){var e=this,n,i,a;n=e.container.find("[data-customize-setting-link], [data-customize-setting-key-link]"),i={},n.each(function(){var o=t(this),r,c;if(!o.data("customizeSettingLinked")){if(o.data("customizeSettingLinked",!0),o.is(":radio")){if(r=o.prop("name"),i[r])return;i[r]=!0,o=n.filter('[name="'+r+'"]')}o.data("customizeSettingLink")?c=s(o.data("customizeSettingLink")):o.data("customizeSettingKeyLink")&&(c=e.settings[o.data("customizeSettingKeyLink")]),c&&(a=new s.Element(o),e.elements.push(a),a.sync(c),a.set(c()))}})},embed:function(){var e=this,t;t=function(t){var n;t&&s.section(t,function(t){t.deferred.embedded.done(function(){n=t.contentContainer.is("ul")?t.contentContainer:t.contentContainer.find("ul:first"),e.container.parent().is(n)||(n.append(e.container),e.renderContent()),e.deferred.embedded.resolve()})})},e.section.bind(t),t(e.section.get())},ready:function(){var e=this,n;"dropdown-pages"===e.params.type&&e.params.allow_addition&&((n=e.container.find(".new-content-item")).hide(),e.container.on("click",".add-new-toggle",function(e){t(e.currentTarget).slideUp(180),n.slideDown(180),n.find(".create-item-input").focus()}),e.container.on("click",".add-content",function(){e.addNewPage()}),e.container.on("keydown",".create-item-input",function(t){13===t.which&&e.addNewPage()}))},getNotificationsContainerElement:function(){var e=this,n,i;return(i=this.container.find(".customize-control-notifications-container:first")).length?i:(i=t('<div class="customize-control-notifications-container"></div>'),this.container.hasClass("customize-control-nav_menu_item")?this.container.find(".menu-item-settings:first").prepend(i):this.container.hasClass("customize-control-widget_form")?this.container.find(".widget-inside:first").prepend(i):(n=this.container.find(".customize-control-title")).length?n.after(i):this.container.prepend(i),i)},setupNotifications:function(){var e=this,t,n;_.each(e.settings,function(t){t.notifications&&(t.notifications.bind("add",function(n){var i=_.extend({},n,{setting:t.id});e.notifications.add(new s.Notification(t.id+":"+n.code,i))}),t.notifications.bind("remove",function(n){e.notifications.remove(t.id+":"+n.code)}))}),t=function(){var t=e.section();(!t||s.section.has(t)&&s.section(t).expanded())&&e.notifications.render()},e.notifications.bind("rendered",function(){var t=e.notifications.get();e.container.toggleClass("has-notifications",0!==t.length),e.container.toggleClass("has-error",0!==_.where(t,{type:"error"}).length)}),n=function(e,n){n&&s.section.has(n)&&s.section(n).expanded.unbind(t),e&&s.section(e,function(e){e.expanded.bind(t),t()})},e.section.bind(n),n(e.section.get()),e.notifications.bind("change",_.debounce(t))},renderNotifications:function(){var e=this,n,i,a=!1;"undefined"!=typeof console&&console.warn&&console.warn("[DEPRECATED] wp.customize.Control.prototype.renderNotifications() is deprecated in favor of instantating a wp.customize.Notifications and calling its render() method."),(n=this.getNotificationsContainerElement())&&n.length&&(i=[],this.notifications.each(function(e){i.push(e),"error"===e.type&&(a=!0)}),0===i.length?n.stop().slideUp("fast"):n.stop().slideDown("fast",null,function(){t(this).css("height","auto")}),this.notificationsTemplate||(this.notificationsTemplate=wp.template("customize-control-notifications")),this.container.toggleClass("has-notifications",0!==i.length),this.container.toggleClass("has-error",a),n.empty().append(t.trim(this.notificationsTemplate({notifications:i,altNotice:Boolean(this.altNotice)}))))},expand:function(e){s.section(this.section()).expand(e)},focus:i,onChangeActive:function(e,n){n.unchanged?n.completeCallback&&n.completeCallback():t.contains(document,this.container[0])?e?this.container.slideDown(n.duration,n.completeCallback):this.container.slideUp(n.duration,n.completeCallback):(this.container.toggle(e),n.completeCallback&&n.completeCallback())},toggle:function(e){return this.onChangeActive(e,this.defaultActiveArguments)},activate:n.prototype.activate,deactivate:n.prototype.deactivate,_toggleActive:n.prototype._toggleActive,dropdownInit:function(){var e=this,t=this.container.find(".dropdown-status"),n=this.params,i=!1,a=function(e){"string"==typeof e&&n.statuses&&n.statuses[e]?t.html(n.statuses[e]).show():t.hide()};this.container.on("click keydown",".dropdown",function(t){s.utils.isKeydownButNotEnterEvent(t)||(t.preventDefault(),i||e.container.toggleClass("open"),e.container.hasClass("open")&&e.container.parent().parent().find("li.library-selected").focus(),i=!0,setTimeout(function(){i=!1},400))}),this.setting.bind(a),a(this.setting())},renderContent:function(){var e=this,t,n,i,a;n=["button","checkbox","date","datetime-local","email","month","number","password","radio","range","search","select","tel","time","text","textarea","week","url"],(i=this.templateSelector)==="customize-control-"+this.params.type+"-content"&&_.contains(n,this.params.type)&&!document.getElementById("tmpl-"+i)&&0===this.container.children().length&&(i="customize-control-default-content"),document.getElementById("tmpl-"+i)&&(t=wp.template(i))&&this.container&&this.container.html(t(this.params)),this.notifications.container=this.getNotificationsContainerElement(),(!(a=this.section())||s.section.has(a)&&s.section(a).expanded())&&this.notifications.render()},addNewPage:function(){var e=this,n,i,a,o,r,c;"dropdown-pages"===e.params.type&&e.params.allow_addition&&s.Menus&&(i=e.container.find(".add-new-toggle"),a=e.container.find(".new-content-item"),o=e.container.find(".create-item-input"),r=o.val(),c=e.container.find("select"),r?(o.removeClass("invalid"),o.attr("disabled","disabled"),(n=s.Menus.insertAutoDraftPost({post_title:r,post_type:"page"})).done(function(n){var o,l,d;o=new s.Menus.AvailableItemModel({id:"post-"+n.post_id,title:r,type:"post_type",type_label:s.Menus.data.l10n.page_label,object:"page",object_id:n.post_id,url:n.url}),s.Menus.availableMenuItemsPanel.collection.add(o),l=t("#available-menu-items-post_type-page").find(".available-menu-items-list"),d=wp.template("available-menu-item"),l.prepend(d(o.attributes)),c.focus(),e.setting.set(String(n.post_id)),a.slideUp(180),i.slideDown(180)}),n.always(function(){o.val("").removeAttr("disabled")})):o.addClass("invalid"))}}),s.ColorControl=s.Control.extend({ready:function(){var e=this,t="hue"===this.params.mode,n=!1,i;t?(i=this.container.find(".color-picker-hue")).val(e.setting()).wpColorPicker({change:function(t,i){n=!0,e.setting(i.color.h()),n=!1}}):(i=this.container.find(".color-picker-hex")).val(e.setting()).wpColorPicker({change:function(){n=!0,e.setting.set(i.wpColorPicker("color")),n=!1},clear:function(){n=!0,e.setting.set(""),n=!1}}),e.setting.bind(function(e){n||(i.val(e),i.wpColorPicker("color",e))}),e.container.on("keydown",function(t){var n;27===t.which&&(n=e.container.find(".wp-picker-container")).hasClass("wp-picker-active")&&(i.wpColorPicker("close"),e.container.find(".wp-color-result").focus(),t.stopPropagation())})}}),s.MediaControl=s.Control.extend({ready:function(){function e(e){var i=t.Deferred();n.extended(s.UploadControl)?i.resolve():(e=parseInt(e,10),_.isNaN(e)||e<=0?(delete n.params.attachment,i.resolve()):n.params.attachment&&n.params.attachment.id===e&&i.resolve()),"pending"===i.state()&&wp.media.attachment(e).fetch().done(function(){n.params.attachment=this.attributes,i.resolve(),wp.customize.previewer.send(n.setting.id+"-attachment-data",this.attributes)}),i.done(function(){n.renderContent()})}var n=this;_.bindAll(n,"restoreDefault","removeFile","openFrame","select","pausePlayer"),n.container.on("click keydown",".upload-button",n.openFrame),n.container.on("click keydown",".upload-button",n.pausePlayer),n.container.on("click keydown",".thumbnail-image img",n.openFrame),n.container.on("click keydown",".default-button",n.restoreDefault),n.container.on("click keydown",".remove-button",n.pausePlayer),n.container.on("click keydown",".remove-button",n.removeFile),n.container.on("click keydown",".remove-button",n.cleanupPlayer),s.section(n.section()).container.on("expanded",function(){n.player&&n.player.setControlsSize()}).on("collapsed",function(){n.pausePlayer()}),e(n.setting()),n.setting.bind(e)},pausePlayer:function(){this.player&&this.player.pause()},cleanupPlayer:function(){this.player&&wp.media.mixin.removePlayer(this.player)},openFrame:function(e){s.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),this.frame||this.initFrame(),this.frame.open())},initFrame:function(){this.frame=wp.media({button:{text:this.params.button_labels.frame_button},states:[new wp.media.controller.Library({title:this.params.button_labels.frame_title,library:wp.media.query({type:this.params.mime_type}),multiple:!1,date:!1})]}),this.frame.on("select",this.select)},select:function(){var e,t=this.frame.state().get("selection").first().toJSON(),n=window._wpmejsSettings||{};this.params.attachment=t,this.setting(t.id),(e=this.container.find("audio, video").get(0))?this.player=new MediaElementPlayer(e,n):this.cleanupPlayer()},restoreDefault:function(e){s.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),this.params.attachment=this.params.defaultAttachment,this.setting(this.params.defaultAttachment.url))},removeFile:function(e){s.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),this.params.attachment={},this.setting(""),this.renderContent())}}),s.UploadControl=s.MediaControl.extend({select:function(){var e,t=this.frame.state().get("selection").first().toJSON(),n=window._wpmejsSettings||{};this.params.attachment=t,this.setting(t.url),(e=this.container.find("audio, video").get(0))?this.player=new MediaElementPlayer(e,n):this.cleanupPlayer()},success:function(){},removerVisibility:function(){}}),s.ImageControl=s.UploadControl.extend({thumbnailSrc:function(){}}),s.BackgroundControl=s.UploadControl.extend({ready:function(){s.UploadControl.prototype.ready.apply(this,arguments)},select:function(){s.UploadControl.prototype.select.apply(this,arguments),wp.ajax.post("custom-background-add",{nonce:_wpCustomizeBackground.nonces.add,wp_customize:"on",customize_theme:s.settings.theme.stylesheet,attachment_id:this.params.attachment.id})}}),s.BackgroundPositionControl=s.Control.extend({ready:function(){var e=this,n;e.container.on("change",'input[name="background-position"]',function(){var n=t(this).val().split(" ");e.settings.x(n[0]),e.settings.y(n[1])}),n=_.debounce(function(){var t,n,i,a;t=e.settings.x.get(),n=e.settings.y.get(),a=String(t)+" "+String(n),(i=e.container.find('input[name="background-position"][value="'+a+'"]')).click()}),e.settings.x.bind(n),e.settings.y.bind(n),n()}}),s.CroppedImageControl=s.MediaControl.extend({openFrame:function(e){s.utils.isKeydownButNotEnterEvent(e)||(this.initFrame(),this.frame.setState("library").open())},initFrame:function(){var e=_wpMediaViewsL10n;this.frame=wp.media({button:{text:e.select,close:!1},states:[new wp.media.controller.Library({title:this.params.button_labels.frame_title,library:wp.media.query({type:"image"}),multiple:!1,date:!1,priority:20,suggestedWidth:this.params.width,suggestedHeight:this.params.height}),new wp.media.controller.CustomizeImageCropper({imgSelectOptions:this.calculateImageSelectOptions,control:this})]}),this.frame.on("select",this.onSelect,this),this.frame.on("cropped",this.onCropped,this),this.frame.on("skippedcrop",this.onSkippedCrop,this)},onSelect:function(){var e=this.frame.state().get("selection").first().toJSON();this.params.width!==e.width||this.params.height!==e.height||this.params.flex_width||this.params.flex_height?this.frame.setState("cropper"):(this.setImageFromAttachment(e),this.frame.close())},onCropped:function(e){this.setImageFromAttachment(e)},calculateImageSelectOptions:function(e,t){var n=t.get("control"),i=!!parseInt(n.params.flex_width,10),a=!!parseInt(n.params.flex_height,10),s=e.get("width"),o=e.get("height"),r=parseInt(n.params.width,10),c=parseInt(n.params.height,10),l=r/c,d=r,u=c,h,p,f;return t.set("canSkipCrop",!n.mustBeCropped(i,a,r,c,s,o)),s/o>l?r=(c=o)*l:c=(r=s)/l,f={handles:!0,keys:!0,instance:!0,persistent:!0,imageWidth:s,imageHeight:o,minWidth:d>r?r:d,minHeight:u>c?c:u,x1:h=(s-r)/2,y1:p=(o-c)/2,x2:r+h,y2:c+p},!1===a&&!1===i&&(f.aspectRatio=r+":"+c),!0===a&&(delete f.minHeight,f.maxWidth=s),!0===i&&(delete f.minWidth,f.maxHeight=o),f},mustBeCropped:function(e,t,n,i,a,s){return(!0!==e||!0!==t)&&((!0!==e||i!==s)&&((!0!==t||n!==a)&&((n!==a||i!==s)&&!(a<=n))))},onSkippedCrop:function(){var e=this.frame.state().get("selection").first().toJSON();this.setImageFromAttachment(e)},setImageFromAttachment:function(e){this.params.attachment=e,this.setting(e.id)}}),s.SiteIconControl=s.CroppedImageControl.extend({initFrame:function(){var e=_wpMediaViewsL10n;this.frame=wp.media({button:{text:e.select,close:!1},states:[new wp.media.controller.Library({title:this.params.button_labels.frame_title,library:wp.media.query({type:"image"}),multiple:!1,date:!1,priority:20,suggestedWidth:this.params.width,suggestedHeight:this.params.height}),new wp.media.controller.SiteIconCropper({imgSelectOptions:this.calculateImageSelectOptions,control:this})]}),this.frame.on("select",this.onSelect,this),this.frame.on("cropped",this.onCropped,this),this.frame.on("skippedcrop",this.onSkippedCrop,this)},onSelect:function(){var e=this.frame.state().get("selection").first().toJSON(),t=this;this.params.width!==e.width||this.params.height!==e.height||this.params.flex_width||this.params.flex_height?this.frame.setState("cropper"):wp.ajax.post("crop-image",{nonce:e.nonces.edit,id:e.id,context:"site-icon",cropDetails:{x1:0,y1:0,width:this.params.width,height:this.params.height,dst_width:this.params.width,dst_height:this.params.height}}).done(function(e){t.setImageFromAttachment(e),t.frame.close()}).fail(function(){t.frame.trigger("content:error:crop")})},setImageFromAttachment:function(e){var n=["site_icon-32","thumbnail","full"],i,a;_.each(n,function(t){a||_.isUndefined(e.sizes[t])||(a=e.sizes[t])}),this.params.attachment=e,this.setting(e.id),a&&(i=t('link[rel="icon"][sizes="32x32"]')).attr("href",a.url)},removeFile:function(e){s.utils.isKeydownButNotEnterEvent(e)||(e.preventDefault(),this.params.attachment={},this.setting(""),this.renderContent(),t('link[rel="icon"][sizes="32x32"]').attr("href","/favicon.ico"))}}),s.HeaderControl=s.Control.extend({ready:function(){this.btnRemove=t("#customize-control-header_image .actions .remove"),this.btnNew=t("#customize-control-header_image .actions .new"),_.bindAll(this,"openMedia","removeImage"),this.btnNew.on("click",this.openMedia),this.btnRemove.on("click",this.removeImage),s.HeaderTool.currentHeader=this.getInitialHeaderImage(),new s.HeaderTool.CurrentView({model:s.HeaderTool.currentHeader,el:"#customize-control-header_image .current .container"}),new s.HeaderTool.ChoiceListView({collection:s.HeaderTool.UploadsList=new s.HeaderTool.ChoiceList,el:"#customize-control-header_image .choices .uploaded .list"}),new s.HeaderTool.ChoiceListView({collection:s.HeaderTool.DefaultsList=new s.HeaderTool.DefaultsList,el:"#customize-control-header_image .choices .default .list"}),s.HeaderTool.combinedList=s.HeaderTool.CombinedList=new s.HeaderTool.CombinedList([s.HeaderTool.UploadsList,s.HeaderTool.DefaultsList]),wp.media.controller.Cropper.prototype.defaults.doCropArgs.wp_customize="on",wp.media.controller.Cropper.prototype.defaults.doCropArgs.customize_theme=s.settings.theme.stylesheet},getInitialHeaderImage:function(){if(!s.get().header_image||!s.get().header_image_data||_.contains(["remove-header","random-default-image","random-uploaded-image"],s.get().header_image))return new s.HeaderTool.ImageModel;var e=_.find(_wpCustomizeHeader.uploads,function(e){return e.attachment_id===s.get().header_image_data.attachment_id});return e||(e={url:s.get().header_image,thumbnail_url:s.get().header_image,attachment_id:s.get().header_image_data.attachment_id}),new s.HeaderTool.ImageModel({header:e,choice:e.url.split("/").pop()})},calculateImageSelectOptions:function(e,t){var n=parseInt(_wpCustomizeHeader.data.width,10),i=parseInt(_wpCustomizeHeader.data.height,10),a=!!parseInt(_wpCustomizeHeader.data["flex-width"],10),o=!!parseInt(_wpCustomizeHeader.data["flex-height"],10),r,c,l,d,u,h;return u=e.get("width"),d=e.get("height"),this.headerImage=new s.HeaderTool.ImageModel,this.headerImage.set({themeWidth:n,themeHeight:i,themeFlexWidth:a,themeFlexHeight:o,imageWidth:u,imageHeight:d}),t.set("canSkipCrop",!this.headerImage.shouldBeCropped()),(c=u)/(l=d)>(r=n/i)?n=(i=l)*r:i=(n=c)/r,h={handles:!0,keys:!0,instance:!0,persistent:!0,imageWidth:u,imageHeight:d,x1:0,y1:0,x2:n,y2:i},!1===o&&!1===a&&(h.aspectRatio=n+":"+i),!1===o&&(h.maxHeight=i),!1===a&&(h.maxWidth=n),h},openMedia:function(e){var t=_wpMediaViewsL10n;e.preventDefault(),this.frame=wp.media({button:{text:t.selectAndCrop,close:!1},states:[new wp.media.controller.Library({title:t.chooseImage,library:wp.media.query({type:"image"}),multiple:!1,date:!1,priority:20,suggestedWidth:_wpCustomizeHeader.data.width,suggestedHeight:_wpCustomizeHeader.data.height}),new wp.media.controller.Cropper({imgSelectOptions:this.calculateImageSelectOptions})]}),this.frame.on("select",this.onSelect,this),this.frame.on("cropped",this.onCropped,this),this.frame.on("skippedcrop",this.onSkippedCrop,this),this.frame.open()},onSelect:function(){this.frame.setState("cropper")},onCropped:function(e){var t=e.url,n=e.attachment_id,i=e.width,a=e.height;this.setImageFromURL(t,n,i,a)},onSkippedCrop:function(e){var t=e.get("url"),n=e.get("width"),i=e.get("height");this.setImageFromURL(t,e.id,n,i)},setImageFromURL:function(e,t,n,i){var a,o={};o.url=e,o.thumbnail_url=e,o.timestamp=_.now(),t&&(o.attachment_id=t),n&&(o.width=n),i&&(o.height=i),a=new s.HeaderTool.ImageModel({header:o,choice:e.split("/").pop()}),s.HeaderTool.UploadsList.add(a),s.HeaderTool.currentHeader.set(a.toJSON()),a.save(),a.importImage()},removeImage:function(){s.HeaderTool.currentHeader.trigger("hide"),s.HeaderTool.CombinedList.trigger("control:removeImage")}}),s.ThemeControl=s.Control.extend({touchDrag:!1,screenshotRendered:!1,ready:function(){function e(){return!o.canSwitchTheme(a.params.theme.id)}function n(){return e()||!1===s.settings.theme._canInstall||!0===s.settings.theme._filesystemCredentialsNeeded}function i(){a.container.find("button.preview, button.preview-theme").toggleClass("disabled",e()),a.container.find("button.theme-install").toggleClass("disabled",n())}var a=this,o=s.panel("themes");s.state("selectedChangesetStatus").bind(i),s.state("changesetStatus").bind(i),i(),a.container.on("touchmove",".theme",function(){a.touchDrag=!0}),a.container.on("click keydown touchend",".theme",function(e){var n;if(!s.utils.isKeydownButNotEnterEvent(e))return!0===a.touchDrag?a.touchDrag=!1:void(t(e.target).is(".theme-actions .button, .update-theme")||(e.preventDefault(),(n=s.section(a.section())).showDetails(a.params.theme,function(){s.settings.theme._filesystemCredentialsNeeded&&n.overlay.find(".theme-actions .delete-theme").remove()})))}),a.container.on("render-screenshot",function(){var e=t(this).find("img"),n=e.data("src");n&&e.attr("src",n),a.screenshotRendered=!0})},filter:function(e){var t=this,n=0,i=this.params.theme.name+" "+this.params.theme.description+" "+this.params.theme.tags+" "+this.params.theme.author+" ";return i=i.toLowerCase().replace("-"," "),_.isArray(e)||(e=[e]),this.params.theme.name.toLowerCase()===e.join(" ")?n=100:(n+=10*(i.split(e.join(" ")).length-1),_.each(e,function(e){n=(n+=2*(i.split(e+" ").length-1))+i.split(e).length-1}),n>99&&(n=99)),0!==n?(this.activate(),this.params.priority=101-n,!0):(this.deactivate(),this.params.priority=101,!1)},rerenderAsInstalled:function(e){var t=this,n;e?this.params.theme.type="installed":(n=s.section(this.params.section),this.params.theme.type=n.params.action),this.renderContent(),this.container.trigger("render-screenshot")}}),s.CodeEditorControl=s.Control.extend({initialize:function(e,n){var i=this;i.deferred=_.extend(i.deferred||{},{codemirror:t.Deferred()}),s.Control.prototype.initialize.call(i,e,n),i.notifications.bind("add",function(e){var t;e.code===i.setting.id+":csslint_error"&&(e.templateId="customize-code-editor-lint-error-notification",e.render=(t=e.render,function(){var e=t.call(this);return e.find("input[type=checkbox]").on("click",function(){i.setting.notifications.remove("csslint_error")}),e}))})},ready:function(){var e=this;e.section()?s.section(e.section(),function(t){t.deferred.embedded.done(function(){var n;t.expanded()?e.initEditor():(n=function(i){i&&(e.initEditor(),t.expanded.unbind(n))},t.expanded.bind(n))})}):e.initEditor()},initEditor:function(){var e=this,t,n=!1;wp.codeEditor&&(_.isUndefined(this.params.editor_settings)||!1!==this.params.editor_settings)&&((n=wp.codeEditor.defaultSettings?_.clone(wp.codeEditor.defaultSettings):{}).codemirror=_.extend({},n.codemirror,{indentUnit:2,tabSize:2}),_.isObject(this.params.editor_settings)&&_.each(this.params.editor_settings,function(e,t){_.isObject(e)&&(n[t]=_.extend({},n[t],e))})),t=new s.Element(this.container.find("textarea")),this.elements.push(t),t.sync(this.setting),t.set(this.setting()),n?this.initSyntaxHighlightingEditor(n):this.initPlainTextareaEditor()},focus:function(e){var t=this,n=_.extend({},e),i;i=n.completeCallback,n.completeCallback=function(){i&&i(),t.editor&&t.editor.codemirror.focus()},s.Control.prototype.focus.call(t,n)},initSyntaxHighlightingEditor:function(e){var n=this,i=n.container.find("textarea"),a,s=!1;a=_.extend({},e,{onTabNext:_.bind(n.onTabNext,n),onTabPrevious:_.bind(n.onTabPrevious,n),onUpdateErrorNotice:_.bind(n.onUpdateErrorNotice,n)}),n.editor=wp.codeEditor.initialize(i,a),t(n.editor.codemirror.display.lineDiv).attr({role:"textbox","aria-multiline":"true","aria-label":n.params.label,"aria-describedby":"editor-keyboard-trap-help-1 editor-keyboard-trap-help-2 editor-keyboard-trap-help-3 editor-keyboard-trap-help-4"}),n.container.find("label").on("click",function(){n.editor.codemirror.focus()}),n.editor.codemirror.on("change",function(e){s=!0,i.val(e.getValue()).trigger("change"),s=!1}),n.setting.bind(function(e){s||n.editor.codemirror.setValue(e)}),n.editor.codemirror.on("keydown",function e(t,n){var i=27;27===n.keyCode&&n.stopPropagation()}),n.deferred.codemirror.resolveWith(n,[n.editor.codemirror])},onTabNext:function e(){var n=this,i,a,o;a=(i=(o=s.section(this.section())).controls()).indexOf(this),i.length===a+1?t("#customize-footer-actions .collapse-sidebar").focus():i[a+1].container.find(":focusable:first").focus()},onTabPrevious:function e(){var t=this,n,i,a;0===(i=(n=(a=s.section(this.section())).controls()).indexOf(this))?a.contentContainer.find(".customize-section-title .customize-help-toggle, .customize-section-title .customize-section-description.open .section-description-close").last().focus():n[i-1].contentContainer.find(":focusable:first").focus()},onUpdateErrorNotice:function e(t){var n=this,i;this.setting.notifications.remove("csslint_error"),
0!==t.length&&(i=1===t.length?s.l10n.customCssError.singular.replace("%d","1"):s.l10n.customCssError.plural.replace("%d",String(t.length)),this.setting.notifications.add(new s.Notification("csslint_error",{message:i,type:"error"})))},initPlainTextareaEditor:function(){var e=this,t=this.container.find("textarea"),n=t[0];t.on("blur",function e(){t.data("next-tab-blurs",!1)}),t.on("keydown",function e(i){var a,s,o,r=9,c=27;27!==i.keyCode?9!==i.keyCode||i.ctrlKey||i.altKey||i.shiftKey||t.data("next-tab-blurs")||(a=n.selectionStart,s=n.selectionEnd,o=n.value,a>=0&&(n.value=o.substring(0,a).concat("\t",o.substring(s)),t.selectionStart=n.selectionEnd=a+1),i.stopPropagation(),i.preventDefault()):t.data("next-tab-blurs")||(t.data("next-tab-blurs",!0),i.stopPropagation())}),this.deferred.codemirror.rejectWith(this)}}),s.DateTimeControl=s.Control.extend({ready:function e(){var n=this;if(n.inputElements={},n.invalidDate=!1,_.bindAll(n,"populateSetting","updateDaysForMonth","populateDateInputs"),!n.setting)throw new Error("Missing setting");n.container.find(".date-input").each(function(){var e=t(this),i,a;i=e.data("component"),a=new s.Element(e),n.inputElements[i]=a,n.elements.push(a),e.on("change",function(){n.invalidDate&&n.notifications.add(new s.Notification("invalid_date",{message:s.l10n.invalidDate}))}),e.on("input",_.debounce(function(){n.invalidDate||n.notifications.remove("invalid_date")})),e.on("blur",_.debounce(function(){n.invalidDate||n.populateDateInputs()}))}),n.inputElements.month.bind(n.updateDaysForMonth),n.inputElements.year.bind(n.updateDaysForMonth),n.populateDateInputs(),n.setting.bind(n.populateDateInputs),_.each(n.inputElements,function(e){e.bind(n.populateSetting)})},parseDateTime:function e(t){var n=this,i,a,s=12;return t&&(i=t.match(/^(\d\d\d\d)-(\d\d)-(\d\d)(?: (\d\d):(\d\d)(?::(\d\d))?)?$/)),i?(i.shift(),a={year:i.shift(),month:i.shift(),day:i.shift(),hour:i.shift()||"00",minute:i.shift()||"00",second:i.shift()||"00"},this.params.includeTime&&this.params.twelveHourFormat&&(a.hour=parseInt(a.hour,10),a.meridian=a.hour>=12?"pm":"am",a.hour=a.hour%12?String(a.hour%12):String(12),delete a.second),a):null},validateInputs:function e(){var t=this,n,i;return t.invalidDate=!1,n=["year","day"],t.params.includeTime&&n.push("hour","minute"),_.find(n,function(e){var n,a,s,o;return n=t.inputElements[e],i=n.element.get(0),a=parseInt(n.element.attr("max"),10),s=parseInt(n.element.attr("min"),10),o=parseInt(n(),10),t.invalidDate=isNaN(o)||o>a||o<s,t.invalidDate||i.setCustomValidity(""),t.invalidDate}),t.inputElements.meridian&&!t.invalidDate&&(i=t.inputElements.meridian.element.get(0),"am"!==t.inputElements.meridian.get()&&"pm"!==t.inputElements.meridian.get()?t.invalidDate=!0:i.setCustomValidity("")),t.invalidDate?i.setCustomValidity(s.l10n.invalidValue):i.setCustomValidity(""),(!t.section()||s.section.has(t.section())&&s.section(t.section()).expanded())&&_.result(i,"reportValidity"),t.invalidDate},updateDaysForMonth:function e(){var t=this,n,i,a,s;a=parseInt(this.inputElements.month(),10),i=parseInt(this.inputElements.year(),10),s=parseInt(this.inputElements.day(),10),a&&i&&(n=new Date(i,a,0).getDate(),this.inputElements.day.element.attr("max",n),s>n&&this.inputElements.day(String(n)))},populateSetting:function e(){var t=this,n;return!(this.validateInputs()||!this.params.allowPastDate&&!this.isFutureDate())&&(n=this.convertInputDateToString(),this.setting.set(n),!0)},convertInputDateToString:function e(){var t=this,n="",i,a,s,o;return o=function(e,t){var n;return String(e).length<t&&(n=t-String(e).length,e=Math.pow(10,n).toString().substr(1)+String(e)),e},s=function(e){var n=parseInt(t.inputElements[e].get(),10);return _.contains(["month","day","hour","minute"],e)?n=o(n,2):"year"===e&&(n=o(n,4)),n},i=["year","-","month","-","day"],t.params.includeTime&&(a=t.inputElements.meridian?t.convertHourToTwentyFourHourFormat(t.inputElements.hour(),t.inputElements.meridian()):t.inputElements.hour(),i=i.concat([" ",o(a,2),":","minute",":","00"])),_.each(i,function(e){n+=t.inputElements[e]?s(e):e}),n},isFutureDate:function e(){var t=this;return 0<s.utils.getRemainingTime(this.convertInputDateToString())},convertHourToTwentyFourHourFormat:function e(t,n){var i,a,s=12;return a=parseInt(t,10),isNaN(a)?"":(i="pm"===n&&a<12?a+12:"am"===n&&12===a?a-12:a,String(i))},populateDateInputs:function e(){var t=this,n;return!!(n=this.parseDateTime(this.setting.get()))&&(_.each(this.inputElements,function(e,t){var i=n[t];"month"===t||"meridian"===t?(i=i.replace(/^0/,""),e.set(i)):(i=parseInt(i,10),e.element.is(document.activeElement)?i!==parseInt(e(),10)&&e.set(String(i)):e.set(n[t]))}),!0)},toggleFutureDateNotification:function e(t){var n=this,i,a;return i="not_future_date",t?(a=new s.Notification(i,{type:"error",message:s.l10n.futureDateError}),this.notifications.add(a)):this.notifications.remove(i),this}}),s.PreviewLinkControl=s.Control.extend({defaults:_.extend({},s.Control.prototype.defaults,{templateId:"customize-preview-link-control"}),ready:function e(){var n=this,i,a,o,r,c,l;_.bindAll(n,"updatePreviewLink"),n.setting||(n.setting=new s.Value),n.previewElements={},n.container.find(".preview-control-element").each(function(){o=t(this),a=o.data("component"),i=new s.Element(o),n.previewElements[a]=i,n.elements.push(i)}),r=n.previewElements.url,c=n.previewElements.input,l=n.previewElements.button,c.link(n.setting),r.link(n.setting),r.bind(function(e){r.element.parent().attr({href:e,target:s.settings.changeset.uuid})}),s.bind("ready",n.updatePreviewLink),s.state("saved").bind(n.updatePreviewLink),s.state("changesetStatus").bind(n.updatePreviewLink),s.state("activated").bind(n.updatePreviewLink),s.previewer.previewUrl.bind(n.updatePreviewLink),l.element.on("click",function(e){e.preventDefault(),n.setting()&&(c.element.select(),document.execCommand("copy"),l(l.element.data("copied-text")))}),r.element.parent().on("click",function(e){t(this).hasClass("disabled")&&e.preventDefault()}),l.element.on("mouseenter",function(){n.setting()&&l(l.element.data("copy-text"))})},updatePreviewLink:function e(){var t=this,n;n=!s.state("saved").get()||""===s.state("changesetStatus").get()||"auto-draft"===s.state("changesetStatus").get(),this.toggleSaveNotification(n),this.previewElements.url.element.parent().toggleClass("disabled",n),this.previewElements.button.element.prop("disabled",n),this.setting.set(s.previewer.getFrontendPreviewUrl())},toggleSaveNotification:function e(t){var n=this,i,a;i="changes_not_saved",t?(a=new s.Notification(i,{type:"info",message:s.l10n.saveBeforeShare}),this.notifications.add(a)):this.notifications.remove(i)}}),s.defaultConstructor=s.Setting,s.control=new s.Values({defaultConstructor:s.Control}),s.section=new s.Values({defaultConstructor:s.Section}),s.panel=new s.Values({defaultConstructor:s.Panel}),s.notifications=new s.Notifications,s.PreviewFrame=s.Messenger.extend({sensitivity:null,initialize:function(e,n){var i=t.Deferred();i.promise(this),this.container=e.container,t.extend(e,{channel:s.PreviewFrame.uuid()}),s.Messenger.prototype.initialize.call(this,e,n),this.add("previewUrl",e.previewUrl),this.query=t.extend(e.query||{},{customize_messenger_channel:this.channel()}),this.run(i)},run:function(e){var n=this,i=!1,a=!1,o=null,r="{}"!==n.query.customized,c,l,d;n._ready&&n.unbind("ready",n._ready),n._ready=function(t){a=!0,o=t,n.container.addClass("iframe-ready"),t&&i&&e.resolveWith(n,[t])},n.bind("ready",n._ready),(c=document.createElement("a")).href=n.previewUrl(),l=_.extend(s.utils.parseQueryString(c.search.substr(1)),{customize_changeset_uuid:n.query.customize_changeset_uuid,customize_theme:n.query.customize_theme,customize_messenger_channel:n.query.customize_messenger_channel}),!s.settings.changeset.autosaved&&s.state("saved").get()||(l.customize_autosaved="on"),c.search=t.param(l),n.iframe=t("<iframe />",{title:s.l10n.previewIframeTitle,name:"customize-"+n.channel()}),n.iframe.attr("onmousewheel",""),n.iframe.attr("sandbox","allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-presentation allow-same-origin allow-scripts"),r?n.iframe.attr("data-src",c.href):n.iframe.attr("src",c.href),n.iframe.appendTo(n.container),n.targetWindow(n.iframe[0].contentWindow),r&&((d=t("<form>",{action:c.href,target:n.iframe.attr("name"),method:"post",hidden:"hidden"})).append(t("<input>",{type:"hidden",name:"_method",value:"GET"})),_.each(n.query,function(e,n){d.append(t("<input>",{type:"hidden",name:n,value:e}))}),n.container.append(d),d.submit(),d.remove()),n.bind("iframe-loading-error",function(t){n.iframe.remove(),0!==t?-1!==t?e.rejectWith(n,["request failure"]):e.rejectWith(n,["cheatin"]):n.login(e)}),n.iframe.one("load",function(){i=!0,a?e.resolveWith(n,[o]):setTimeout(function(){e.rejectWith(n,["ready timeout"])},n.sensitivity)})},login:function(e){var n=this,i;if(i=function(){e.rejectWith(n,["logged out"])},this.triedLogin)return i();t.get(s.settings.url.ajax,{action:"logged-in"}).fail(i).done(function(a){var o;"1"!==a&&i(),(o=t("<iframe />",{src:n.previewUrl(),title:s.l10n.previewIframeTitle}).hide()).appendTo(n.container),o.on("load",function(){n.triedLogin=!0,o.remove(),n.run(e)})})},destroy:function(){s.Messenger.prototype.destroy.call(this),this.iframe&&this.iframe.remove(),delete this.iframe,delete this.targetWindow}}),l=0,s.PreviewFrame.uuid=function(){return"preview-"+String(l++)},s.setDocumentTitle=function(e){var t,n;n=(t=s.settings.documentTitleTmpl).replace("%s",e),document.title=n,s.trigger("title",n)},s.Previewer=s.Messenger.extend({refreshBuffer:null,initialize:function(e,n){var i=this,a=document.createElement("a"),o;t.extend(i,n||{}),i.deferred={active:t.Deferred()},i.refresh=_.debounce((o=i.refresh,function(){var e,t;(e=function(){return 0===s.state("processing").get()})()?o.call(i):(t=function(){e()&&(o.call(i),s.state("processing").unbind(t))},s.state("processing").bind(t))}),i.refreshBuffer),i.container=s.ensure(e.container),i.allowedUrls=e.allowedUrls,e.url=window.location.href,s.Messenger.prototype.initialize.call(i,e),a.href=i.origin(),i.add("scheme",a.protocol.replace(/:$/,"")),i.add("previewUrl",e.previewUrl).setter(function(e){var n=null,a,o,r,c=[];return(a=document.createElement("a")).href=e,/\/wp-(admin|includes|content)(\/|$)/.test(a.pathname)?null:(a.search.length>1&&(delete(o=s.utils.parseQueryString(a.search.substr(1))).customize_changeset_uuid,delete o.customize_theme,delete o.customize_messenger_channel,delete o.customize_autosaved,_.isEmpty(o)?a.search="":a.search=t.param(o)),c.push(a),i.scheme.get()+":"!==a.protocol&&((a=document.createElement("a")).href=c[0].href,a.protocol=i.scheme.get()+":",c.unshift(a)),r=document.createElement("a"),_.find(c,function(e){return!_.isUndefined(_.find(i.allowedUrls,function(t){if(r.href=t,a.protocol===r.protocol&&a.host===r.host&&0===a.pathname.indexOf(r.pathname.replace(/\/$/,"")))return n=e.href,!0}))}),n)}),i.bind("ready",i.ready),i.deferred.active.done(_.bind(i.keepPreviewAlive,i)),i.bind("synced",function(){i.send("active")}),i.previewUrl.bind(i.refresh),i.scroll=0,i.bind("scroll",function(e){i.scroll=e}),i.bind("url",function(e){var t,n=!1;i.scroll=0,t=function(){n=!0},i.previewUrl.bind(t),i.previewUrl.set(e),i.previewUrl.unbind(t),n||i.refresh()}),i.bind("documentTitle",function(e){s.setDocumentTitle(e)})},ready:function(e){var t=this,n={},i;n.settings=s.get(),n["settings-modified-while-loading"]=this.settingsModifiedWhileLoading,("resolved"!==this.deferred.active.state()||this.loading)&&(n.scroll=this.scroll),n["edit-shortcut-visibility"]=s.state("editShortcutVisibility").get(),this.send("sync",n),e.currentUrl&&(this.previewUrl.unbind(this.refresh),this.previewUrl.set(e.currentUrl),this.previewUrl.bind(this.refresh)),i={panel:e.activePanels,section:e.activeSections,control:e.activeControls},_(i).each(function(e,t){s[t].each(function(n,i){var a;_.isUndefined(s.settings[t+"s"][i])&&_.isUndefined(e[i])||(e[i]?n.activate():n.deactivate())})}),e.settingValidities&&s._handleSettingValidities({settingValidities:e.settingValidities,focusInvalidControl:!1})},keepPreviewAlive:function e(){var t=this,n,i,a,o;o=function(){i=setTimeout(a,s.settings.timeouts.keepAliveCheck)},n=function(){s.state("previewerAlive").set(!0),clearTimeout(i),o()},a=function(){s.state("previewerAlive").set(!1)},o(),this.bind("ready",n),this.bind("keep-alive",n)},query:function(){},abort:function(){this.loading&&(this.loading.destroy(),delete this.loading)},refresh:function(){var e=this,t;e.send("loading-initiated"),e.abort(),e.loading=new s.PreviewFrame({url:e.url(),previewUrl:e.previewUrl(),query:e.query({excludeCustomizedSaved:!0})||{},container:e.container}),e.settingsModifiedWhileLoading={},t=function(t){e.settingsModifiedWhileLoading[t.id]=!0},s.bind("change",t),e.loading.always(function(){s.unbind("change",t)}),e.loading.done(function(t){var n=this,i;e.preview=n,e.targetWindow(n.targetWindow()),e.channel(n.channel()),i=function(){n.unbind("synced",i),e._previousPreview&&e._previousPreview.destroy(),e._previousPreview=e.preview,e.deferred.active.resolve(),delete e.loading},n.bind("synced",i),e.trigger("ready",t)}),e.loading.fail(function(t){e.send("loading-failed"),"logged out"===t&&(e.preview&&(e.preview.destroy(),delete e.preview),e.login().done(e.refresh)),"cheatin"===t&&e.cheatin()})},login:function(){var e=this,n,i,a;return this._login?this._login:(n=t.Deferred(),this._login=n.promise(),i=new s.Messenger({channel:"login",url:s.settings.url.login}),a=t("<iframe />",{src:s.settings.url.login,title:s.l10n.loginIframeTitle}).appendTo(this.container),i.targetWindow(a[0].contentWindow),i.bind("login",function(){var t=e.refreshNonces();t.always(function(){a.remove(),i.destroy(),delete e._login}),t.done(function(){n.resolve()}),t.fail(function(){e.cheatin(),n.reject()})}),this._login)},cheatin:function(){t(document.body).empty().addClass("cheatin").append("<h1>"+s.l10n.notAllowedHeading+"</h1><p>"+s.l10n.notAllowed+"</p>")},refreshNonces:function(){var e,n=t.Deferred();return n.promise(),(e=wp.ajax.post("customize_refresh_nonces",{wp_customize:"on",customize_theme:s.settings.theme.stylesheet})).done(function(e){s.trigger("nonce-refresh",e),n.resolve()}),e.fail(function(){n.reject()}),n}}),s.settingConstructor={},s.controlConstructor={color:s.ColorControl,media:s.MediaControl,upload:s.UploadControl,image:s.ImageControl,cropped_image:s.CroppedImageControl,site_icon:s.SiteIconControl,header:s.HeaderControl,background:s.BackgroundControl,background_position:s.BackgroundPositionControl,theme:s.ThemeControl,date_time:s.DateTimeControl,code_editor:s.CodeEditorControl},s.panelConstructor={themes:s.ThemesPanel},s.sectionConstructor={themes:s.ThemesSection,outer:s.OuterSection},s._handleSettingValidities=function e(t){var n,i=[],a=!1;_.each(t.settingValidities,function(e,t){var n=s(t);n&&(_.isObject(e)&&_.each(e,function(e,t){var a,o,r=!1;a=new s.Notification(t,_.extend({fromServer:!0},e)),(o=n.notifications(a.code))&&(r=a.type!==o.type||a.message!==o.message||!_.isEqual(a.data,o.data)),r&&n.notifications.remove(t),n.notifications.has(a.code)||n.notifications.add(a),i.push(n.id)}),n.notifications.each(function(t){!t.fromServer||"error"!==t.type||!0!==e&&e[t.code]||n.notifications.remove(t.code)}))}),t.focusInvalidControl&&(n=s.findControlsForSettings(i),_(_.values(n)).find(function(e){return _(e).find(function(e){var t=e.section()&&s.section.has(e.section())&&s.section(e.section()).expanded();return t&&e.expanded&&(t=e.expanded()),t&&(e.focus(),a=!0),a})}),a||_.isEmpty(n)||_.values(n)[0][0].focus())},s.findControlsForSettings=function e(t){var n={},i;return _.each(_.unique(t),function(e){var t=s(e);t&&(i=t.findControls())&&i.length>0&&(n[e]=i)}),n},s.reflowPaneContents=_.bind(function(){var e,n,i,a=[],o=!1;document.activeElement&&(n=t(document.activeElement)),s.panel.each(function(t){if("themes"!==t.id){var n=t.sections(),i=_.pluck(n,"headContainer");a.push(t),e=t.contentContainer.is("ul")?t.contentContainer:t.contentContainer.find("ul:first"),s.utils.areElementListsEqual(i,e.children("[id]"))||(_(n).each(function(t){e.append(t.headContainer)}),o=!0)}}),s.section.each(function(t){var n=t.controls(),i=_.pluck(n,"container");t.panel()||a.push(t),e=t.contentContainer.is("ul")?t.contentContainer:t.contentContainer.find("ul:first"),s.utils.areElementListsEqual(i,e.children("[id]"))||(_(n).each(function(t){e.append(t.container)}),o=!0)}),a.sort(s.utils.prioritySort),i=_.pluck(a,"headContainer"),e=t("#customize-theme-controls .customize-pane-parent"),s.utils.areElementListsEqual(i,e.children())||(_(a).each(function(t){e.append(t.headContainer)}),o=!0),s.panel.each(function(e){var t=e.active();e.active.callbacks.fireWith(e.active,[t,t])}),s.section.each(function(e){var t=e.active();e.active.callbacks.fireWith(e.active,[t,t])}),o&&n&&n.focus(),s.trigger("pane-contents-reflowed")},s),s.state=new s.Values,_.each(["saved","saving","trashing","activated","processing","paneVisible","expandedPanel","expandedSection","changesetDate","selectedChangesetDate","changesetStatus","selectedChangesetStatus","remainingTimeToPublish","previewerAlive","editShortcutVisibility","changesetLocked","previewedDevice"],function(e){s.state.create(e)}),t(function(){function e(){function n(e){e||s.settings.changeset.autosaved||(s.settings.changeset.autosaved=!0,s.previewer.send("autosaving"))}var i,a,o,r=!1;s.unbind("change",e),s.state("saved").bind(n),n(s.state("saved").get()),a=function(){r||(r=!0,s.requestChangesetUpdate({},{autosave:!0}).always(function(){r=!1})),o()},(o=function(){clearTimeout(i),i=setTimeout(function(){a()},s.settings.timeouts.changesetAutoSave)})(),t(document).on("visibilitychange.wp-customize-changeset-update",function(){document.hidden&&a()}),t(window).on("beforeunload.wp-customize-changeset-update",function(){a()})}if(s.settings=window._wpCustomizeSettings,s.l10n=window._wpCustomizeControlsL10n,s.settings&&t.support.postMessage&&(t.support.cors||!s.settings.isCrossDomain)){null===s.PreviewFrame.prototype.sensitivity&&(s.PreviewFrame.prototype.sensitivity=s.settings.timeouts.previewFrameSensitivity),null===s.Previewer.prototype.refreshBuffer&&(s.Previewer.prototype.refreshBuffer=s.settings.timeouts.windowRefresh);var n,i=t(document.body),a=i.children(".wp-full-overlay"),o=t("#customize-info .panel-title.site-title"),r=t(".customize-controls-close"),c=t("#save"),l=t("#customize-save-button-wrapper"),d=t("#publish-settings"),u=t("#customize-footer-actions"),h,p,f,m,g,v,w,b,C,y,x,k,z,S,T,E,D,P,N;s.bind("ready",function(){s.section.add(new s.OuterSection("publish_settings",{title:s.l10n.publishSettings,priority:0,active:s.settings.theme.active}))}),s.section("publish_settings",function(e){function t(){v||(v=s.utils.highlightButton(l,{delay:1e3,focusTarget:c}))}function n(){v&&(v(),v=null)}var i,a,o,r,u,h,p,f,m,g,v,w=1e3;a=new s.Control("trash_changeset",{type:"button",section:e.id,priority:30,input_attrs:{class:"button-link button-link-delete",value:s.l10n.discardChanges}}),s.control.add(a),a.deferred.embedded.done(function(){a.container.find(".button-link").on("click",function(){confirm(s.l10n.trashConfirm)&&wp.customize.previewer.trash()})}),s.control.add(new s.PreviewLinkControl("changeset_preview_link",{section:e.id,priority:100})),r=function(){return!!s.state("activated").get()&&(!s.state("trashing").get()&&"trash"!==s.state("changesetStatus").get()&&(""!==s.state("changesetStatus").get()||!s.state("saved").get()))},e.active.validate=r,o=function(){e.active.set(r())},s.state("activated").bind(o),s.state("trashing").bind(o),s.state("saved").bind(o),s.state("changesetStatus").bind(o),o(),(i=function(){d.toggle(e.active.get()),c.toggleClass("has-next-sibling",e.active.get())})(),e.active.bind(i),s.state("selectedChangesetStatus").bind(n),e.contentContainer.find(".customize-action").text(s.l10n.updating),e.contentContainer.find(".customize-section-back").removeAttr("tabindex"),d.prop("disabled",!1),d.on("click",function(t){t.preventDefault(),e.expanded.set(!e.expanded.get())}),e.expanded.bind(function(e){var i;d.attr("aria-expanded",String(e)),d.toggleClass("active",e),e?n():(""!==(i=s.state("changesetStatus").get())&&"auto-draft"!==i||(i="publish"),s.state("selectedChangesetStatus").get()!==i?t():"future"===s.state("selectedChangesetStatus").get()&&s.state("selectedChangesetDate").get()!==s.state("changesetDate").get()&&t())}),u=new s.Control("changeset_status",{priority:10,type:"radio",section:"publish_settings",setting:s.state("selectedChangesetStatus"),templateId:"customize-selected-changeset-status-control",label:s.l10n.action,choices:s.settings.changeset.statusChoices}),s.control.add(u),(h=new s.DateTimeControl("changeset_scheduled_date",{priority:20,section:"publish_settings",setting:s.state("selectedChangesetDate"),minYear:(new Date).getFullYear(),allowPastDate:!1,includeTime:!0,twelveHourFormat:/a/i.test(s.settings.timeFormat),description:s.l10n.scheduleDescription})).notifications.alt=!0,s.control.add(h),f=function(){s.state("selectedChangesetStatus").set("publish"),s.previewer.save()},g=function(){var e="future"===s.state("changesetStatus").get()&&"future"===s.state("selectedChangesetStatus").get()&&s.state("changesetDate").get()&&s.state("selectedChangesetDate").get()===s.state("changesetDate").get()&&s.utils.getRemainingTime(s.state("changesetDate").get())>=0;e&&!m?m=setInterval(function(){var e=s.utils.getRemainingTime(s.state("changesetDate").get());s.state("remainingTimeToPublish").set(e),e<=0&&(clearInterval(m),m=0,f())},1e3):!e&&m&&(clearInterval(m),m=0)},s.state("changesetDate").bind(g),s.state("selectedChangesetDate").bind(g),s.state("changesetStatus").bind(g),s.state("selectedChangesetStatus").bind(g),g(),h.active.validate=function(){return"future"===s.state("selectedChangesetStatus").get()},(p=function(e){h.active.set("future"===e)})(s.state("selectedChangesetStatus").get()),s.state("selectedChangesetStatus").bind(p),s.state("saving").bind(function(e){e&&"future"===s.state("selectedChangesetStatus").get()&&h.toggleFutureDateNotification(!h.isFutureDate())})}),t("#customize-controls").on("keydown",function(e){var n=13===e.which,i=t(e.target);n&&(i.is("input:not([type=button])")||i.is("select"))&&e.preventDefault()}),t(".customize-info").find("> .accordion-section-title .customize-help-toggle").on("click",function(){var e=t(this).closest(".accordion-section"),n=e.find(".customize-panel-description:first");e.hasClass("cannot-expand")||(e.hasClass("open")?(e.toggleClass("open"),n.slideUp(s.Panel.prototype.defaultExpandedArguments.duration,function(){n.trigger("toggled")}),t(this).attr("aria-expanded",!1)):(n.slideDown(s.Panel.prototype.defaultExpandedArguments.duration,function(){n.trigger("toggled")}),e.toggleClass("open"),t(this).attr("aria-expanded",!0)))}),s.previewer=new s.Previewer({container:"#customize-preview",form:"#customize-controls",previewUrl:s.settings.url.preview,allowedUrls:s.settings.url.allowed},{nonce:s.settings.nonce,query:function(e){var t={wp_customize:"on",customize_theme:s.settings.theme.stylesheet,nonce:this.nonce.preview,customize_changeset_uuid:s.settings.changeset.uuid};return!s.settings.changeset.autosaved&&s.state("saved").get()||(t.customize_autosaved="on"),t.customized=JSON.stringify(s.dirtyValues({unsaved:e&&e.excludeCustomizedSaved})),t},save:function(e){function i(e){h[e.id]=!0}var a=this,o=t.Deferred(),r=s.state("selectedChangesetStatus").get(),c=s.state("selectedChangesetDate").get(),l=s.state("processing"),d,u,h={},p=[],f=[],m=[];return e&&e.status&&(r=e.status),s.state("saving").get()&&(o.reject("already_saving"),o.promise()),s.state("saving").set(!0),u=function(){var l,d,u={},g=s._latestRevision,v="client_side_error";if(s.bind("change",i),s.notifications.remove(v),s.each(function(e){e.notifications.each(function(t){"error"!==t.type||t.fromServer||(p.push(e.id),u[e.id]||(u[e.id]={}),u[e.id][t.code]=t)})}),s.control.each(function(e){(!e.setting||!e.setting.id&&e.active.get())&&e.notifications.each(function(t){"error"===t.type&&m.push([e])})}),f=_.union(m,_.values(s.findControlsForSettings(p))),!_.isEmpty(f))return f[0][0].focus(),s.unbind("change",i),p.length&&s.notifications.add(new s.Notification(v,{message:(1===p.length?s.l10n.saveBlockedError.singular:s.l10n.saveBlockedError.plural).replace(/%s/g,String(p.length)),type:"error",dismissible:!0,saveFailure:!0})),o.rejectWith(a,[{setting_invalidities:u}]),s.state("saving").set(!1),o.promise();d=t.extend(a.query({excludeCustomizedSaved:!1}),{nonce:a.nonce.save,customize_changeset_status:r}),e&&e.date?d.customize_changeset_date=e.date:"future"===r&&c&&(d.customize_changeset_date=c),e&&e.title&&(d.customize_changeset_title=e.title),s.trigger("save-request-params",d),l=wp.ajax.post("customize_save",d),s.state("processing").set(s.state("processing").get()+1),s.trigger("save",l),l.always(function(){s.state("processing").set(s.state("processing").get()-1),s.state("saving").set(!1),s.unbind("change",i)}),s.notifications.each(function(e){e.saveFailure&&s.notifications.remove(e.code)}),l.fail(function(e){var t,i;i={type:"error",dismissible:!0,fromServer:!0,saveFailure:!0},"0"===e?e="not_logged_in":"-1"===e&&(e="invalid_nonce"),"invalid_nonce"===e?a.cheatin():"not_logged_in"===e?(a.preview.iframe.hide(),a.login().done(function(){a.save(),a.preview.iframe.show()})):e.code?"not_future_date"===e.code&&s.section.has("publish_settings")&&s.section("publish_settings").active.get()&&s.control.has("changeset_scheduled_date")?s.control("changeset_scheduled_date").toggleFutureDateNotification(!0).focus():"changeset_locked"!==e.code&&(t=new s.Notification(e.code,_.extend(i,{message:e.message}))):t=new s.Notification("unknown_error",_.extend(i,{message:s.l10n.unknownRequestFail})),t&&s.notifications.add(t),e.setting_validities&&s._handleSettingValidities({settingValidities:e.setting_validities,focusInvalidControl:!0}),o.rejectWith(a,[e]),s.trigger("error",e),"changeset_already_published"===e.code&&e.next_changeset_uuid&&(s.settings.changeset.uuid=e.next_changeset_uuid,s.state("changesetStatus").set(""),s.settings.changeset.branching&&n.send("changeset-uuid",s.settings.changeset.uuid),s.previewer.send("changeset-uuid",s.settings.changeset.uuid))}),l.done(function(e){a.send("saved",e),s.state("changesetStatus").set(e.changeset_status),e.changeset_date&&s.state("changesetDate").set(e.changeset_date),"publish"===e.changeset_status&&(s.each(function(e){e._dirty&&(_.isUndefined(s._latestSettingRevisions[e.id])||s._latestSettingRevisions[e.id]<=g)&&(e._dirty=!1)}),s.state("changesetStatus").set(""),s.settings.changeset.uuid=e.next_changeset_uuid,s.settings.changeset.branching&&n.send("changeset-uuid",s.settings.changeset.uuid)),s._lastSavedRevision=Math.max(g,s._lastSavedRevision),e.setting_validities&&s._handleSettingValidities({settingValidities:e.setting_validities,focusInvalidControl:!0}),o.resolveWith(a,[e]),s.trigger("saved",e),_.isEmpty(h)||s.state("saved").set(!1)})},0===l()?u():(d=function(){0===l()&&(s.state.unbind("change",d),u())},s.state.bind("change",d)),o.promise()},trash:function e(){var n,i,a;s.state("trashing").set(!0),s.state("processing").set(s.state("processing").get()+1),n=wp.ajax.post("customize_trash",{customize_changeset_uuid:s.settings.changeset.uuid,nonce:s.settings.nonce.trash}),s.notifications.add(new s.OverlayNotification("changeset_trashing",{type:"info",message:s.l10n.revertingChanges,loading:!0})),i=function(){var e=document.createElement("a"),n;s.state("changesetStatus").set("trash"),s.each(function(e){e._dirty=!1}),s.state("saved").set(!0),e.href=location.href,delete(n=s.utils.parseQueryString(e.search.substr(1))).changeset_uuid,n.return=s.settings.url.return,e.search=t.param(n),location.replace(e.href)},a=function(e,t){var n=e||"unknown_error";s.state("processing").set(s.state("processing").get()-1),s.state("trashing").set(!1),s.notifications.remove("changeset_trashing"),s.notifications.add(new s.Notification(n,{message:t||s.l10n.unknownError,dismissible:!0,type:"error"}))},n.done(function(e){i(e.message)}),n.fail(function(e){var t=e.code||"trashing_failed";e.success||"non_existent_changeset"===t||"changeset_already_trashed"===t?i(e.message):a(t,e.message)})},getFrontendPreviewUrl:function(){var e=this,n,i;return(i=document.createElement("a")).href=this.previewUrl.get(),n=s.utils.parseQueryString(i.search.substr(1)),s.state("changesetStatus").get()&&"publish"!==s.state("changesetStatus").get()&&(n.customize_changeset_uuid=s.settings.changeset.uuid),s.state("activated").get()||(n.customize_theme=s.settings.theme.stylesheet),i.search=t.param(n),i.href}}),t.ajaxPrefilter(function e(n){/wp_customize=on/.test(n.data)&&(n.data+="&"+t.param({customize_preview_nonce:s.settings.nonce.preview}))}),s.previewer.bind("nonce",function(e){t.extend(this.nonce,e)}),s.bind("nonce-refresh",function(e){t.extend(s.settings.nonce,e),t.extend(s.previewer.nonce,e),s.previewer.send("nonce-refresh",e)}),t.each(s.settings.settings,function(e,t){var n=s.settingConstructor[t.type]||s.Setting;s.add(new n(e,t.value,{transport:t.transport,previewer:s.previewer,dirty:!!t.dirty}))}),t.each(s.settings.panels,function(e,t){var n=s.panelConstructor[t.type]||s.Panel,i;i=_.extend({params:t},t),s.panel.add(new n(e,i))}),t.each(s.settings.sections,function(e,t){var n=s.sectionConstructor[t.type]||s.Section,i;i=_.extend({params:t},t),s.section.add(new n(e,i))}),t.each(s.settings.controls,function(e,t){var n=s.controlConstructor[t.type]||s.Control,i;i=_.extend({params:t},t),s.control.add(new n(e,i))}),_.each(["panel","section","control"],function(e){var t=s.settings.autofocus[e];t&&s[e](t,function(e){e.deferred.embedded.done(function(){s.previewer.deferred.active.done(function(){e.focus()})})})}),s.bind("ready",s.reflowPaneContents),t([s.panel,s.section,s.control]).each(function(e,t){var n=_.debounce(s.reflowPaneContents,s.settings.timeouts.reflowPaneContents);t.bind("add",n),t.bind("change",n),t.bind("remove",n)}),s.bind("ready",function e(){var n,i,a;s.notifications.container=t("#customize-notifications-area"),s.notifications.bind("change",_.debounce(function(){s.notifications.render()})),n=t(".wp-full-overlay-sidebar-content"),s.notifications.bind("rendered",function e(){n.css("top",""),0!==s.notifications.count()&&(i=s.notifications.container.outerHeight()+1,a=parseInt(n.css("top"),10),n.css("top",a+i+"px")),s.notifications.trigger("sidebarTopUpdated")}),s.notifications.render()}),h=s.state,p=h.instance("saved"),f=h.instance("saving"),m=h.instance("trashing"),g=h.instance("activated"),v=h.instance("processing"),w=h.instance("paneVisible"),b=h.instance("expandedPanel"),C=h.instance("expandedSection"),y=h.instance("changesetStatus"),x=h.instance("selectedChangesetStatus"),k=h.instance("changesetDate"),z=h.instance("selectedChangesetDate"),S=h.instance("previewerAlive"),T=h.instance("editShortcutVisibility"),E=h.instance("changesetLocked"),h.bind("change",function(){var e;g()?""===y.get()&&p()?(s.settings.changeset.currentUserCanPublish?c.val(s.l10n.published):c.val(s.l10n.saved),r.find(".screen-reader-text").text(s.l10n.close)):("draft"===x()?p()&&x()===y()?c.val(s.l10n.draftSaved):c.val(s.l10n.saveDraft):"future"===x()?p()&&x()===y()?k.get()!==z.get()?c.val(s.l10n.schedule):c.val(s.l10n.scheduled):c.val(s.l10n.schedule):s.settings.changeset.currentUserCanPublish&&c.val(s.l10n.publish),r.find(".screen-reader-text").text(s.l10n.cancel)):(c.val(s.l10n.activate),r.find(".screen-reader-text").text(s.l10n.cancel)),e=!f()&&!m()&&!E()&&(!g()||!p()||y()!==x()&&""!==y()||"future"===x()&&k.get()!==z.get()),c.prop("disabled",!e)}),x.validate=function(e){return""===e||"auto-draft"===e?null:e},P=s.settings.changeset.currentUserCanPublish?"publish":"draft",y(s.settings.changeset.status),E(Boolean(s.settings.changeset.lockUser)),k(s.settings.changeset.publishDate),z(s.settings.changeset.publishDate),x(""===s.settings.changeset.status||"auto-draft"===s.settings.changeset.status?P:s.settings.changeset.status),x.link(y),p(!0),""===y()&&s.each(function(e){
e._dirty&&p(!1)}),f(!1),g(s.settings.theme.active),v(0),w(!0),b(!1),C(!1),S(!0),T("visible"),s.bind("change",function(){h("saved").get()&&h("saved").set(!1)}),s.settings.changeset.branching&&p.bind(function(e){e||D(!0)}),f.bind(function(e){i.toggleClass("saving",e)}),m.bind(function(e){i.toggleClass("trashing",e)}),s.bind("saved",function(e){h("saved").set(!0),"publish"===e.changeset_status&&h("activated").set(!0)}),g.bind(function(e){e&&s.trigger("activated")}),D=function(e){var n,i;if(history.replaceState){if((n=document.createElement("a")).href=location.href,i=s.utils.parseQueryString(n.search.substr(1)),e){if(i.changeset_uuid===s.settings.changeset.uuid)return;i.changeset_uuid=s.settings.changeset.uuid}else{if(!i.changeset_uuid)return;delete i.changeset_uuid}n.search=t.param(i),history.replaceState({},document.title,n.href)}},s.settings.changeset.branching&&y.bind(function(e){D(""!==e&&"publish"!==e&&"trash"!==e)}),function e(){function n(e){e&&e.lockUser&&(s.settings.changeset.lockUser=e.lockUser),s.state("changesetLocked").set(!0),s.notifications.add(new i("changeset_locked",{lockUser:s.settings.changeset.lockUser,allowOverride:Boolean(e&&e.allowOverride)}))}var i=s.OverlayNotification.extend({templateId:"customize-changeset-locked-notification",lockUser:null,initialize:function(e,t){var n=this,i,a;i=e||"changeset_locked",(a=_.extend({type:"warning",containerClasses:"",lockUser:{}},t)).containerClasses+=" notification-changeset-locked",s.OverlayNotification.prototype.initialize.call(this,i,a)},render:function(){var e=this,t,n,i,a;return n=_.extend({allowOverride:!1,returnUrl:s.settings.url.return,previewUrl:s.previewer.previewUrl.get(),frontendPreviewUrl:s.previewer.getFrontendPreviewUrl()},this),t=s.OverlayNotification.prototype.render.call(n),s.requestChangesetUpdate({},{autosave:!0}).fail(function(e){e.autosaved||t.find(".notice-error").prop("hidden",!1).text(e.message||s.l10n.unknownRequestFail)}),(i=t.find(".customize-notice-take-over-button")).on("click",function(n){n.preventDefault(),a||(i.addClass("disabled"),(a=wp.ajax.post("customize_override_changeset_lock",{wp_customize:"on",customize_theme:s.settings.theme.stylesheet,customize_changeset_uuid:s.settings.changeset.uuid,nonce:s.settings.nonce.override_lock})).done(function(){s.notifications.remove(e.code),s.state("changesetLocked").set(!1)}),a.fail(function(e){var n=e.message||s.l10n.unknownRequestFail;t.find(".notice-error").prop("hidden",!1).text(n),a.always(function(){i.removeClass("disabled")})}),a.always(function(){a=null}))}),t}});s.settings.changeset.lockUser&&n({allowOverride:!0}),t(document).on("heartbeat-send.update_lock_notice",function(e,t){t.check_changeset_lock=!0,t.changeset_uuid=s.settings.changeset.uuid}),t(document).on("heartbeat-tick.update_lock_notice",function(e,t){var i,a="changeset_locked";t.customize_changeset_lock_user&&((i=s.notifications(a))&&i.lockUser.id!==s.settings.changeset.lockUser.id&&s.notifications.remove(a),n({lockUser:t.customize_changeset_lock_user}))}),s.bind("error",function(e){"changeset_locked"===e.code&&e.lock_user&&n({lockUser:e.lock_user})})}(),function(){function e(){var e,n;return(e=document.createElement("a")).href=location.href,n=s.utils.parseQueryString(e.search.substr(1)),s.settings.changeset.latestAutoDraftUuid?n.changeset_uuid=s.settings.changeset.latestAutoDraftUuid:n.customize_autosaved="on",n.return=s.settings.url.return,e.search=t.param(n),e.href}function n(e){var n=document.createElement("a"),i,a=0;n.href=location.href,i=s.utils.parseQueryString(n.search.substr(1)),_.each(e,function(e){void 0!==i[e]&&(a+=1,delete i[e])}),0!==a&&(n.search=t.param(i),history.replaceState({},document.title,n.href))}function i(){r||(wp.ajax.post("customize_dismiss_autosave_or_lock",{wp_customize:"on",customize_theme:s.settings.theme.stylesheet,customize_changeset_uuid:s.settings.changeset.uuid,nonce:s.settings.nonce.dismiss_autosave_or_lock,dismiss_autosave:!0}),r=!0)}function a(){var t="autosave_available",n;s.notifications.add(new s.Notification(t,{message:s.l10n.autosaveNotice,type:"warning",dismissible:!0,render:function(){var t=s.Notification.prototype.render.call(this),n;return(n=t.find("a")).prop("href",e()),n.on("click",function(t){t.preventDefault(),location.replace(e())}),t.find(".notice-dismiss").on("click",i),t}})),n=function(){i(),s.notifications.remove(t),s.unbind("change",n),s.state("changesetStatus").unbind(n)},s.bind("change",n),s.state("changesetStatus").bind(n)}var o=[],r=!1;s.settings.changeset.autosaved&&(s.state("saved").set(!1),o.push("customize_autosaved")),s.settings.changeset.branching||s.settings.changeset.status&&"auto-draft"!==s.settings.changeset.status||o.push("changeset_uuid"),o.length>0&&n(o),(s.settings.changeset.latestAutoDraftUuid||s.settings.changeset.hasAutosaveRevision)&&a()}(),s.previewer.previewUrl()?s.previewer.refresh():s.previewer.previewUrl(s.settings.url.home),c.click(function(e){s.previewer.save(),e.preventDefault()}).keydown(function(e){9!==e.which&&(13===e.which&&s.previewer.save(),e.preventDefault())}),r.keydown(function(e){9!==e.which&&(13===e.which&&this.click(),e.preventDefault())}),t(".collapse-sidebar").on("click",function(){s.state("paneVisible").set(!s.state("paneVisible").get())}),s.state("paneVisible").bind(function(e){a.toggleClass("preview-only",!e),a.toggleClass("expanded",e),a.toggleClass("collapsed",!e),e?t(".collapse-sidebar").attr({"aria-expanded":"true","aria-label":s.l10n.collapseSidebar}):t(".collapse-sidebar").attr({"aria-expanded":"false","aria-label":s.l10n.expandSidebar})}),i.on("keydown",function(e){var n,a=[],o=[],r=[];if(27===e.which&&(t(e.target).is("body")||t.contains(t("#customize-controls")[0],e.target))&&(s.control.each(function(e){e.expanded&&e.expanded()&&_.isFunction(e.collapse)&&a.push(e)}),s.section.each(function(e){e.expanded()&&o.push(e)}),s.panel.each(function(e){e.expanded()&&r.push(e)}),a.length>0&&0===o.length&&(a.length=0),n=a[0]||o[0]||r[0])){if("themes"===n.params.type)return void(i.hasClass("modal-open")?n.closeDetails():s.panel.has("themes")&&s.panel("themes").collapse());n.collapse(),e.preventDefault()}}),t(".customize-controls-preview-toggle").on("click",function(){s.state("paneVisible").set(!s.state("paneVisible").get())}),function e(){var n=t(".wp-full-overlay-sidebar-content"),i,a,o,r,c,l,d;i=function(e){var t=e,n=s.state("expandedSection").get(),i=s.state("expandedPanel").get(),c;if(l&&l.element&&(o(l.element),l.element.find(".description").off("toggled",a)),!t)if(!n&&i&&i.contentContainer)t=i;else{if(i||!n||!n.contentContainer)return void(l=!1);t=n}(c=t.contentContainer.find(".customize-section-title, .panel-meta").first()).length?((l={instance:t,element:c,parent:c.closest(".customize-pane-child"),height:c.outerHeight()}).element.find(".description").on("toggled",a),n&&r(l.element,l.parent)):l=!1},s.state("expandedSection").bind(i),s.state("expandedPanel").bind(i),n.on("scroll",_.throttle(function(){if(l){var e=n.scrollTop(),t;t=d?e===d?0:e>d?1:-1:1,d=e,0!==t&&c(l,e,t)}},8)),s.notifications.bind("sidebarTopUpdated",function(){l&&l.element.hasClass("is-sticky")&&l.element.css("top",n.css("top"))}),o=function(e){e.hasClass("is-sticky")&&e.removeClass("is-sticky").addClass("maybe-sticky is-in-view").css("top",n.scrollTop()+"px")},r=function(e,t){e.hasClass("is-in-view")&&(e.removeClass("maybe-sticky is-in-view").css({width:"",top:""}),t.css("padding-top",""))},a=function(){l.height=l.element.outerHeight()},c=function(e,t,i){var a=e.element,s=e.parent,o=e.height,r=parseInt(a.css("top"),10),c=a.hasClass("maybe-sticky"),l=a.hasClass("is-sticky"),d=a.hasClass("is-in-view"),u;if(!(-1===i))return l&&(r=t,a.removeClass("is-sticky").css({top:r+"px",width:""})),void(d&&t>r+o&&(a.removeClass("is-in-view"),s.css("padding-top","")));if(!c&&t>=o)c=!0,a.addClass("maybe-sticky");else if(0===t)return a.removeClass("maybe-sticky is-in-view is-sticky").css({top:"",width:""}),void s.css("padding-top","");d&&!l?r>=t&&a.addClass("is-sticky").css({top:n.css("top"),width:s.outerWidth()+"px"}):c&&!d&&(a.addClass("is-in-view").css("top",t-o+"px"),s.css("padding-top",o+"px"))}}(),s.previewedDevice=s.state("previewedDevice"),s.bind("ready",function(){_.find(s.settings.previewableDevices,function(e,t){if(!0===e.default)return s.previewedDevice.set(t),!0})}),u.find(".devices button").on("click",function(e){s.previewedDevice.set(t(e.currentTarget).data("device"))}),s.previewedDevice.bind(function(e){var n=t(".wp-full-overlay"),i="";u.find(".devices button").removeClass("active").attr("aria-pressed",!1),u.find(".devices .preview-"+e).addClass("active").attr("aria-pressed",!0),t.each(s.settings.previewableDevices,function(e){i+=" preview-"+e}),n.removeClass(i).addClass("preview-"+e)}),o.length&&s("blogname",function(e){var n=function(){o.text(t.trim(e())||s.l10n.untitledBlogName)};e.bind(n),n()}),n=new s.Messenger({url:s.settings.url.parent,channel:"loader"}),function(){function e(){var e;return s.state("activated").get()?(""!==(e=s.state("changesetStatus").get())&&"auto-draft"!==e||(e="publish"),s.state("selectedChangesetStatus").get()===e&&(("future"!==s.state("selectedChangesetStatus").get()||s.state("selectedChangesetDate").get()===s.state("changesetDate").get())&&(s.state("saved").get()&&"auto-draft"!==s.state("changesetStatus").get()))):0===s._latestRevision}function i(){s.unbind("change",i),s.state("selectedChangesetStatus").unbind(i),s.state("selectedChangesetDate").unbind(i),t(window).on("beforeunload.customize-confirm",function(){if(!e()&&!s.state("changesetLocked").get())return setTimeout(function(){a.removeClass("customize-loading")},1),s.l10n.saveAlert})}function o(){var n=t.Deferred(),i=!1,a=!1;return e()?a=!0:confirm(s.l10n.saveAlert)?(a=!0,s.each(function(e){e._dirty=!1}),t(document).off("visibilitychange.wp-customize-changeset-update"),t(window).off("beforeunload.wp-customize-changeset-update"),r.css("cursor","progress"),""!==s.state("changesetStatus").get()&&(i=!0)):n.reject(),(a||i)&&wp.ajax.send("customize_dismiss_autosave_or_lock",{timeout:500,data:{wp_customize:"on",customize_theme:s.settings.theme.stylesheet,customize_changeset_uuid:s.settings.changeset.uuid,nonce:s.settings.nonce.dismiss_autosave_or_lock,dismiss_autosave:i,dismiss_lock:a}}).always(function(){n.resolve()}),n.promise()}var c=!1;n.bind("back",function(){c=!0}),s.bind("change",i),s.state("selectedChangesetStatus").bind(i),s.state("selectedChangesetDate").bind(i),n.bind("confirm-close",function(){o().done(function(){n.send("confirmed-close",!0)}).fail(function(){n.send("confirmed-close",!1)})}),r.on("click.customize-controls-close",function(e){e.preventDefault(),c?n.send("close"):o().done(function(){t(window).off("beforeunload.customize-confirm"),window.location.href=r.prop("href")})})}(),t.each(["saved","change"],function(e,t){s.bind(t,function(){n.send(t)})}),s.bind("title",function(e){n.send("title",e)}),s.settings.changeset.branching&&n.send("changeset-uuid",s.settings.changeset.uuid),n.send("ready"),t.each({background_image:{controls:["background_preset","background_position","background_size","background_repeat","background_attachment"],callback:function(e){return!!e}},show_on_front:{controls:["page_on_front","page_for_posts"],callback:function(e){return"page"===e}},header_textcolor:{controls:["header_textcolor"],callback:function(e){return"blank"!==e}}},function(e,n){s(e,function(e){t.each(n.controls,function(t,i){s.control(i,function(t){var i=function(e){t.container.toggle(n.callback(e))};i(e.get()),e.bind(i)})})})}),s.control("background_preset",function(e){var t,n,i,a,o,r;t={default:[!1,!1,!1,!1],fill:[!0,!1,!1,!1],fit:[!0,!1,!0,!1],repeat:[!0,!1,!1,!0],custom:[!0,!0,!0,!0]},n=[_wpCustomizeBackground.defaults["default-position-x"],_wpCustomizeBackground.defaults["default-position-y"],_wpCustomizeBackground.defaults["default-size"],_wpCustomizeBackground.defaults["default-repeat"],_wpCustomizeBackground.defaults["default-attachment"]],i={default:n,fill:["left","top","cover","no-repeat","fixed"],fit:["left","top","contain","no-repeat","fixed"],repeat:["left","top","auto","repeat","scroll"]},a=function(e){_.each(["background_position","background_size","background_repeat","background_attachment"],function(n,i){var a=s.control(n);a&&a.container.toggle(t[e][i])})},o=function(e){_.each(["background_position_x","background_position_y","background_size","background_repeat","background_attachment"],function(t,n){var a=s(t);a&&a.set(i[e][n])})},r=e.setting.get(),a(r),e.setting.bind("change",function(e){a(e),"custom"!==e&&o(e)})}),s.control("background_repeat",function(e){e.elements[0].unsync(s("background_repeat")),e.element=new s.Element(e.container.find("input")),e.element.set("no-repeat"!==e.setting()),e.element.bind(function(t){e.setting.set(t?"repeat":"no-repeat")}),e.setting.bind(function(t){e.element.set("no-repeat"!==t)})}),s.control("background_attachment",function(e){e.elements[0].unsync(s("background_attachment")),e.element=new s.Element(e.container.find("input")),e.element.set("fixed"!==e.setting()),e.element.bind(function(t){e.setting.set(t?"scroll":"fixed")}),e.setting.bind(function(t){e.element.set("fixed"!==t)})}),s.control("display_header_text",function(e){var t="";e.elements[0].unsync(s("header_textcolor")),e.element=new s.Element(e.container.find("input")),e.element.set("blank"!==e.setting()),e.element.bind(function(n){n||(t=s("header_textcolor").get()),e.setting.set(n?t:"blank")}),e.setting.bind(function(t){e.element.set("blank"!==t)})}),s("show_on_front","page_on_front","page_for_posts",function(e,t,n){var i=function(){var i=this,a,o,r="show_on_front_page_collision";a=parseInt(t(),10),o=parseInt(n(),10),"page"===e()&&(this===t&&a>0&&s.previewer.previewUrl.set(s.settings.url.home),this===n&&o>0&&s.previewer.previewUrl.set(s.settings.url.home+"?page_id="+o)),"page"===e()&&a&&o&&a===o?e.notifications.add(new s.Notification(r,{type:"error",message:s.l10n.pageOnFrontError})):e.notifications.remove(r)};e.bind(i),t.bind(i),n.bind(i),i.call(e,e()),s.control("show_on_front",function(e){e.deferred.embedded.done(function(){e.container.append(e.getNotificationsContainerElement())})})}),N=t.Deferred(),s.section("custom_css",function(e){e.deferred.embedded.done(function(){e.expanded()?N.resolve(e):e.expanded.bind(function(t){t&&N.resolve(e)})})}),N.done(function e(t){var n=s.control("custom_css");n.container.find(".customize-control-title:first").addClass("screen-reader-text"),t.container.find(".section-description-buttons .section-description-close").on("click",function(){t.container.find(".section-meta .customize-section-description:first").removeClass("open").slideUp(),t.container.find(".customize-help-toggle").attr("aria-expanded","false").focus()}),n&&!n.setting.get()&&(t.container.find(".section-meta .customize-section-description:first").addClass("open").show().trigger("toggled"),t.container.find(".customize-help-toggle").attr("aria-expanded","true"))}),s.control("header_video",function(e){e.deferred.embedded.done(function(){var t=function(){var t=s.section(e.section()),n="video_header_not_available";t&&(e.active.get()?t.notifications.remove(n):t.notifications.add(new s.Notification(n,{type:"info",message:s.l10n.videoHeaderNotice})))};t(),e.active.bind(t)})}),s.previewer.bind("selective-refresh-setting-validities",function e(t){s._handleSettingValidities({settingValidities:t,focusInvalidControl:!1})}),s.previewer.bind("focus-control-for-setting",function(e){var t=[];s.control.each(function(n){var i=_.pluck(n.settings,"id");-1!==_.indexOf(i,e)&&t.push(n)}),t.length&&(t.sort(function(e,t){return e.priority()-t.priority()}),t[0].focus())}),s.previewer.bind("refresh",function(){s.previewer.refresh()}),s.state("paneVisible").bind(function(e){var n;n=window.matchMedia?window.matchMedia("screen and ( max-width: 640px )").matches:t(window).width()<=640,s.state("editShortcutVisibility").set(e||n?"visible":"hidden")}),window.matchMedia&&window.matchMedia("screen and ( max-width: 640px )").addListener(function(){var e=s.state("paneVisible");e.callbacks.fireWith(e,[e.get(),e.get()])}),s.previewer.bind("edit-shortcut-visibility",function(e){s.state("editShortcutVisibility").set(e)}),s.state("editShortcutVisibility").bind(function(e){s.previewer.send("edit-shortcut-visibility",e)}),s.bind("change",e),t(document).one("tinymce-editor-setup",function(){window.tinymce.ui.FloatPanel&&(!window.tinymce.ui.FloatPanel.zIndex||window.tinymce.ui.FloatPanel.zIndex<500001)&&(window.tinymce.ui.FloatPanel.zIndex=500001)}),i.addClass("ready"),s.trigger("ready")}})}(wp,jQuery);