var postboxes;!function($){var e=$(document);postboxes={handle_click:function(){var o=$(this),s=o.parent(".postbox"),t=s.attr("id"),a;"dashboard_browser_nag"!==t&&(s.toggleClass("closed"),a=!s.hasClass("closed"),o.hasClass("handlediv")?o.attr("aria-expanded",a):o.closest(".postbox").find("button.handlediv").attr("aria-expanded",a),"press-this"!==postboxes.page&&postboxes.save_state(postboxes.page),t&&(!s.hasClass("closed")&&$.isFunction(postboxes.pbshow)?postboxes.pbshow(t):s.hasClass("closed")&&$.isFunction(postboxes.pbhide)&&postboxes.pbhide(t)),e.trigger("postbox-toggled",s))},add_postbox_toggles:function(o,s){var t=$(".postbox .hndle, .postbox .handlediv");this.page=o,this.init(o,s),t.on("click.postboxes",this.handle_click),$(".postbox .hndle a").click(function(e){e.stopPropagation()}),$(".postbox a.dismiss").on("click.postboxes",function(e){var o=$(this).parents(".postbox").attr("id")+"-hide";e.preventDefault(),$("#"+o).prop("checked",!1).triggerHandler("click")}),$(".hide-postbox-tog").bind("click.postboxes",function(){var s=$(this),t=s.val(),a=$("#"+t);s.prop("checked")?(a.show(),$.isFunction(postboxes.pbshow)&&postboxes.pbshow(t)):(a.hide(),$.isFunction(postboxes.pbhide)&&postboxes.pbhide(t)),postboxes.save_state(o),postboxes._mark_area(),e.trigger("postbox-toggled",a)}),$('.columns-prefs input[type="radio"]').bind("click.postboxes",function(){var e=parseInt($(this).val(),10);e&&(postboxes._pb_edit(e),postboxes.save_order(o))})},init:function(o,s){var t=$(document.body).hasClass("mobile"),a=$(".postbox .handlediv");$.extend(this,s||{}),$("#wpbody-content").css("overflow","hidden"),$(".meta-box-sortables").sortable({placeholder:"sortable-placeholder",connectWith:".meta-box-sortables",items:".postbox",handle:".hndle",cursor:"move",delay:t?200:0,distance:2,tolerance:"pointer",forcePlaceholderSize:!0,helper:function(e,o){return o.clone().find(":input").attr("name",function(e,o){return"sort_"+parseInt(1e5*Math.random(),10).toString()+"_"+o}).end()},opacity:.65,stop:function(){var e=$(this);if(e.find("#dashboard_browser_nag").is(":visible")&&"dashboard_browser_nag"!=this.firstChild.id)return void e.sortable("cancel");postboxes.save_order(o)},receive:function(o,s){"dashboard_browser_nag"==s.item[0].id&&$(s.sender).sortable("cancel"),postboxes._mark_area(),e.trigger("postbox-moved",s.item)}}),t&&($(document.body).bind("orientationchange.postboxes",function(){postboxes._pb_change()}),this._pb_change()),this._mark_area(),a.each(function(){var e=$(this);e.attr("aria-expanded",!e.parent(".postbox").hasClass("closed"))})},save_state:function(e){var o,s;"nav-menus"!==e&&(o=$(".postbox").filter(".closed").map(function(){return this.id}).get().join(","),s=$(".postbox").filter(":hidden").map(function(){return this.id}).get().join(","),$.post(ajaxurl,{action:"closed-postboxes",closed:o,hidden:s,closedpostboxesnonce:jQuery("#closedpostboxesnonce").val(),page:e}))},save_order:function(e){var o,s=$(".columns-prefs input:checked").val()||0;o={action:"meta-box-order",_ajax_nonce:$("#meta-box-order-nonce").val(),page_columns:s,page:e},$(".meta-box-sortables").each(function(){o["order["+this.id.split("-")[0]+"]"]=$(this).sortable("toArray").join(",")}),$.post(ajaxurl,o)},_mark_area:function(){var e=$("div.postbox:visible").length,o=$("#post-body #side-sortables");$("#dashboard-widgets .meta-box-sortables:visible").each(function(){var o=$(this);1==e||o.children(".postbox:visible").length?o.removeClass("empty-container"):(o.addClass("empty-container"),o.attr("data-emptyString",postBoxL10n.postBoxEmptyString))}),o.length&&(o.children(".postbox:visible").length?o.removeClass("empty-container"):"280px"==$("#postbox-container-1").css("width")&&o.addClass("empty-container"))},_pb_edit:function(e){var o=$(".metabox-holder").get(0);o&&(o.className=o.className.replace(/columns-\d+/,"columns-"+e)),$(document).trigger("postboxes-columnchange")},_pb_change:function(){var e=$('label.columns-prefs-1 input[type="radio"]');switch(window.orientation){case 90:case-90:e.length&&e.is(":checked")||this._pb_edit(2);break;case 0:case 180:$("#poststuff").length?this._pb_edit(1):e.length&&e.is(":checked")||this._pb_edit(2);break}},pbshow:!1,pbhide:!1}}(jQuery);