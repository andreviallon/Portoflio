!function($){$.fn.farbtastic=function(t){return $.farbtastic(this,t),this},$.farbtastic=function(t,a){var t=$(t).get(0);return t.farbtastic||(t.farbtastic=new $._farbtastic(t,a))},$._farbtastic=function(t,a){var r=this;$(t).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');var e=$(".farbtastic",t);r.wheel=$(".wheel",t).get(0),r.radius=84,r.square=100,r.width=194,navigator.appVersion.match(/MSIE [0-6]\./)&&$("*",e).each(function(){if("none"!=this.currentStyle.backgroundImage){var t=this.currentStyle.backgroundImage;t=this.currentStyle.backgroundImage.substring(5,t.length-2),$(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+t+"')"})}}),r.linkTo=function(t){return"object"==typeof r.callback&&$(r.callback).unbind("keyup",r.updateValue),r.color=null,"function"==typeof t?r.callback=t:"object"!=typeof t&&"string"!=typeof t||(r.callback=$(t),r.callback.bind("keyup",r.updateValue),r.callback.get(0).value&&r.setColor(r.callback.get(0).value)),this},r.updateValue=function(t){this.value&&this.value!=r.color&&r.setColor(this.value)},r.setColor=function(t){var a=r.unpack(t);return r.color!=t&&a&&(r.color=t,r.rgb=a,r.hsl=r.RGBToHSL(r.rgb),r.updateDisplay()),this},r.setHSL=function(t){return r.hsl=t,r.rgb=r.HSLToRGB(t),r.color=r.pack(r.rgb),r.updateDisplay(),this},r.widgetCoords=function(t){var a=$(r.wheel).offset();return{x:t.pageX-a.left-r.width/2,y:t.pageY-a.top-r.width/2}},r.mousedown=function(t){document.dragging||($(document).bind("mousemove",r.mousemove).bind("mouseup",r.mouseup),document.dragging=!0);var a=r.widgetCoords(t);return r.circleDrag=2*Math.max(Math.abs(a.x),Math.abs(a.y))>r.square,r.mousemove(t),!1},r.mousemove=function(t){var a=r.widgetCoords(t);if(r.circleDrag){var e=Math.atan2(a.x,-a.y)/6.28;e<0&&(e+=1),r.setHSL([e,r.hsl[1],r.hsl[2]])}else{var o=Math.max(0,Math.min(1,-a.x/r.square+.5)),n=Math.max(0,Math.min(1,-a.y/r.square+.5));r.setHSL([r.hsl[0],o,n])}return!1},r.mouseup=function(){$(document).unbind("mousemove",r.mousemove),$(document).unbind("mouseup",r.mouseup),document.dragging=!1},r.updateDisplay=function(){var t=6.28*r.hsl[0];$(".h-marker",e).css({left:Math.round(Math.sin(t)*r.radius+r.width/2)+"px",top:Math.round(-Math.cos(t)*r.radius+r.width/2)+"px"}),$(".sl-marker",e).css({left:Math.round(r.square*(.5-r.hsl[1])+r.width/2)+"px",top:Math.round(r.square*(.5-r.hsl[2])+r.width/2)+"px"}),$(".color",e).css("backgroundColor",r.pack(r.HSLToRGB([r.hsl[0],1,.5]))),"object"==typeof r.callback?($(r.callback).css({backgroundColor:r.color,color:r.hsl[2]>.5?"#000":"#fff"}),$(r.callback).each(function(){this.value&&this.value!=r.color&&(this.value=r.color)})):"function"==typeof r.callback&&r.callback.call(r,r.color)},r.pack=function(t){var a=Math.round(255*t[0]),r=Math.round(255*t[1]),e=Math.round(255*t[2]);return"#"+(a<16?"0":"")+a.toString(16)+(r<16?"0":"")+r.toString(16)+(e<16?"0":"")+e.toString(16)},r.unpack=function(t){return 7==t.length?[parseInt("0x"+t.substring(1,3))/255,parseInt("0x"+t.substring(3,5))/255,parseInt("0x"+t.substring(5,7))/255]:4==t.length?[parseInt("0x"+t.substring(1,2))/15,parseInt("0x"+t.substring(2,3))/15,parseInt("0x"+t.substring(3,4))/15]:void 0},r.HSLToRGB=function(t){var a,r,e,o,n,s=t[0],u=t[1],i=t[2];return r=i<=.5?i*(u+1):i+u-i*u,a=2*i-r,[this.hueToRGB(a,r,s+.33333),this.hueToRGB(a,r,s),this.hueToRGB(a,r,s-.33333)]},r.hueToRGB=function(t,a,r){return r=r<0?r+1:r>1?r-1:r,6*r<1?t+(a-t)*r*6:2*r<1?a:3*r<2?t+(a-t)*(.66666-r)*6:t},r.RGBToHSL=function(t){var a,r,e,o,n,s,u=t[0],i=t[1],c=t[2];return a=Math.min(u,Math.min(i,c)),r=Math.max(u,Math.max(i,c)),e=r-a,s=(a+r)/2,n=0,s>0&&s<1&&(n=e/(s<.5?2*s:2-2*s)),o=0,e>0&&(r==u&&r!=i&&(o+=(i-c)/e),r==i&&r!=c&&(o+=2+(c-u)/e),r==c&&r!=u&&(o+=4+(u-i)/e),o/=6),[o,n,s]},$("*",e).mousedown(r.mousedown),r.setColor("#000000"),a&&r.linkTo(a)}}(jQuery);