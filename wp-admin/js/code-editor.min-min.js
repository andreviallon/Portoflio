void 0===window.wp&&(window.wp={}),void 0===window.wp.codeEditor&&(window.wp.codeEditor={}),function(t,n){"use strict";function o(n,o){function e(){o.onUpdateErrorNotice&&!_.isEqual(r,s)&&(o.onUpdateErrorNotice(r,n),s=r)}function i(){var i=n.getOption("lint");return!!i&&(!0===i?i={}:_.isObject(i)&&(i=t.extend({},i)),i.options||(i.options={}),"javascript"===o.codemirror.mode&&o.jshint&&t.extend(i.options,o.jshint),"css"===o.codemirror.mode&&o.csslint&&t.extend(i.options,o.csslint),"htmlmixed"===o.codemirror.mode&&o.htmlhint&&(i.options.rules=t.extend({},o.htmlhint),o.jshint&&(i.options.rules.jshint=o.jshint),o.csslint&&(i.options.rules.csslint=o.csslint)),i.onUpdateLinting=function(t){return function(i,a,d){var c=_.filter(i,function(t){return"error"===t.severity});t&&t.apply(i,a,d),_.isEqual(c,r)||(r=c,o.onChangeLintingErrors&&o.onChangeLintingErrors(c,i,a,d),(!n.state.focused||0===r.length||s.length>0)&&e())}}(i.onUpdateLinting),i)}var r=[],s=[];n.setOption("lint",i()),n.on("optionChange",function(t,o){var s,a,d="CodeMirror-lint-markers";"lint"===o&&(a=n.getOption("gutters")||[],!0===(s=n.getOption("lint"))?(_.contains(a,d)||n.setOption("gutters",[d].concat(a)),n.setOption("lint",i())):s||n.setOption("gutters",_.without(a,d)),n.getOption("lint")?n.performLint():(r=[],e()))}),n.on("blur",e),n.on("startCompletion",function(){n.off("blur",e)}),n.on("endCompletion",function(){var t=500;n.on("blur",e),_.delay(function(){n.state.focused||e()},t)}),t(document.body).on("mousedown",function(o){!n.state.focused||t.contains(n.display.wrapper,o.target)||t(o.target).hasClass("CodeMirror-hint")||e()})}function e(n,o){var e=t(n.getTextArea());n.on("blur",function(){e.data("next-tab-blurs",!1)}),n.on("keydown",function(t,i){var r=9,s;return 27===i.keyCode?void e.data("next-tab-blurs",!0):void(9===i.keyCode&&e.data("next-tab-blurs")&&(i.shiftKey?o.onTabPrevious(n,i):o.onTabNext(n,i),e.data("next-tab-blurs",!1),i.preventDefault()))})}n.codeEditor.defaultSettings={codemirror:{},csslint:{},htmlhint:{},jshint:{},onTabNext:function(){},onTabPrevious:function(){},onChangeLintingErrors:function(){},onUpdateErrorNotice:function(){}},n.codeEditor.initialize=function(i,r){var s,a,d,c;return s=t("string"==typeof i?"#"+i:i),(d=t.extend({},n.codeEditor.defaultSettings,r)).codemirror=t.extend({},d.codemirror),o(a=n.CodeMirror.fromTextArea(s[0],d.codemirror),d),c={settings:d,codemirror:a},a.showHint&&a.on("keyup",function(t,o){var e,i,r,s,d=/^[a-zA-Z]$/.test(o.key);a.state.completionActive&&d||"string"!==(s=a.getTokenAt(a.getCursor())).type&&"comment"!==s.type&&(r=n.CodeMirror.innerMode(a.getMode(),s.state).mode.name,i=a.doc.getLine(a.doc.getCursor().line).substr(0,a.doc.getCursor().ch),"html"===r||"xml"===r?e="<"===o.key||"/"===o.key&&"tag"===s.type||d&&"tag"===s.type||d&&"attribute"===s.type||"="===s.string&&s.state.htmlState&&s.state.htmlState.tagName:"css"===r?e=d||":"===o.key||" "===o.key&&/:\s+$/.test(i):"javascript"===r?e=d||"."===o.key:"clike"===r&&"application/x-httpd-php"===a.options.mode&&(e="keyword"===s.type||"variable"===s.type),e&&a.showHint({completeSingle:!1}))}),e(a,r),c}}(window.jQuery,window.wp);