var tagBox,array_unique_noempty;!function($){var t=window.tagsSuggestL10n&&window.tagsSuggestL10n.tagDelimiter||",";array_unique_noempty=function(t){var e=[];return $.each(t,function(t,a){(a=$.trim(a))&&-1===$.inArray(a,e)&&e.push(a)}),e},tagBox={clean:function(e){return","!==t&&(e=e.replace(new RegExp(t,"g"),",")),e=e.replace(/\s*,\s*/g,",").replace(/,+/g,",").replace(/[,\s]+$/,"").replace(/^[,\s]+/,""),","!==t&&(e=e.replace(/,/g,t)),e},parseTags:function(e){var a=e.id,s=a.split("-check-num-")[1],n=$(e).closest(".tagsdiv"),i=n.find(".the-tags"),c=i.val().split(t),o=[];return delete c[s],$.each(c,function(t,e){(e=$.trim(e))&&o.push(e)}),i.val(this.clean(o.join(t))),this.quickClicks(n),!1},quickClicks:function(e){var a=$(".the-tags",e),s=$(".tagchecklist",e),n=$(e).attr("id"),i,c;a.length&&(c=a.prop("disabled"),i=a.val().split(t),s.empty(),$.each(i,function(t,e){var a,i;(e=$.trim(e))&&(a=$("<li />").text(e),c||(i=$('<button type="button" id="'+n+"-check-num-"+t+'" class="ntdelbutton"><span class="remove-tag-icon" aria-hidden="true"></span><span class="screen-reader-text">'+window.tagsSuggestL10n.removeTerm+" "+a.html()+"</span></button>"),i.on("click keypress",function(t){"click"!==t.type&&13!==t.keyCode&&32!==t.keyCode||(13!==t.keyCode&&32!==t.keyCode||$(this).closest(".tagsdiv").find("input.newtag").focus(),tagBox.userAction="remove",tagBox.parseTags(this))}),a.prepend("&nbsp;").prepend(i)),s.append(a))}),tagBox.screenReadersMessage())},flushTags:function(e,a,s){var n,i,c,o=$(".the-tags",e),r=$("input.newtag",e);return a=a||!1,void 0!==(c=a?$(a).text():r.val())&&""!==c&&(n=o.val(),i=n?n+t+c:c,i=this.clean(i),i=array_unique_noempty(i.split(t)).join(t),o.val(i),this.quickClicks(e),a||r.val(""),void 0===s&&r.focus(),!1)},get:function(t){var e=t.substr(t.indexOf("-")+1);$.post(ajaxurl,{action:"get-tagcloud",tax:e},function(a,s){0!==a&&"success"==s&&(a=$('<div id="tagcloud-'+e+'" class="the-tagcloud">'+a+"</div>"),$("a",a).click(function(){return tagBox.userAction="add",tagBox.flushTags($("#"+e),this),!1}),$("#"+t).after(a))})},userAction:"",screenReadersMessage:function(){var t;switch(this.userAction){case"remove":t=window.tagsSuggestL10n.termRemoved;break;case"add":t=window.tagsSuggestL10n.termAdded;break;default:return}window.wp.a11y.speak(t,"assertive")},init:function(){var t=$("div.ajaxtag");$(".tagsdiv").each(function(){tagBox.quickClicks(this)}),$(".tagadd",t).click(function(){tagBox.userAction="add",tagBox.flushTags($(this).closest(".tagsdiv"))}),$("input.newtag",t).keypress(function(t){13==t.which&&(tagBox.userAction="add",tagBox.flushTags($(this).closest(".tagsdiv")),t.preventDefault(),t.stopPropagation())}).keypress(function(t){13==t.which&&(t.preventDefault(),t.stopPropagation())}).each(function(t,e){$(e).wpTagsSuggest()}),$("#post").submit(function(){$("div.tagsdiv").each(function(){tagBox.flushTags(this,!1,1)})}),$(".tagcloud-link").click(function(){tagBox.get($(this).attr("id")),$(this).attr("aria-expanded","true").unbind().click(function(){$(this).attr("aria-expanded","false"===$(this).attr("aria-expanded")?"true":"false").siblings(".the-tagcloud").toggle()})})}}}(jQuery);