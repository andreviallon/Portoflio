void 0===window.wp&&(window.wp={}),void 0===window.wp.codeEditor&&(window.wp.codeEditor={}),function(t,n){"use strict";function e(n,e){function o(){e.onUpdateErrorNotice&&!_.isEqual(r,s)&&(e.onUpdateErrorNotice(r,n),s=r)}function i(){var i=n.getOption("lint"),a;return!!i&&(!0===i?i={}:_.isObject(i)&&(i=t.extend({},i)),i.options||(i.options={}),"javascript"===e.codemirror.mode&&e.jshint&&t.extend(i.options,e.jshint),"css"===e.codemirror.mode&&e.csslint&&t.extend(i.options,e.csslint),"htmlmixed"===e.codemirror.mode&&e.htmlhint&&(i.options.rules=t.extend({},e.htmlhint),e.jshint&&(i.options.rules.jshint=e.jshint),e.csslint&&(i.options.rules.csslint=e.csslint)),i.onUpdateLinting=(a=i.onUpdateLinting,function(t,i,d){var c=_.filter(t,function(t){return"error"===t.severity});a&&a.apply(t,i,d),_.isEqual(c,r)||(r=c,e.onChangeLintingErrors&&e.onChangeLintingErrors(c,t,i,d),(!n.state.focused||0===r.length||s.length>0)&&o())}),i)}var r=[],s=[];n.setOption("lint",i()),n.on("optionChange",function(t,e){var s,a,d="CodeMirror-lint-markers";"lint"===e&&(a=n.getOption("gutters")||[],!0===(s=n.getOption("lint"))?(_.contains(a,d)||n.setOption("gutters",[d].concat(a)),n.setOption("lint",i())):s||n.setOption("gutters",_.without(a,d)),n.getOption("lint")?n.performLint():(r=[],o()))}),n.on("blur",o),n.on("startCompletion",function(){n.off("blur",o)}),n.on("endCompletion",function(){var t=500;n.on("blur",o),_.delay(function(){n.state.focused||o()},500)}),t(document.body).on("mousedown",function(e){!n.state.focused||t.contains(n.display.wrapper,e.target)||t(e.target).hasClass("CodeMirror-hint")||o()})}function o(n,e){var o=t(n.getTextArea());n.on("blur",function(){o.data("next-tab-blurs",!1)}),n.on("keydown",function t(i,r){var s=9,a=27;27!==r.keyCode?9===r.keyCode&&o.data("next-tab-blurs")&&(r.shiftKey?e.onTabPrevious(n,r):e.onTabNext(n,r),o.data("next-tab-blurs",!1),r.preventDefault()):o.data("next-tab-blurs",!0)})}n.codeEditor.defaultSettings={codemirror:{},csslint:{},htmlhint:{},jshint:{},onTabNext:function(){},onTabPrevious:function(){},onChangeLintingErrors:function(){},onUpdateErrorNotice:function(){}},n.codeEditor.initialize=function i(r,s){var a,d,c,u;return a=t("string"==typeof r?"#"+r:r),(c=t.extend({},n.codeEditor.defaultSettings,s)).codemirror=t.extend({},c.codemirror),e(d=n.CodeMirror.fromTextArea(a[0],c.codemirror),c),u={settings:c,codemirror:d},d.showHint&&d.on("keyup",function(t,e){var o,i=/^[a-zA-Z]$/.test(e.key),r,s,a;d.state.completionActive&&i||"string"!==(a=d.getTokenAt(d.getCursor())).type&&"comment"!==a.type&&(s=n.CodeMirror.innerMode(d.getMode(),a.state).mode.name,r=d.doc.getLine(d.doc.getCursor().line).substr(0,d.doc.getCursor().ch),"html"===s||"xml"===s?o="<"===e.key||"/"===e.key&&"tag"===a.type||i&&"tag"===a.type||i&&"attribute"===a.type||"="===a.string&&a.state.htmlState&&a.state.htmlState.tagName:"css"===s?o=i||":"===e.key||" "===e.key&&/:\s+$/.test(r):"javascript"===s?o=i||"."===e.key:"clike"===s&&"application/x-httpd-php"===d.options.mode&&(o="keyword"===a.type||"variable"===a.type),o&&d.showHint({completeSingle:!1}))}),o(d,s),u}}(window.jQuery,window.wp);