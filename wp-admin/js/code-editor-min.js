void 0===window.wp&&(window.wp={}),void 0===window.wp.codeEditor&&(window.wp.codeEditor={}),function($,t){"use strict";function n(t,n){function e(){n.onUpdateErrorNotice&&!_.isEqual(i,r)&&(n.onUpdateErrorNotice(i,t),r=i)}function o(){var o=t.getOption("lint");return!!o&&(!0===o?o={}:_.isObject(o)&&(o=$.extend({},o)),o.options||(o.options={}),"javascript"===n.codemirror.mode&&n.jshint&&$.extend(o.options,n.jshint),"css"===n.codemirror.mode&&n.csslint&&$.extend(o.options,n.csslint),"htmlmixed"===n.codemirror.mode&&n.htmlhint&&(o.options.rules=$.extend({},n.htmlhint),n.jshint&&(o.options.rules.jshint=n.jshint),n.csslint&&(o.options.rules.csslint=n.csslint)),o.onUpdateLinting=function(o){return function(s,a,d){var c=_.filter(s,function(t){return"error"===t.severity});o&&o.apply(s,a,d),_.isEqual(c,i)||(i=c,n.onChangeLintingErrors&&n.onChangeLintingErrors(c,s,a,d),(!t.state.focused||0===i.length||r.length>0)&&e())}}(o.onUpdateLinting),o)}var i=[],r=[];t.setOption("lint",o()),t.on("optionChange",function(n,r){var s,a,d="CodeMirror-lint-markers";"lint"===r&&(a=t.getOption("gutters")||[],s=t.getOption("lint"),!0===s?(_.contains(a,d)||t.setOption("gutters",[d].concat(a)),t.setOption("lint",o())):s||t.setOption("gutters",_.without(a,d)),t.getOption("lint")?t.performLint():(i=[],e()))}),t.on("blur",e),t.on("startCompletion",function(){t.off("blur",e)}),t.on("endCompletion",function(){var n=500;t.on("blur",e),_.delay(function(){t.state.focused||e()},500)}),$(document.body).on("mousedown",function(n){!t.state.focused||$.contains(t.display.wrapper,n.target)||$(n.target).hasClass("CodeMirror-hint")||e()})}function e(t,n){var e=$(t.getTextArea());t.on("blur",function(){e.data("next-tab-blurs",!1)}),t.on("keydown",function o(i,r){var s=9,a=27;if(27===r.keyCode)return void e.data("next-tab-blurs",!0);9===r.keyCode&&e.data("next-tab-blurs")&&(r.shiftKey?n.onTabPrevious(t,r):n.onTabNext(t,r),e.data("next-tab-blurs",!1),r.preventDefault())})}t.codeEditor.defaultSettings={codemirror:{},csslint:{},htmlhint:{},jshint:{},onTabNext:function(){},onTabPrevious:function(){},onChangeLintingErrors:function(){},onUpdateErrorNotice:function(){}},t.codeEditor.initialize=function o(i,r){var s,a,d,c;return s=$("string"==typeof i?"#"+i:i),d=$.extend({},t.codeEditor.defaultSettings,r),d.codemirror=$.extend({},d.codemirror),a=t.CodeMirror.fromTextArea(s[0],d.codemirror),n(a,d),c={settings:d,codemirror:a},a.showHint&&a.on("keyup",function(n,e){var o,i=/^[a-zA-Z]$/.test(e.key),r,s,d;a.state.completionActive&&i||(d=a.getTokenAt(a.getCursor()),"string"!==d.type&&"comment"!==d.type&&(s=t.CodeMirror.innerMode(a.getMode(),d.state).mode.name,r=a.doc.getLine(a.doc.getCursor().line).substr(0,a.doc.getCursor().ch),"html"===s||"xml"===s?o="<"===e.key||"/"===e.key&&"tag"===d.type||i&&"tag"===d.type||i&&"attribute"===d.type||"="===d.string&&d.state.htmlState&&d.state.htmlState.tagName:"css"===s?o=i||":"===e.key||" "===e.key&&/:\s+$/.test(r):"javascript"===s?o=i||"."===e.key:"clike"===s&&"application/x-httpd-php"===a.options.mode&&(o="keyword"===d.type||"variable"===d.type),o&&a.showHint({completeSingle:!1})))}),e(a,r),c}}(window.jQuery,window.wp);