!function(t,e,o){"use strict";var i=e(t),n=e(document),s=e("#wpadminbar"),f=e("#wpfooter");e(function(){function o(){var t=x.value.length;k&&!k.isHidden()||(k||"tinymce"!==M)&&(t<y?j():parseInt(x.style.height,10)<x.scrollHeight&&(x.style.height=Math.ceil(x.scrollHeight)+"px",d()),y=t)}function a(){var t=i.width();(N={windowHeight:i.height(),windowWidth:t,adminBarHeight:t>600?s.outerHeight():0,toolsHeight:m.outerHeight()||0,menuBarHeight:B.outerHeight()||0,visualTopHeight:w.outerHeight()||0,textTopHeight:b.outerHeight()||0,bottomHeight:T.outerHeight()||0,statusBarHeight:C.outerHeight()||0,sideSortablesHeight:S.height()||0}).menuBarHeight<3&&(N.menuBarHeight=0)}function d(e){if(!E||!E.settings.visible){var s=i.scrollTop(),d=e&&e.type,c="scroll"!==d,u=k&&!k.isHidden(),r=L,l=z.offset().top,p=1,g=h.width(),x,y,_,A,W,D,X,M,j;!c&&N.windowHeight||a(),u||"resize"!==d||o(),u?(x=w,y=H,X=N.visualTopHeight):(x=b,y=v,X=N.textTopHeight),(u||x.length)&&(D=x.parent().offset().top,M=y.offset().top,(W=(j=y.outerHeight())>(W=u?L+X:L+20)+5)?((!K||c)&&s>=D-N.toolsHeight-N.adminBarHeight&&s<=D-N.toolsHeight-N.adminBarHeight+j-r?(K=!0,m.css({position:"fixed",top:N.adminBarHeight,width:g}),u&&B.length&&B.css({position:"fixed",top:N.adminBarHeight+N.toolsHeight,width:g-2-(u?0:x.outerWidth()-x.width())}),x.css({position:"fixed",top:N.adminBarHeight+N.toolsHeight+N.menuBarHeight,width:g-2-(u?0:x.outerWidth()-x.width())})):(K||c)&&(s<=D-N.toolsHeight-N.adminBarHeight?(K=!1,m.css({position:"absolute",top:0,width:g}),u&&B.length&&B.css({position:"absolute",top:0,width:g-2}),x.css({position:"absolute",top:N.menuBarHeight,width:g-2-(u?0:x.outerWidth()-x.width())})):s>=D-N.toolsHeight-N.adminBarHeight+j-r&&(K=!1,m.css({position:"absolute",top:j-r,width:g}),u&&B.length&&B.css({position:"absolute",top:j-r,width:g-2}),x.css({position:"absolute",top:j-r+N.menuBarHeight,width:g-2-(u?0:x.outerWidth()-x.width())}))),(!R||c&&V)&&s+N.windowHeight<=M+j+N.bottomHeight+N.statusBarHeight+1?e&&e.deltaHeight>0&&e.deltaHeight<100?t.scrollBy(0,e.deltaHeight):u&&V&&(R=!0,C.css({position:"fixed",bottom:N.bottomHeight,visibility:"",width:g-2}),T.css({position:"fixed",bottom:0,width:g})):(!V&&R||(R||c)&&s+N.windowHeight>M+j+N.bottomHeight+N.statusBarHeight-1)&&(R=!1,C.attr("style",V?"":"visibility: hidden;"),T.attr("style",""))):c&&(m.css({position:"absolute",top:0,width:g}),u&&B.length&&B.css({position:"absolute",top:0,width:g-2}),x.css({position:"absolute",top:N.menuBarHeight,width:g-2-(u?0:x.outerWidth()-x.width())}),C.attr("style",V?"":"visibility: hidden;"),T.attr("style","")),O.width()<300&&N.windowWidth>600&&n.height()>S.height()+l+120&&N.windowHeight<j?(N.sideSortablesHeight+F+I>N.windowHeight||Y||U?s+F<=l?(S.attr("style",""),Y=U=!1):s>P?Y?(Y=!1,_=S.offset().top-N.adminBarHeight,(A=f.offset().top)<_+N.sideSortablesHeight+I&&(_=A-N.sideSortablesHeight-12),S.css({position:"absolute",top:_,bottom:""})):!U&&N.sideSortablesHeight+S.offset().top+I<s+N.windowHeight&&(U=!0,S.css({position:"fixed",top:"auto",bottom:I})):s<P&&(U?(U=!1,_=S.offset().top-I,(A=f.offset().top)<_+N.sideSortablesHeight+I&&(_=A-N.sideSortablesHeight-12),S.css({position:"absolute",top:_,bottom:""})):!Y&&S.offset().top>=s+F&&(Y=!0,S.css({position:"fixed",top:F,bottom:""}))):(s>=l-F?S.css({position:"fixed",top:F}):S.attr("style",""),Y=U=!1),P=s):(S.attr("style",""),Y=U=!1),c&&(h.css({paddingTop:N.toolsHeight}),u?H.css({paddingTop:N.visualTopHeight+N.menuBarHeight}):v.css({marginTop:N.textTopHeight})))}}function c(){o(),d()}function u(t){for(var e=1;e<6;e++)setTimeout(t,500*e)}function r(){clearTimeout(D),D=setTimeout(d,100)}function l(){t.pageYOffset&&t.pageYOffset>X&&t.scrollTo(t.pageXOffset,0),g.addClass("wp-editor-expand"),i.on("scroll.editor-expand resize.editor-expand",function(t){d(t.type),r()}),n.on("wp-collapse-menu.editor-expand postboxes-columnchange.editor-expand editor-classchange.editor-expand",d).on("postbox-toggled.editor-expand postbox-moved.editor-expand",function(){!Y&&!U&&t.pageYOffset>F&&(U=!0,t.scrollBy(0,-1),d(),t.scrollBy(0,1)),d()}).on("wp-window-resized.editor-expand",function(){k&&!k.isHidden()?k.execCommand("wpAutoResize"):o()}),v.on("focus.editor-expand input.editor-expand propertychange.editor-expand",o),A(),E&&E.pubsub.subscribe("hidden",c),k&&(k.settings.wp_autoresize_on=!0,k.execCommand("wpAutoResizeOn"),k.isHidden()||k.execCommand("wpAutoResize")),k&&!k.isHidden()||o(),d(),n.trigger("editor-expand-on")}function p(){var o=parseInt(t.getUserSetting("ed_size",300),10);o<50?o=50:o>5e3&&(o=5e3),t.pageYOffset&&t.pageYOffset>X&&t.scrollTo(t.pageXOffset,0),g.removeClass("wp-editor-expand"),i.off(".editor-expand"),n.off(".editor-expand"),v.off(".editor-expand"),W(),E&&E.pubsub.unsubscribe("hidden",c),e.each([w,b,m,B,T,C,h,H,v,S],function(t,e){e&&e.attr("style","")}),K=R=Y=U=!1,k&&(k.settings.wp_autoresize_on=!1,k.execCommand("wpAutoResizeOff"),k.isHidden()||(v.hide(),o&&k.theme.resizeTo(null,o))),o&&v.height(o),n.trigger("editor-expand-off")}var g=e("#postdivrich"),h=e("#wp-content-wrap"),m=e("#wp-content-editor-tools"),w=e(),H=e(),b=e("#ed_toolbar"),v=e("#content"),x=v[0],y=0,T=e("#post-status-info"),B=e(),C=e(),S=e("#side-sortables"),O=e("#postbox-container-1"),z=e("#post-body"),E=t.wp.editor&&t.wp.editor.fullscreen,k,A=function(){},W=function(){},K=!1,R=!1,Y=!1,U=!1,D,P=0,X=130,F=56,I=20,L=300,M=h.hasClass("tmce-active")?"tinymce":"html",V=!!parseInt(t.getUserSetting("hidetb"),10),N={windowHeight:0,windowWidth:0,adminBarHeight:0,toolsHeight:0,menuBarHeight:0,visualTopHeight:0,textTopHeight:0,bottomHeight:0,statusBarHeight:0,sideSortablesHeight:0},j=t._.throttle(function(){var e=t.scrollX||document.documentElement.scrollLeft,o=t.scrollY||document.documentElement.scrollTop,i=parseInt(x.style.height,10);x.style.height=L+"px",x.scrollHeight>L&&(x.style.height=x.scrollHeight+"px"),void 0!==e&&t.scrollTo(e,o),x.scrollHeight<i&&d()},300);n.on("tinymce-editor-init.editor-expand",function(n,s){function f(){var t=s.selection.getNode(),e,o,i;if(s.wp&&s.wp.getView&&(o=s.wp.getView(t)))i=o.getBoundingClientRect();else{e=s.selection.getRng();try{i=e.getClientRects()[0]}catch(t){}i||(i=t.getBoundingClientRect())}return!!i.height&&i}function a(t){var e=t.keyCode;e<=47&&e!==b.SPACEBAR&&e!==b.ENTER&&e!==b.DELETE&&e!==b.BACKSPACE&&e!==b.UP&&e!==b.LEFT&&e!==b.DOWN&&e!==b.UP||e>=91&&e<=93||e>=112&&e<=123||144===e||145===e||c(e)}function c(e){var o=f(),i=50,n,a,d,c;o&&(a=(n=o.top+s.iframeElement.getBoundingClientRect().top)+o.height,n-=50,a+=50,d=N.adminBarHeight+N.toolsHeight+N.menuBarHeight+N.visualTopHeight,(c=N.windowHeight-(V?N.bottomHeight+N.statusBarHeight:0))-d<o.height||(n<d&&(e===b.UP||e===b.LEFT||e===b.BACKSPACE)?t.scrollTo(t.pageXOffset,n+t.pageYOffset-d):a>c&&t.scrollTo(t.pageXOffset,a+t.pageYOffset-c)))}function r(t){t.state||d()}function l(){i.on("scroll.mce-float-panels",v),setTimeout(function(){s.execCommand("wpAutoResize"),d()},300)}function p(){i.off("scroll.mce-float-panels"),setTimeout(function(){var e=h.offset().top;t.pageYOffset>e&&t.scrollTo(t.pageXOffset,e-N.adminBarHeight),o(),d()},100),d()}function m(){V=!V}var b=t.tinymce.util.VK,v=_.debounce(function(){!e(".mce-floatpanel:hover").length&&t.tinymce.ui.FloatPanel.hideAll(),e(".mce-tooltip").hide()},1e3,!0);"content"===s.id&&(k=s,s.settings.autoresize_min_height=L,w=h.find(".mce-toolbar-grp"),H=h.find(".mce-edit-area"),C=h.find(".mce-statusbar"),B=h.find(".mce-menubar"),A=function(){s.on("keyup",a),s.on("show",l),s.on("hide",p),s.on("wp-toolbar-toggle",m),s.on("setcontent wp-autoresize wp-toolbar-toggle",d),s.on("undo redo",c),s.on("FullscreenStateChanged",r),i.off("scroll.mce-float-panels").on("scroll.mce-float-panels",v)},W=function(){s.off("keyup",a),s.off("show",l),s.off("hide",p),s.off("wp-toolbar-toggle",m),s.off("setcontent wp-autoresize wp-toolbar-toggle",d),s.off("undo redo",c),s.off("FullscreenStateChanged",r),i.off("scroll.mce-float-panels")},g.hasClass("wp-editor-expand")&&(A(),u(d)))}),g.hasClass("wp-editor-expand")&&(l(),h.hasClass("html-active")&&u(function(){d(),o()})),e("#adv-settings .editor-expand").show(),e("#editor-expand-toggle").on("change.editor-expand",function(){e(this).prop("checked")?(l(),t.setUserSetting("editor_expand","on")):(p(),t.setUserSetting("editor_expand","off"))}),t.editorExpand={on:l,off:p}}),e(function(){function o(){(F=B.offset()).right=F.left+B.outerWidth(),F.bottom=F.top+B.outerHeight()}function a(){W||(W=!0,n.trigger("dfw-activate"),S.on("keydown.focus-shortcut",x))}function d(){W&&(r(),W=!1,n.trigger("dfw-deactivate"),S.off("keydown.focus-shortcut"))}function c(){return W}function u(){!K&&W&&(K=!0,S.on("keydown.focus",g),C.add(S).on("blur.focus",m),g(),t.setUserSetting("post_dfw","on"),n.trigger("dfw-on"))}function r(){K&&(K=!1,C.add(S).off(".focus"),h(),B.off(".focus"),t.setUserSetting("post_dfw","off"),n.trigger("dfw-off"))}function l(){K?r():u()}function p(){return K}function g(e){var n,s=e&&e.keyCode;t.navigator.platform&&(n=t.navigator.platform.indexOf("Mac")>-1),27===s||87===s&&e.altKey&&(!n&&e.shiftKey||n&&e.ctrlKey)?h(e):e&&(e.metaKey||e.ctrlKey&&!e.altKey||e.altKey&&e.shiftKey||s&&(s<=47&&8!==s&&13!==s&&32!==s&&46!==s||s>=91&&s<=93||s>=112&&s<=135||s>=144&&s<=150||s>=224))||(D||(D=!0,clearTimeout(j),j=setTimeout(function(){O.show()},600),B.css("z-index",9998),O.on("mouseenter.focus",function(){o(),i.on("scroll.focus",function(){var e=t.pageYOffset;V&&M&&V!==e&&(M<F.top-U||M>F.bottom+U)&&h(),V=e})}).on("mouseleave.focus",function(){I=L=null,R=Y=0,i.off("scroll.focus")}).on("mousemove.focus",function(e){var o=e.clientX,i=e.clientY,n=t.pageYOffset,s=t.pageXOffset;if(I&&L&&(o!==I||i!==L))if(i<=L&&i<F.top-n||i>=L&&i>F.bottom-n||o<=I&&o<F.left-s||o>=I&&o>F.right-s){if(R+=Math.abs(I-o),Y+=Math.abs(L-i),(i<=F.top-U-n||i>=F.bottom+U-n||o<=F.left-U-s||o>=F.right+U-s)&&(R>10||Y>10))return h(),I=L=null,void(R=Y=0)}else R=Y=0;I=o,L=i}).on("touchstart.focus",function(t){t.preventDefault(),h()}),B.off("mouseenter.focus"),N&&(clearTimeout(N),N=null),y.addClass("focus-on").removeClass("focus-off")),w(),b())}function h(t){D&&(D=!1,clearTimeout(j),j=setTimeout(function(){O.hide()},200),B.css("z-index",""),O.off("mouseenter.focus mouseleave.focus mousemove.focus touchstart.focus"),void 0===t&&B.on("mouseenter.focus",function(){(e.contains(B.get(0),document.activeElement)||q)&&g()}),N=setTimeout(function(){N=null,B.off("mouseenter.focus")},1e3),y.addClass("focus-off").removeClass("focus-on")),H(),v()}function m(){setTimeout(function(){function t(t){return e.contains(t.get(0),document.activeElement)}var o=document.activeElement.compareDocumentPosition(B.get(0));2!==o&&4!==o||!(t(_)||t(T)||t(f))||h()},0)}function w(){!P&&D&&(P=!0,s.on("mouseenter.focus",function(){s.addClass("focus-off")}).on("mouseleave.focus",function(){s.removeClass("focus-off")}))}function H(){P&&(P=!1,s.off(".focus"))}function b(){X||!D||z.find(":focus").length||(X=!0,z.stop().fadeTo("fast",.3).on("mouseenter.focus",v).off("mouseleave.focus"),E.on("focus.focus",v).off("blur.focus"))}function v(){X&&(X=!1,z.stop().fadeTo("fast",1).on("mouseleave.focus",b).off("mouseenter.focus"),E.on("blur.focus",b).off("focus.focus"))}function x(t){t.altKey&&t.shiftKey&&87===t.keyCode&&l()}var y=e(document.body),T=e("#wpcontent"),B=e("#post-body-content"),C=e("#title"),S=e("#content"),O=e(document.createElement("DIV")),z=e("#edit-slug-box"),E=z.find("a").add(z.find("button")).add(z.find("input")),_=e("#adminmenuwrap"),k=e(),A=e(),W="on"===t.getUserSetting("editor_expand","on"),K=!!W&&"on"===t.getUserSetting("post_dfw"),R=0,Y=0,U=20,D,P,X,F,I,L,M,V,N,j,q;y.append(O),O.css({display:"none",position:"fixed",top:s.height(),right:0,bottom:0,left:0,"z-index":9997}),B.css({position:"relative"}),i.on("mousemove.focus",function(t){M=t.pageY}),e("#postdivrich").hasClass("wp-editor-expand")&&S.on("keydown.focus-shortcut",x),n.on("tinymce-editor-setup.focus",function(t,e){e.addButton("dfw",{active:K,classes:"wp-dfw btn widget",disabled:!W,onclick:l,onPostRender:function(){var t=this;e.on("init",function(){t.disabled()&&t.hide()}),n.on("dfw-activate.focus",function(){t.disabled(!1),t.show()}).on("dfw-deactivate.focus",function(){t.disabled(!0),t.hide()}).on("dfw-on.focus",function(){t.active(!0)}).on("dfw-off.focus",function(){t.active(!1)})},tooltip:"Distraction-free writing mode",shortcut:"Alt+Shift+W"}),e.addCommand("wpToggleDFW",l),e.addShortcut("access+w","","wpToggleDFW")}),n.on("tinymce-editor-init.focus",function(t,i){function s(){q=!0}function f(){q=!1}var a,d;"content"===i.id&&(k=e(i.getWin()),A=e(i.getContentAreaContainer()).find("iframe"),a=function(){i.on("keydown",g),i.on("blur",m),i.on("focus",s),i.on("blur",f),i.on("wp-autoresize",o)},d=function(){i.off("keydown",g),i.off("blur",m),i.off("focus",s),i.off("blur",f),i.off("wp-autoresize",o)},K&&a(),n.on("dfw-on.focus",a).on("dfw-off.focus",d),i.on("click",function(t){t.target===i.getDoc().documentElement&&i.focus()}))}),n.on("quicktags-init",function(t,o){var i;o.settings.buttons&&-1!==(","+o.settings.buttons+",").indexOf(",dfw,")&&(i=e("#"+o.name+"_dfw"),e(document).on("dfw-activate",function(){i.prop("disabled",!1)}).on("dfw-deactivate",function(){i.prop("disabled",!0)}).on("dfw-on",function(){i.addClass("active")}).on("dfw-off",function(){i.removeClass("active")}))}),n.on("editor-expand-on.focus",a).on("editor-expand-off.focus",d),K&&(S.on("keydown.focus",g),C.add(S).on("blur.focus",m)),t.wp=t.wp||{},t.wp.editor=t.wp.editor||{},t.wp.editor.dfw={activate:a,deactivate:d,isActive:c,on:u,off:r,toggle:l,isOn:p}})}(window,window.jQuery);