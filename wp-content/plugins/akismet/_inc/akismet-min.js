jQuery(function($){function t(e,a){var o=$(".checkforspam"),n=Math.round(c/o.data("pending-comment-count")*1e3)/10;$(".checkforspam-progress").text(o.data("progress-label-format").replace("%1$s",n)),$.post(ajaxurl,{action:"akismet_recheck_queue",offset:e,limit:a},function(n){c+=n.counts.processed,m+=n.counts.spam,n.counts.processed<a?window.location.href=o.data("success-url").replace("__recheck_count__",c).replace("__spam_count__",m):t(e+a-n.counts.spam,a)})}function e(){$("#the-comment-list").find('tr.comment, tr[id ^= "comment-"]').find('.column-author a[href^="http"]:first').each(function(){if(!($(this).parent().find(".akismet_remove_url").length>0)){var t=$(this).attr("href"),e=document.location.href.split("/"),a=e[0]+"//"+e[2]+"/";if(0!=t.indexOf(a)){var o=$(this).parents("tr:first").attr("id").split("-");$(this).attr("id","author_comment_url_"+o[1]).after($('<a href="#" class="akismet_remove_url">x</a>').attr("commentid",o[1]).attr("title",WPAkismet.strings["Remove this URL"]))}}})}function a(t,e){var a="//s0.wordpress.com/mshots/v1/"+encodeURIComponent(t)+"?w=900";return e&&(a+="&r="+encodeURIComponent(e)),a}function o(t){(new Image).src=a(t)}var n=null,i=null,s=null,r='a[id^="author_comment_url"], tr.pingback td.column-author a:first-of-type, td.comment p a';$(".akismet-status").each(function(){var t=$(this).attr("commentid");$(this).prependTo("#comment-"+t+" .column-comment")}),$(".akismet-user-comment-count").each(function(){var t=$(this).attr("commentid");$(this).insertAfter("#comment-"+t+" .author strong:first").show()}),e(),$("#the-comment-list").on("click",".akismet_remove_url",function(){var t=$(this).attr("commentid"),e={action:"comment_author_deurl",_wpnonce:WPAkismet.comment_author_url_nonce,id:t};return $.ajax({url:ajaxurl,type:"POST",data:e,beforeSend:function(){$("a[commentid='"+t+"']").hide(),$("#author_comment_url_"+t).html($("<span/>").text(WPAkismet.strings["Removing..."]))},success:function(e){e&&$("#author_comment_url_"+t).attr("cid",t).addClass("akismet_undo_link_removal").html($("<span/>").text(WPAkismet.strings["URL removed"])).append(" ").append($("<span/>").text(WPAkismet.strings["(undo)"]).addClass("akismet-span-link"))}}),!1}).on("click",".akismet_undo_link_removal",function(){var t=$(this).attr("cid"),e=$(this).attr("href"),a={action:"comment_author_reurl",_wpnonce:WPAkismet.comment_author_url_nonce,id:t,url:e};return $.ajax({url:ajaxurl,type:"POST",data:a,beforeSend:function(){$("#author_comment_url_"+t).html($("<span/>").text(WPAkismet.strings["Re-adding..."]))},success:function(a){a&&($("a[commentid='"+t+"']").show(),$("#author_comment_url_"+t).removeClass("akismet_undo_link_removal").text(e.replace(/^http:\/\/(www\.)?/gi,"")))}}),!1}),$("#the-comment-list").on("mouseover",r,function(){if(clearTimeout(n),$(".akismet-mshot").length>0){if($(".akismet-mshot:first").data("link")==this)return;$(".akismet-mshot").remove()}clearTimeout(i),clearTimeout(s);var t=$(this).attr("href"),e=$('<div class="akismet-mshot mshot-container"><div class="mshot-arrow"></div><img src="'+a(t)+'" width="450" height="338" class="mshot-image" /></div>');e.data("link",this);var o=$(this).offset();e.offset({left:Math.min($(window).width()-475,o.left+$(this).width()+10),top:o.top+$(this).height()/2-101}),i=setTimeout(function(){e.find(".mshot-image").attr("src",a(t,2))},6e3),s=setTimeout(function(){e.find(".mshot-image").attr("src",a(t,3))},12e3),$("body").append(e)}).on("mouseout",'a[id^="author_comment_url"], tr.pingback td.column-author a:first-of-type, td.comment p a',function(){n=setTimeout(function(){clearTimeout(i),clearTimeout(s),$(".akismet-mshot").remove()},200)}).on("mouseover","tr",function(){$(this).find(r).each(function(){$(this).data("akismet-mshot-preloaded")||(o($(this).attr("href")),$(this).data("akismet-mshot-preloaded",!0))})}),$(".checkforspam:not(.button-disabled)").click(function(e){e.preventDefault(),$(".checkforspam:not(.button-disabled)").addClass("button-disabled"),$(".checkforspam-spinner").addClass("spinner").addClass("is-active"),$(".checkforspam .akismet-label").text($(".checkforspam").data("active-label")),t(0,100)});var m=0,c=0;if("start_recheck"in WPAkismet&&WPAkismet.start_recheck&&$(".checkforspam").click(),"undefined"!=typeof MutationObserver){var u=document.getElementById("the-comment-list");if(u){new MutationObserver(function(t){for(var a=0,o=t.length;a<o;a++)if(t[a].addedNodes.length>0){e();break}}).observe(u,{attributes:!0,childList:!0,characterData:!0})}}});